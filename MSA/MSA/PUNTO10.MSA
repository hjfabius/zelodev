;WE.MSA  PROGRAMMA COME COME WF.MSA MA CON LA MINIRICERCA
                         ;################################
                         ;# CONTROLLO DI REGISTRO COLORE #
                         ;# LONGITUDINALE/TRASVERSALE    #
                         ;# OFFSET CON PUNTINO DERIVATO  #
                         ;# DA COLD07 DEL 16/11/02       #
                         ;################################
;$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
;$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
;$$$CONTROLLARE PAROLA DI MASCHERA PIOB BIT 5 DOVREBBE ESSERE
;$ 0DDH E NON  0FDH
;$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
;$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
;$VOLOUTO SENZA ;

;MESSO IN PARCHEGGIO IL 18/08/06 DA CONTINUARE NELLE MODIFICHE


;17/04/04 INSERIMENTO NEI PARAMETRI ABILITA O DISABILITA MOVIMENTO
          ;TESTA ELETTRICA TTEE

;20/04/04 ELIMINATO ERRORE IN FINOSC: GUADOSC CHE CREAVA CASINI
;ALLUSCITA DALL'OSCILLOSCOPIO DIVENTA PUNTO6
;22/04/04 ULTIMA VERSIONE PRIMA DI INIZIO MODIFICHE COMANDO
;LETTURA  SCHEDE SECONDARIE SSSS
;24/04/04  MODIFICATO I VALORI ALTGUA E MRIC+02H DA 10H A 8H
;E PRIMA  DI COD1:
;24/04/04 17,45 INSERZIONE SPOSTAMENTO DI 2 mm PER RICERCA SEGNO
;PERSO
;27/04/04 INIZIATO COMPOSIZIONE PROGRAMMA PER DRUPA
;27/04/04 PUN07 + OSCIL = PUNTO07

;24/05/04  MODIFICHE PER ELIMINARE GENCAR CENOSC OSCIL KKKK

;25/05/04 salvataggio prima delle modifiche per sapere che led acceso
;03/06/04 INIZIO MODIFICHE COMUNICAZIONE FC E ELIMINAZIONE TRADUZ. CCCC
;05/06/04 FUNZIONA COMUNICAZ SENZA USO INTERRUPT
;07/06/04 RISPOSTA DA CENTRATURA MECCANICA TERMINATA CCCC1
;28/06/04 VIENE MOMENTANEAMENTE MEMORIZZATO COME PUNTO8
;17/08/06 INIZIO RIVISITAZIONE RRII
;17/08/06 INIZIO MODIFICHE PER MISURARE IL LATERALE ATTRVERSO LO SPESSORE SSPP
;14/11/06 SISTEMATO ALTERR ED ALTRO PER METTERE ZERO AL DISPLAY DOPO NOPRI PUUU
;15/11/06 MODIFICE SU RICERCA SEGNO DURANTE FUNZ4 FF44
;17/11/06 MODIFICHE SU GESTIONE NOPRINT E FLASH NNFF
;23/11/06 ELIMINAZIONE MODIFICHE CCCC CCCC1 E INSERIMENTO CONTROLLO FC DOPO 
;UN CERTO NUMERO DI GIRI ROTATIVA RRFF
;29/11/06 DOPO LA MANCANZA DEL SEGNO FA UN CONTROLLO DEL CODICE CCDD
;01/12/06 SISTEMATO ATTESA CICLI DI CORREZIONE IN CASO DI ANOMALIE AACC
;10/12/06 INTRODOTTO UNO SPOSTAMENTO A SX DUE A DX E POI UNO A SX  
;ALL'INIZIO ALLA PERDITA DEL SEGNO PPSS
;12/12/06 MESSO CONTROLLO CODICE DOPO UN TOT DI GIRI CCGG 
;14/12/06 SISTEMATO SENSO DI CORREZIONE TRAVERS TTCC
;16/12/06 TOLTA LA SCRITTA DI FINE CORSA QUANDO RITORNA DENTRO 
;BLOCCO MOVIMENTO TESTA DOPO VERIFICA FC E CODICE BBCC
;19/12/06 TENTATIVO DI INSERIRE UNA SPECIE DI WATCH DOG WWDD
;22/12/06 TENTATIVO DI ELIMINARE ALTERN E LEGGERE UN GIRO LONG UN GIRO TRAV
;E NON OGNI DUE GIRI FORSE BISOGNERA'FARE UNA MEDIA DELL'ERRORE CHE SERVE PER 
;TENERE CENTRATA LA TESTINA MMTT
;30/01/07 MODIFICHE DI AGGIORNAMENTO PER SEGNO DOPPIO SSDD
;30/01/07 MODIFICHE DI AGGIORNAMENTO PER SEGNO DOPPIO SSDD
;04/02/07  MIGLIORATO GESTIONE ALTERN AALL



PA:     EQU     00H      ;DATI PORTA A
PB:     EQU     01H      ;DATI PORTA B
PC:     EQU     63H      ;DATI PORTA C
PD:     EQU     51H      ;DATI PORTA D    TTTT
TABCON: EQU     0C000H   ;USATA IN CONVERSIONE BCD BINARIO
DIVDEN: EQU     0C014H   ;MEM. DEL DIVIDENDO
DIVSOR: EQU     0C016H   ;MEM. DEL DIVISORE
QUOZIE: EQU     0C018H   ;MEM. RISULTATO DIVISIONE
MOLTI:  EQU     0C01AH   ;MEMORIA DEL MOLTIPLICATORE
MOLPL:  EQU     0C01CH   ;MEMORIA DEL MOLTIPLICANDO
PROD:   EQU     0C01EH   ;MEMORIA DEL PRODOTTO
MOLT24: EQU     0C020H   ;MOLTIPLICATORE  MOLTIPLICA 24 BIT
MOLP24: EQU     0C022H   ;MOLTIPLICANDO MOLTIPLICA 24 BIT
PROD24: EQU     0C024H   ;C026H PRODOTTO MOLTIPLICA 24 BIT 
QU4096: EQU     0C028H   ;QUOZIENTE DIVISIONE PER 4096
QU1000: EQU     0C02AH   ;QUOZIENTE DIVISIONE PER 1000
MDIVIS: EQU     0C02CH   ;MEM. USATA IN DIVISIONE 1000
ADDEN0: EQU     0C030H   ;ADDENDO BASSO SOMMA A 32 BIT
ADDEN2: EQU     0C032H   ;ADDENDO ALTO SOMMA A 32 BIT
AUGEN0: EQU     0C034H   ;AUGENDO BASSO SOMMA A 32 BIT
AUGEN2: EQU     0C036H   ;AUGENDO ALTO SOMMA A 32 BIT

CONSAL: EQU     0C03AH   ;CONTEG. SALTI DI NON COR.LONG. EEAA
CONSAT: EQU     0C03CH   ;CONTEG. SALTI DI NON COR.TRAV. EEAA

VELMED: EQU     0C03EH   ;MEM.MEDIA DELLA VELOCITA'     
VELBCD: EQU     0C040H   ;0C042H MEM. VELOCITA BCD
VELMEM: EQU     0C044H   ;USATA NELLA CONVERSIONE VELOCITA
VMEDIA: EQU     0C046H   ;USATA IN CALCOLO VELOCITA'MEDIA 
VELPRE: EQU     0C048H   ;MEM. DELLA VELOCITA' PRECEDENTE
IMPVEL: EQU     0C04AH   ;IMPULSI ENCODER IN 4 mS 
ISTVEL: EQU     0C04CH   ;VELOCITA' ISTANTANEA 
MVEL00: EQU     0C050H   ;USATA IN CALCOLO VELOCITA'MEDIA 
MVEL02: EQU     0C052H   ;USATA IN CALCOLO VELOCITA'MEDIA 
MVEL04: EQU     0C054H   ;USATA IN CALCOLO VELOCITA'MEDIA 
MVEL06: EQU     0C056H   ;USATA IN CALCOLO VELOCITA'MEDIA 
MVEL08: EQU     0C058H   ;USATA IN CALCOLO VELOCITA'MEDIA 
MVEL0A: EQU     0C05AH   ;USATA IN CALCOLO VELOCITA'MEDIA 
MVEL0C: EQU     0C05CH   ;USATA IN CALCOLO VELOCITA'MEDIA 
MVEL0E: EQU     0C05EH   ;USATA IN CALCOLO VELOCITA'MEDIA 

DECORR: EQU     0C060H   ;EXTRA VALORE DI CORREZ. LONGITUD.ZZZ
MDECOR: EQU     0C062H   ;MEM.EXTRA VALORE DI CORREZ. LONG. ZZZ

DECORT: EQU     0C064H   ;EXTRA VALORE DI CORREZ. TRAVERS.
MDECOT: EQU     0C066H   ;MEM.EXTRA VALORE DI CORREZ. TRAV. ZZZ

CORRE:  EQU     0C068H   ;MEM.VALORE DI CORREZ.MOTORE
ADDRCG: EQU     0C06AH   ;MEM.ADDRES GENERAZIONE CARATTERI OOOO

BINSET: EQU     0C200H   ;MEM.TRASM.DISPLAY 4200H-4210H
BINSE1: EQU     0C220H   ;MEM.TRASM.DISPLAY 4220H-422FH
BINSE2: EQU     0C230H   ;MEM.TRASM.DISPLAY 4230H-423FH        

MAGGIU: EQU     0C2E0H   ;MEM.USATA IN AGGIUST.DECIM. OOOO AAAA
MAGGI1: EQU     0C2E2H   ;USATA IN AGGIUSTAMENTO AMPGATE OSCIL OOOO
USOSCI: EQU     0C2E4H   ;MEMORIA OSCILLOSCOPIO IN USO  OOOO
SPOINC: EQU     0C2E6H   ;MEM.INCREMENTO DELLO SPOSTAMENTO OSCIL. OOOO
TESTCO: EQU	0C2E8H	 ;SEGNALA IL CONTROLLO CICLICO DEL CODICE
WATCH:	EQU	0C2EAH	 ;MEMORIA DEL WATCH DOG WWDD

SIMCOL: EQU     0C300H   ;SIMBOLO PER DISPLAY
SIMCOT: EQU     0C304H   ;SIMBOLO PER DISPLAY
ALTERN: EQU     0C308H   ;CONTEGGIO ALTERNANZA
MAZTRA: EQU     0C30AH   ;AVVISO AZZERAMENTO TRAVERS
ENCOD1: EQU     0C310H   ;USATA IN TEST ENCODER
ENCOD2: EQU     0C312H   ;USATA IN TEST ENCODER
ENCOD3: EQU     0C314H   ;USATA IN TEST ENCODER

MPIEN1: EQU     0C31AH   ;MEM TEMPORANEA PIENO 1 LONG
MPOSI1: EQU     0C31CH   ;MEM TEMPORANEA POSIZ.1 LONG
MASES1: EQU     0C31EH   ;MEM TEMPORANEA FASE 1 LONG
TPIEN1: EQU     0C320H   ;MEM TEMPORANEA PIENO 1 TRAV
TPOSI1: EQU     0C322H   ;MEM TEMPORANEA POSIZ.1 TRAV
TASES1: EQU     0C324H   ;MEM TEMPORANEA FASE 1 TRAV
MPIEN2: EQU     0C326H   ;MEM TEMPORANEA PIENO 2 LONG
MPOSI2: EQU     0C328H   ;MEM TEMPORANEA POSIZ.2 LONG
MASES2: EQU     0C32AH   ;MEM TEMPORANEA FASE 2 LONG
TPIEN2: EQU     0C32CH   ;MEM TEMPORANEA PIENO 2 TRAV
TPOSI2: EQU     0C32EH   ;MEM TEMPORANEA POSIZ.2 LONG
TASES2: EQU     0C330H   ;MEM TEMPORANEA FASE 2 TRAV
TMEM4:  EQU     0C332H   ;ATTIVAZIONE CORREZ.TRAVERS
TMEM5:  EQU     0C334H   ;USATA IN CORREZ.TRAVER
TMEM6:  EQU     0C336H   ;USATA IN CORREZ.TRAVER ZZZ

CONALL: EQU     0C338H   ;CONTEGGIO AVVISI ALLARME CIRC.
CONALT: EQU     0C33AH   ;CONTEGGIO AVVISI ALLARME TRAV.
MEM0:   EQU     0C400H   ;MEMORIA DELLA FUNZIONE 0
MEM1:   EQU     0C402H   ;MEMORIA DELLA FUNZIONE 1
MEM2:   EQU     0C404H   ;MEMORIA DELLA FUNZIONE 2
MEM3:   EQU     0C406H   ;MEMORIA DELLA FUNZIONE 3
MEM5:   EQU     0C408H   ;MEMORIA DELLA FUNZIONE 5 OOOO
MEM6:   EQU     0C40AH   ;MEMORIA DELLA FUNZIONE 6
MEM6A:  EQU     0C40CH   ;MEM. USATA NELLA FUNZIONE 6
MEM7:   EQU     0C40EH   ;MEMORIA DELLA FUNZIONE 7
MEMW:   EQU     0C410H   ;USATA IN CALCOLO CORREZ.MOTORE
MEMID:  EQU     0C412H   ;MEM.INIZIALIZZIONE DISPLAY
MEMTF:  EQU     0C414H   ;MEM. TASTO F GIA' PIGIATO
PROTEZ: EQU     0C416H   ;AVVISO PROTEZIONE
MDATER: EQU     0C418H   ;MEM.INSERIMENTO DATO ERRATO
MCALER: EQU     0C41AH   ;SEGNALA AL MAIN DI CALCOLARE
MSCORR: EQU     0C41CH   ;MEM.INDICA IL SENSO DELLA CORR.
ALTDIV: EQU     0C41EH   ;ALTERNA I VALORI NELLA DIVISIONE
CADDE0: EQU     0C420H   ;ADDENDO BASSO SOMMA A 32 BIT
CADDE2: EQU     0C422H   ;ADDENDO ALTO SOMMA A 32BIT
CAUGE0: EQU     0C424H   ;AUGENDO BASSO SOMMA A 32 BIT
CAUGE2: EQU     0C426H   ;AUGENDO ALTO SOMMA A 32 BIT
CSOMM0: EQU     0C428H   ;SOMMA BASSA A 32 BIT
CSOMM2: EQU     0C42AH   ;SOMMA ALTA A 32 BIT
MREST0: EQU     0C42CH   ;MEM RESTO BASSA SOTT32
MREST2: EQU     0C42EH   ;MEM RESTO ALTA SOTT32

MKBUSY: EQU     0C450H   ;SEGNALA L'USO DELLA TASTIERA
MDBUSY: EQU     0C452H   ;DISPLAY CON ERRORE DI REGISTRO
MTASTI: EQU     0C454H   ;SEGNALA PASSAGGIO DALLA TASTIERA
MNOPR1: EQU     0C456H   ;USATA PER SEGNALARE MANCANZA SEGNO NNFF
MNOPR2: EQU     0C458H   ;USATA PER CONTEGGIO GIRI SENZA SEGNO 
MNOPR3: EQU	0C45AH	 ;ATTIVA IL CONTROLLO DEL CODICE CCDD
MNOPR4:	EQU	0C45CH		;PPSS
MATTES: EQU     0C45EH   ;USATA IN DECREM.CILCI ATTESA AACC
TATTES: EQU     0C460H   ;ATTESA CORREZ.TRAVERS AACC
ALTERR: EQU     0C462H   ;ALT CALCOLO ERR.DOPO USO TASTIER PUUU
TALTER: EQU     0C464H   ;COME SOPRA MA PER TRASVERS PUUU

ZEROSE: EQU     0C466H   ;SEGNO IN ZERO ENCODER 
ALTGUA: EQU     0C468H   ;DOPO N GIRI FISSA IL GUADAGNO
MRIC:   EQU     0C470H   ;GRUPPO MEME IN RICERCA AUTOMATICA
;+00H SEGNALA RICERCA IN CORSO MMSS
;+02H CONTA I GIRI DELLA RICERA
;+04H SEGNO DOPPIO 0=CONTROLLO ATTIVO 1=SCRITTA ABILITATA 2=DISABILITATO SSDD
;+06H CONTEGGIO GIRI PER CANCELLARE LA SCRITTA DOPPIO MMSS


MDO032: EQU     0C480H   ;MOLTIPLICANDO BASSO A 32 BIT 
MDO232: EQU     0C482H   ;MOLTIPLICANDO ALTO A 32 BIT 
MRE032: EQU     0C484H   ;MOLTIPLICATORE BASSO 32 BIT 
MRE232: EQU     0C486H   ;MOLTIPLICATORE ALTO A 32 BIT
PTO032: EQU     0C488H   ;PRODOTTO BASSO A 32 BIT 
PTO232: EQU     0C48AH   ;PRODOTTO ALTO  A 32 BIT
EDEND0: EQU     0C48CH   ;DIVIDENDO BASSO DIVISIONE 32BIT
EDEND2: EQU     0C48EH   ;DIVIDENDO ALTO DIVISIONEO 32BIT
QUOZ32: EQU     0C490H   ;QUOZ DIVISIONE 32BIT DIVISO 4096
MINUE0: EQU     0C492H   ;MINUENDO BASSO SOTT. A 32 BIT
MINUE2: EQU     0C494H   ;MINUENDO ALTO SOTT. A 32 BIT
SUBTR0: EQU     0C496H   ;SOTTRAENDO BASSO SOTT. A 32 BIT
SUBTR2: EQU     0C498H   ;SOTTRAENDO ALTO SOTT. A 32 BIT                     
RESTO0: EQU     0C49AH   ;RESTO BASSO SOTT. A 32 BIT
RESTO2: EQU     0C49CH   ;RESTO ALTO SOTT. A 32 BIT
MIXUE0: EQU     0C49EH   ;MINUENDO ALTERNATIVO BASSO
MIXUE2: EQU     0C4A0H   ;MINUENDO ALTERNATIVO ALTO
SUXTR0: EQU     0C4A2H   ;SOTTRAENDO ALTERNATIVO BASSO
SUXTR2: EQU     0C4A4H   ;SOTTRAENDO ALTERNATIVO ALTO

MSHIFT: EQU     0C4B0H   ;CICATT+5 DA DECREMENT.USANDO SHIFT LONG.WWAA SSPP
MTSHIF: EQU     0C4B2H   ;TCICAT+1 DA DECREMENT.USANDO SHIFT TRAV.WWAA

TMSCOR: EQU     0C4D4H   ;INDICA SENSO DI CORREZ. DISPLAY

TINUE0: EQU     0C4DCH   ;MINUENDO BASSO SOTT. A 32 BIT
TINUE2: EQU     0C4DEH   ;MINUENDO ALTO SOTT. A 32 BIT
TUBTR0: EQU     0C4E0H   ;SOTTRAENDO BASSO SOTT. A 32 BIT
TUBTR2: EQU     0C4E2H   ;SOTTRAENDO ALTO SOTT. A 32 BIT                     
TREST0: EQU     0C4E4H   ;RESTO BASSO SOTT. A 32 BIT
TREST2: EQU     0C4E6H   ;RESTO ALTO SOTT. A 32 BIT
TIXUE0: EQU     0C4E8H   ;MINUENDO ALTERNATIVO BASSO
TIXUE2: EQU     0C4EAH   ;MINUENDO ALTERNATIVO ALTO
TUXTR0: EQU     0C4ECH   ;SOTTRAENDO ALTERNATIVO BASSO
TUXTR2: EQU     0C4EEH   ;SOTTRAENDO ALTERNATIVO ALTO
CINUE0: EQU     0C4F0H   ;MINUENDO BASSO CSOTT32
CINUE2: EQU     0C4F2H   ;MINUENDO ALTO CSOTT32
CUBTR0: EQU     0C4F4H   ;SOTTRAENDO BASSO CSOTT32
CUBTR2: EQU     0C4F6H   ;SOTTRAENDO ALTO CSOTT32                     
CESTO0: EQU     0C4F8H   ;RESTO BASSO CSOTT32
CESTO2: EQU     0C4FAH   ;RESTO BASSO CSOTT32
CODIS0: EQU     0C4FCH   ;DIST.BASSA TRAVER COMPENSATA
CODIS2: EQU     0C4FEH   ;DIST.ALTA TRAVER COMPENSATA
SECFUN: EQU     0C600H   ;SECONDA RIGA FUNZ LCD
SECERR: EQU     0C620H   ;SECONDA RIGA ERRORE
NUMCOL: EQU     0C640H   ;0C660H RIGA NUMERO COLORE

CALCOD: EQU     0C680H   ;CONTEGGIO SPOSTAMENTI 2 mm

ALTER1: EQU     0C682H   ;CONTEGGIO GIRI NOPRINT
SWEEP1: EQU     0C684H   ;CONTEGGIO PASSI TTTT

LIMIT:	EQU	0C686H	 ;MEMORIZZA IL FINE CORSA ATTIVO RRFF			
CONTGIR:EQU	0C688H	 ;CONTEGGIO GIRI PER CONTROLLARE FINE CORSA RRFF
DATOTX: EQU     0C68AH   ;TTTT
DATORX: EQU     0C68CH   ;TTTT
SCRIOS: EQU     0C6A0H   ;0C6CAH SCRITTURA OSCILLOSCOPIO OOOO
TRIGFA: EQU     0C700H   ;MEM.FASE DI TRIGGER OSCILLO. OOOO

MEMA:   EQU     0C800H   ;MEMORIA DELLA PORTA A OOOO
MEMB:   EQU     0C802H   ;MEMORIA DELLA PORTA B OOOO
MEMC1:  EQU     0C804H   ;MEM PORTA C IN FLASH



MAVA00: EQU     0C900H   ;DA 0C900H A 0C95FH  SONO 96 LOCAZIONI WWAA SSPP
                         ;USATE IN CALCOLO MEDIA ERRORE AVANTI
MRIT00: EQU     0C960H   ;DA 0C960H A 0C9BFH  SONO 96 LOCAZIONI WWAA
                         ;USATE IN CALCOLO MEDIA ERRORE RITARDO
DAVA00: EQU     0C9C0H   ;DA 0C9C0H A 0C9DFH  SONO 16 LOCAZIONI WWAA
                         ;USATE IN CALCOLO MEDIA ERRORE AVANTI DISPLAY
DRIT00: EQU     0C9E0H   ;DA 0C9E0H A 0C9FFH  SONO 16 LOCAZIONI WWAA
                         ;USATE IN CALCOLO MEDIA ERRORE RITARDO DISPLAY

ERATTU: EQU     0CA00H   ;ERRORE ATTUALE   ;LLTT FFXX   MMDD  WWAA
ERPREC: EQU     0CA02H   ;ERRORE PRECEDENTE   LLTT FFXX      WWAA
ERMEDI: EQU     0CA04H   ;MEMORIA ERRORE MEDIO LONG LLTT FFXX    WWAA
SOMLO1: EQU     0CA18H   ;PRIMA SOMMA PER MEDIA LONG GGAA   WWAA
SOMLO2: EQU     0CA1AH   ;SECONDA SOMMA PER MEDIA LONG GGAA WWAA
SOMDL1: EQU     0CA1CH   ;USATA IN CALCOLO MEDIA DIPLAY LONG.
SOMDL2: EQU     0CA1EH   ;USATA IN CALCOLO MEDIA DIPLAY LONG.

MOPE00: EQU     0CB00H   ;DA 0CB00H A 0CB5FH  SONO 96 LOCAZIONI WWAA
                         ;USATE IN CALCOLO MEDIA ERRORE OPERATORE
MTRA00: EQU     0CB60H   ;DA 0CB60H A 0CBBFH  SONO 96 LOCAZIONI WWAA
                         ;USATE IN CALCOLO MEDIA ERRORE TRASMISSIONE
DOPE00: EQU     0CBC0H   ;DA 0CBC0H A 0CBDFH  SONO 16 LOCAZIONI WWAA
                         ;USATE IN CALCOLO MEDIA ERRORE OPERA DISPLAY
DTRA00: EQU     0CBE0H   ;DA 0CBE0H A 0CBFFH  SONO 16 LOCAZIONI WWAA
                         ;USATE IN CALCOLO MEDIA ERRORE RITARDO DISPLAY
TERATT: EQU     0CC00H   ;ERRORE ATTUALE TRAVERS   LLTT  FFXX     MMDD
TERPRE: EQU     0CC02H   ;ERRORE PRECEDENTE TRAVERS   ;LLTT FFXX 
TERMED: EQU     0CC04H   ;MEMORIA ERRORE MEDIO TRAVERS ;LLTT FFXX
SOMTR1: EQU     0CC18H   ;PRIMA SOMMA PER MEDIA TRAVERS GGAA
SOMTR2: EQU     0CC1AH   ;SECONDA SOMMA PER MEDIA  TRAVERS GGAA
SOMDT1: EQU     0CC1CH   ;USATA IN CALCOLO MEDIA DIPLAY TRAV.
SOMDT2: EQU     0CC1EH   ;USATA IN CALCOLO MEDIA DIPLAY TRAV.


PRIMOB: EQU     0CD00H   ;VALORE DA DARE AL PRIMO REG B IN MEDIALOMG   VVVV
SECONB: EQU     0CD02H   ;VALORE DA DARE AL SECONDO REG B IN MEDIALOMG VVVV
VALORX: EQU     0CD04H   ;VALORE DA DARE AL REG IX IN MEDIALOMG        VVVV
TPRIMB: EQU     0CD06H   ;VALORE DA DARE AL PRIMO REG B IN MEDIATRAV   VVVV
TSECOB: EQU     0CD08H   ;VALORE DA DARE AL SECONDO REG B IN MEDIATRAV VVVV
TVALOX: EQU     0CD0AH   ;VALORE DA DARE AL REG IX IN MEDIATRAV        VVVV SSPP


MEMC:   EQU     0D000H   ;MEMORIA DELLA PORTA C
;MEMC1:  EQU     0D002H   ;MEM PORTA C IN FLASH
CILIN:  EQU     0D004H   ;MEM. SVILUPPO CILINDRO
ALLAR:  EQU     0D006H   ;MEM. VALORE ALLARME
COSVEL: EQU     0D008H   ;COSTANTE USATA IN VELOCITA'

CENTES: EQU     0D010H   ;CENTESIMI IN UN IMP.DI ENCODER
MILLES: EQU     0D012H   ;MILLESIMI IN UN IMP.DI ENCODER
FASE:   EQU     0D014H   ;MEM. INIZIO GATE DELLA FASE S1
FASE2:  EQU     0D016H   ;MEM. INIZIO GATE DELLA FASE S2
FASE3:  EQU     0D018H   ;PUNTO DI ABILITAZIONE  PER PA7
FASES1: EQU     0D01AH   ;MEMORIA DELLA FASE DI S1
FASES2: EQU     0D01CH   ;MEMORIA DELLA FASE DI S2
FASRIF: EQU     0D01EH   ;MEM.FASE DI RIFERIMENTO DI S1
UNOMIL: EQU     0D020H   ;1mm IN IMPULSI ENCODER 
RIFTOT: EQU     0D022H   ;(FASRIFx10)+RAPRIF=RIFTOT 
POSTO1: EQU     0D024H   ;POSIZIONE TOTALE S1
POSTO2: EQU     0D026H   ;POSIZIONE TOTALE S2
AMPIMP: EQU     0D028H   ;AMPIEZZA GATE IN IMPULSI ENCODER
MEZGA:  EQU     0D02AH   ;MEM.AMPIEZZA 46% DI GATE
CILDIV: EQU     0D02CH   ;CILINDRO DIVISO 10
CILMOL: EQU     0D02EH   ;CILINDRO MOLTIPLICATO x 10
MEMAB:  EQU     0D030H   ;E D032H USATE IN ABILITAZ.GATE
MEMFAS: EQU     0D034H   ;SEGNALA FASE O FASE2 
SEQSEG: EQU     0D036H   ;E D038H POS.SEGNO NELLA SEQUENZA 
SEGNO:  EQU     0D03AH   ;IMP. DA 2048 IN UN SEGNO DA 2mm
                         ; SPAZIO: EQU     0D03CH   ;IMP.DA 2048 IN UNO SPAZIO DA 5mm
SPAZ40: EQU     0D03EH   ;IMP.DA 2048 IN SPAZIO DA 40mm
DISTAN: EQU     0D040H   ;DISTANZA TEORICA TRA S1 E S2
MILL20: EQU     0D042H   ;20mm IN IMPULSI ENCODER     
MILL40: EQU     0D044H   ;40mm IN IMPULSI ENCODER
GUADS1: EQU     0D046H   ;VALORE GUADAGNO SEGNALE S1
GUADS2: EQU     0D048H   ;VALORE GUADAGNO SEGNALE S2
DMILLE: EQU     0D04AH   ;DECIMILLESIMI IN UN IMP.DI ENCOD
DISTA0: EQU     0D04CH   ;DISTANZA BASSA IN DECIMILLESIMI
DISTA2: EQU     0D04EH   ;DISTANZA ALTA IN DECIMILLESIMI
INFLAS: EQU     0D050H   ;INTERVALLO FLASH PROTEZIONI
LAVORO: EQU     0D052H   ;NøDEL LAVORO PRESENTE
SHIFT:  EQU     0D054H   ;MEM.DELLO SPOSTAMENTO REGISTRO
TSHIFT: EQU     0D056H   ;MEM. SPOSTAMENTO REG.TRAVERS
PIUMEN: EQU     0D058H   ;MEM.SENSO DELLO SPOSTAMENTO
SHIFT0: EQU     0D05AH   ;MEM.BASSA SPOSTAMENTO REGISTRO
SHIFT2: EQU     0D05CH   ;MEM. ALTA SPOSTAMENTO REGISTRO
PIENO1: EQU     0D05EH   ;MEM. VALORE DEL PIENO S1
PIENO2: EQU     0D060H   ;MEM. VALORE DEL PIENO S2
POSIZ1: EQU     0D062H   ;MEM. VALORE DELLA POSIZIONE S1
POSIZ2: EQU     0D064H   ;MEM. VALORE DELLA POSIZIONE S2
RAPPO1: EQU     0D066H   ;MEM. RAPPORTO S1
RAPPO2: EQU     0D068H   ;MEM. RAPPORTO S2
IMPENC: EQU     0D06AH   ;VALORE SPOSTAM.IN IMPULS.ENCODER
XUNZ:   EQU     0D06CH   ;MEMORIA FUNZIONE MOD. PARAMETRI
XTASTO: EQU     0D06EH   ;MEMORIA ULTIMO TASTO PREMUTO
TIUMEN: EQU     0D070H   ;MEM.SENSO DELLO SPOSTAM.TRAV
TDIST0: EQU     0D072H   ;DISTAN.BASSA IN DECIMILL.TRAV
TDIST2: EQU     0D074H   ;DIATAN. ALTA IN DECIMILL.TRAV
TPOST1: EQU     0D076H   ;POSIZIONE TOTALE S1 TRAVERS
TPOST2: EQU     0D078H   ;POSIZIONE TOTALE S1 TRAVERS
TRAPP1: EQU     0D07AH   ;MEM.RAPPORTO S1 TRAVERS
TRAPP2: EQU     0D07CH   ;MEM.RAPPORTO S2 TRAVERS
                         ;       MDIAGO: EQU     0D07EH   ;USATA IN SCELTA DIAGONALE
GUADA:  EQU     0D080H   ;MEM.DEL GUAD.min 11 x CIL=2000
CICLO:  EQU     0D08AH   ;MEMORIA CICLO DI CORREZIONE
DERIVA: EQU     0D094H   ;MEMORIA DEL VALORE DERIVATIVO
ZONA:   EQU     0D09EH   ;MEMORIA VALORE ZONA MORTA
INSER:  EQU     0D0A8H   ;MEMORIA VALORE INSERZIONE AUTO
SALTO:	EQU     0D0B2H   ;MEM. VALORE SALTO DI CORREZIONE
GUATRA: EQU     0D0BCH   ;MEM. GUADAGNO TRAVERS
TCICLO: EQU     0D0C6H   ;MEM. CILCO TRAVERS
ZONT:   EQU     0D0D0H   ;MEM. ZONA MORTA TRAVERS
LINGUA: EQU     0D0DAH   ;MEMORIA DELLA LINGUA
                         ;DIAGON: EQU     0D0E4H   ;MEM. POSIZIONE IPOTENUSA

OSGAIN: EQU     0D0E4H   ;GUADAGNO SEGNALE OSCILLOSCOPIO  OOGG

TRIP:   EQU     0D0EEH   ;SOGLIA BLOCCO PER VELOCITA' 

CENSEN: EQU     0D102H   ;VALORE SEGNO CENTRATO NEL GATE
DISPRE: EQU     0D104H   ;ERRORE DISPLAY LONG.PRECEDENTE 
TDISPR: EQU     0D106H   ;ERRORE DISPLAY TRAV.PRECEDENTE 
CICATT: EQU     0D108H   ;CICLI IN FUNZ. POSIZ. CILIN. LONG. FOFF
TCICAT: EQU     0D10AH   ;CICLI IN FUNZ. POSIZ. CILIN. TRAV. FOFF

CICL75: EQU     0D10CH   ;75% DEL CICLO DI CORREZZIONE ZZZ
CIDE75: EQU     0D10EH   ;MEM. DEL 75% DEL CICLO DI CORREZZIONE ZZZ

POSGA1: EQU     0D110H   ;POSIZIONE CARATTERE INIZIO PRIMO GATE   OOOO  (OOOO)  OO22
POSGA2: EQU     0D112H   ;POSIZIONE CARATTERE INIZIO SECONDO GATE   OOOO  (OOOO)  OO22
IMPMIL: EQU     0D118H   ;IMPULSI DA 2048 PER mm PIU UNO  OOOO (OOOO)

AMPGA:  EQU     0D11AH   ;AMPIEZZA GATE IN mm  OOOO (OOOO)
SPABIA:	EQU	0D11CH	 ;SPAZIO BIANCO UNICO

BASCRA: EQU     0D120H   ;VALORE MOMENTANEO SPOSTAMEM.TESTINA TTTT
MEM15:  EQU     0D122H   ;MEM.FUNZ.CENTRATURA MECANICA TESTA TTTT
ULTSPO: EQU     0D124H   ;ULTIMO SPOSTAMENTO FATTO TTTT
RIPRIC: EQU     0D126H   ;RIPETIZ.RICERCA CON SPOSTA. TESTA TTTT

SPELE1: EQU     0D16CH   ;SPESSORE SEGNO DI RIFERIMENTO  SSSS     
SPELE2: EQU     0D16EH   ;SPESSORE SECONDO SEGNO   SSSS     
OFFSET: EQU     0D170H   ;VALORE DA SOMM/SOTTR A SPELE2   SSSS
SPEOFF: EQU     0D172H   ;SPESSORE PRIMO SEGNO +/- OFFSET   SSSS
SEGOFF: EQU     0D174H   ;POLARITA DELL'OFFSET

MOSCIL: EQU     0D200H   ;MEM. OSCILLOSCOPIO DA D500H A D900H OOOO
MPUNTO: EQU     0D600H   ;MEM. DEL PUNTO ON O OFF   OOOO
FORMAR: EQU     0D700H   ;USATA NELLA FORMAZIONE DELLA MARCA OOOO

GATOSC: EQU     0D982H   ;NUMERO CARATTERI OCCUPATI PER GATE OOOO 
AMPMEZ: EQU     0D984H   ;AMPIMP DIVISO 2 OOOO (OOOO)
GUAOSC: EQU     0D986H   ;MEM.TEMPORANEA IN FUNZ OSCILLOSCOPIO
WATCH1:	EQU	0D988H	 ;SEGNALA DIN NON PASSARE DA RELES1 DOPO WATCH DOG

MMED00:	EQU	0D990H	 ;USATA CALCOLO MEDIO ERRORE POSIZIONE CENTRATURA TESTA
MMED02:	EQU	0D992H	 ;USATA CALCOLO MEDIO ERRORE POSIZIONE CENTRATURA TESTA
MMED04:	EQU	0D994H	 ;USATA CALCOLO MEDIO ERRORE POSIZIONE CENTRATURA TESTA
MMED06:	EQU	0D996H	 ;USATA CALCOLO MEDIO ERRORE POSIZIONE CENTRATURA TESTA
CRAPAE: EQU	0D9A0H	 ;ERRORE CENTRATUTA TESTA
CRAPAM: EQU	0D9A2H	 ;MEDIA ERRORE CENTRATURA TESTA
CRAPAC:	EQU	0D9A4H	 ;CICLOICO SU CORREZIONI TESTA

                         ;
PROVLT: EQU     0D9C0H   ;DA ELIMINARE IN PROGRAMMA REGOLARE  PRRR
SALVA:  EQU     0D9C2H   ;USATA NELLA CREAZIONE TABELLE TEST
MSALV:  EQU     0D9C4H   ;USATA NELLA CREAZIONE TABELLE TEST
                         ;




TAP1:   EQU     0DA20H   ;TABELLA IND. INTER. PIO1A
TAP2:   EQU     0DA22H   ;TABELLA IND. INTER. PIO1B
TAB0:   EQU     0DA30H   ;TABELLA IND. INTER. CTC CANALE 0
TAB1:   EQU     0DA32H   ;TABELLA IND. INTER. CTC CANALE 1
TAB2:   EQU     0DA34H   ;TABELLA IND. INTER. CTC CANALE 2
TAB3:   EQU     0DA36H   ;TABELLA IND. INTER. CTC CANALE 3
TABLAV: EQU     0DB00H   ;INIZIO TABELLA MEM. LAVORI




   ;CODOCI DI TRASMISSIONE ALLA TESTA
        
        ;C1		Centratura meccanica
        ;C2		Led longitudinale
        ;C4		Led trasversale
        ;C7		0,25 mm testa dx
        ;C8		0,25 mm testa sx
        ;CB		Mini ricerca segno 2mm dx/sx
        ;CD		Ricerca automatica
        ;CE             Libero
        ;E0		Controllo fine corsa
        
        
        ;CODICI DI RICEZIONE DALLA TESTA

        ;D4		Fine corsa non attivi
        ;D7		Fine corsa lato	sx
        ;D8		Fine corsa lato dx
        ;DB 		Fine centratura meccanica


		;INIZIALIZZAZIONE SISTEMA    
		
		ORG     0000H
		JP      VIA

		ORG     0008H
		JP      VIA

		ORG     0010H
		JP      VIA

		ORG     0018H
		JP      VIA

		ORG     0020H
		JP      VIA

		ORG     0028H
		JP      VIA

		ORG     0030H
		JP      VIA

		ORG     0038H
		JP      VIA


		ORG     100H

VIA:


RESET_PIO:            
		LD	HL,INIT_Z80
		LD	(0DFFFH),HL
		LD	(0DFFDH),HL
		LD      SP,0DFFDH       ;DEF.AREA STACK
		RETI

INIT_Z80:
		LD	HL,VIA
		LD	(0DFFFH),HL
		LD      SP,0DFFFH       ;DEF.AREA STACK

		IM      2               ;MODO 2
                LD      A,0DAH          ;IND.ALTO TAB.
		LD      I,A
                LD      IY,PIOA         ;IND.ROUT.INT.
		LD      (TAP1),IY       ;CAR.TAB.INT.
		LD      A,20H           ;VET.INTER.PIO A
		OUT     (02H),A         ;CONTROLLO PIO A
		LD      A,0CFH          ;PORTA A MODO 3
		OUT     (02H),A
                LD      A,11H           ;0-4 IN 123567 OUT
		OUT     (02H),A
		LD      A,97H           ;PAR.CONT.INTER.
		OUT     (02H),A 
		LD      A,0EFH          ;P.M.BIT 0123567
		OUT     (02H),A
                LD      IY,PIOB         ;IND.ROUT.INT.
		LD      (TAP2),IY       ;CAR.TAB.INT.
		LD      A,22H           ;VET.INT.PIO B
		OUT     (03H),A         ;CONTROLLO PIO B
		LD      A,0CFH          ;PORTA B MODO 3
		OUT     (03H),A
                LD      A,3EH           ;067 OUT 12345 IN TTTT
		OUT     (03H),A
		LD      A,97H           ;PAR.CONT.INTER.
		OUT     (03H),A
                LD	A,0DDH  ;LD      A,0FDH          ;P.MAS.BIT 0234567  TTTT SSSS
		OUT     (03H),A         ;ALL'INTERUPT
                LD      IY,CTC0         ;IND.ROUT.CTC0.  
		LD      (TAB0),IY       ;CAR.TAB.INT.CAN0
		LD      A,30H           ;VET.IND.CTC0
		OUT     (70H),A         ;VET.SEMPRE IN 0
                LD      IY,CTC1         ;IND.ROUT.CTC1
		LD      (TAB1),IY       ;CAR.TAB.INT.CAN1
		LD      A,32H           ;VET.IND.CTC1
		OUT     (70H),A
                LD      IY,CTC2         ;IND.ROUT.CTC2
		LD      (TAB2),IY       ;CAR.TAB.INT.CAN2
		LD      A,34H           ;VET.IND.CTC2
		OUT     (70H),A
                LD      IY,CTC3         ;IND.ROUT.CTC3
		LD      (TAB3),IY       ;CAR.TAB.INT.CAN3
		LD      A,36H           ;VET.IND.CTC3
		OUT     (70H),A         ;VET.CARICATO
		EI                      ;SEMPRE IN 0

		;RESET DELLA PORTA C


		CALL	RESEPC

                ;AZZERAMENTO DA 0C000H A 0CFFFH
		
		
AZZMEM:         LD      A,00H
                LD      (TABCON),A      ;LOC. INIZIALE
                LD      HL,TABCON
                LD      DE,TABCON+01H
                LD      BC,0FFFH
		LDIR                    
		LD      A,04H           ;PER NON AVERE IN
		LD      (MATTES),A      ;DECREMENTO FFH
		LD	(TATTES),A	;AACC
		LD      (CONSAL),A
	        LD      (CONSAT),A      ;EEAA SSPP
		LD	(CRAPAC),A	;MMTT
                LD      (ALTERN),A
		LD	(OSGAIN),A	;PUUU
		LD	A,02H		;AALL
		LD      (ALTERN),A	

		CALL    DEFAUL
    
                CALL    VARERR          ;WWAA SSPP

                ;INIZIALIZZAZIONE LCD E SCRITTA  RELES

		LD	A,(WATCH1)	;SE E' STATO ATTIVATO WWDD
		CP	0FFH		;IL WATCH DOG SALTO
		JR	NZ,INIZIA	;SE NO CONTINUO ADWWDD	
		LD	A,00H		; AD AZZERARLO
		LD	(WATCH1),A
		JP	MAIN
INIZIA:
                CALL    INISI           
                LD      HL,RELES1
                CALL    TX
                CALL    BASSA
                LD      HL,RELES2
                CALL    TX              
                CALL    RITDIS
		CALL	RITDIS
		LD      HL,IIRIGA       
                LD      DE,SECFUN
                LD      BC,0014H        
                LDIR
                LD      A,(LINGUA)
                CP      00H
                JR      Z,COLM
                CP      01H
                JR      Z,COLI
                CP      02H
                JR      Z,COLF
                CP      03H
                JR      Z,COLGB
                CP      04H
                JR      Z,COLE
COLM:           LD      HL,COLORE
                JR      COLTX
COLI:           LD      HL,COLORE+14H
                JR      COLTX
COLF:           LD      HL,COLORE+28H
                JR      COLTX
COLGB:          LD      HL,COLORE+3CH
                JR      COLTX
COLE:           LD      HL,COLORE+50H
COLTX:          LD      DE,NUMCOL
                LD      BC,0014H        ;28/01/01
                LDIR


                ;TRASMISSIONE DELLA FASE

FASTRA:         LD      HL,(FASE)
		LD      A,H
		OUT     (20H),A
		LD      A,L
		OUT     (10H),A
		
FASAUT:         LD      A,(MRIC+00H) 
		CP      01H
		JR      NZ,MAIN

                LD      A,0C2H          ;LD      A,(MEMD)        ;LUCE LED        
                LD      (DATOTX),A      ;RES     0,A             ;ORIZZONTALE
                CALL    TX485           ;LD      (MEMD),A        ;TTTT
ZOMP1:
	        CALL    CODICE
                LD      A,(MEMB)
                RES     6,A
                LD      (MEMB),A
                OUT     (PB),A
                CALL    EXECUT          ;RICERCA TTTT
                LD      A,00H           ;ESEGUITA
		LD      (MRIC+00H),A
		LD      (MRIC+02H),A
        	LD      A,60H           ;ALLA PARTE-
		LD      (GUADS1),A      ;ZA METTO GUA-
		LD      (GUADS2),A      ;DAGNO MINIMO
		LD	A,01H           ;SSDD
                LD      (MRIC+06H),A    ;SSDD

		JR      MAIN


EXECUT:         LD      A,(LINGUA)      ;RICERCATTTT
                CP      00H             ;ESEGUITA
                JR      Z,ESEM
                CP      01H
                JR      Z,ESEI
                CP      02H
                JR      Z,ESEF
                CP      03H
                JR      Z,ESEGB
                CP      04H
                JR      Z,ESEE
ESEM:           CALL    BASSA
                LD      HL,ESEGUI
                JR      ESETX
ESEI:           CALL    BASSA
                LD      HL,ESEGUI+14H
                JR      ESETX
ESEF:           CALL    BASSA
                LD      HL,ESEGUI+28H
                JR      ESETX
ESEGB:          CALL    BASSA
                LD      HL,ESEGUI+3CH
                JR      ESETX
ESEE:           CALL    BASSA
                LD      HL,ESEGUI+50H
ESETX:          CALL    TX              
                RET


		;MAIN PROGRAMMA PRINCIPALE DI CALCOLO

MAIN:          
		LD	A,(MNOPR3)	;SE E ATTIVO VADO CCDD
		CP	01H		;A CONTROLLARE CCDD
		JR	NZ,MAIN5	;IL CODICE CCDD
		CALL	VERIFICA_CODICE ;CCDD
MAIN5:
		LD	A,(MNOPR1)	;SE SEGNO OK NNFF
		CP	00H		;SALTA SE MANCA 
		JR	Z,MAIN3		;CHIAMA NOPRI
		CALL	NOPRI
		LD	A,00H		;DOPO LA CHIAMATA 
		LD	(MNOPR1),A	;ANNULLO LA SEGNALAZIONE
		
		LD	A,(MNOPR2)	;CONTO UN TOT GIRI
		CP	0AH		;SENZA SEGNO
		JR	NZ,MAIN4	;POI MUOVO LA
		
		CALL	MINIRICERCA	;PPSS
		LD	A,(MNOPR4)	;PPSS
		CP	00H
		JR	NZ,MAIN3	;PPSS

		LD	A,01H		;CCDD
		LD	(MNOPR3),A	;CCDD
MAIN4:		
		CP	0BH
		JR	C,MAIN3
		LD	A,00H
		LD	(MNOPR2),A
MAIN3:					;NNFF
		LD	A,(MEMFAS)	;DEVE PASSARE PUUU
		CP	02H		;DUE VOLTE
		JP	NZ,GIR1		;DA PIOB
		
		LD	DE,(FASES1)	;PROTEZIONE PUUU
		LD	HL,(FASES2)	;IN CASO DI
		SBC	HL,DE		;LETTURA SBAGLITA
		JP	Z,GIR1		;PUUU
		JR	NC,MAIN1
		CCF

MAIN1:			
		LD      A,(MCALER)      ;VEDE SE DEVE ABBB
		CP      00H             ;CALCOLARE O NO
		JP      Z,GIR1
		LD      A,00H
		LD      (MCALER),A

;*****************************************************

		LD      A,(ALTERR)      ;VEDE SE DEVE PUUU
		CP      00H             ;ASPETTARE
		JP	Z,MAIN2		;PUUU
		LD      A,(MKBUSY)      ;VEDO SE TASTIERA EEUU
		CP      00H             ;E' IN USO
		JP      NZ,GIR1
		
		CALL    DISPLL          
                CALL    DISPLD
		JP	GIR1
;******************************************************
MAIN2:	
		;  CALL	CONTR		 ;EEOO


		;CALCOLO RAPPORTO POSIZINE PIENO S1

                LD      DE,(ERATTU)     ;MEMORIZZO ERRORE
		LD      (ERPREC),DE     ;PRECEDENTE
                LD      A,(MSCORR)      ;WWAASALVO SEGNO
		LD      IX,PIENO1       ;DIVIDO PIENO
		LD      E,(IX+00H)      ;PER DIECI
		LD      D,(IX+01H)      ;E SOTTRAGGO
		LD      (DIVDEN),DE     ;IL RISULTATO
		LD      BC,000AH        ;A POSIZIONE
		LD      (DIVSOR),BC     ;SE IL RISULTATO
		CALL    DIVIS           ;E' NEGATIVO
		LD      IX,QUOZIE       ;VUOLE DIRE CHE
		LD      E,(IX+00H)      ;DIVIDENDO
		LD      D,(IX+01H)      ;POSIZIONE X 10
		LD      IY,POSIZ1       ;CON PIENO AVRO'
		LD      L,(IY+00H)      ;UN NUMERO MINORE
		LD      H,(IY+01H)      ;DI 0,1 PER CUI
		SBC     HL,DE           ;CARICO IN MEM.
		JR      C,RAPP10        ;RAPPORTO ZERO.
		LD      E,(IY+00H)      ;SE LA SOTTRZIONE
		LD      D,(IY+01H)      ;NON DA RISULTATO
		LD      (MOLTI),DE      ;NEGATIVO PROCEDO
		LD      A,0AH           ;NELLA DIVISIONE
		LD      (MOLPL),A       ;POSIZIONE X 10
		CALL    MOLT            ;DIVISO PIENO
		LD      IX,PROD         ;E OTTERRO'UN
		LD      C,(IX+00H)      ;RISULTATO 
		LD      B,(IX+01H)      ;COMPRESO 
		LD      (DIVDEN),BC     ;TRA 0,1 E 0,9
		LD      IY,PIENO1
		LD      E,(IY+00H)
		LD      D,(IY+01H)
		LD      (DIVSOR),DE
		CALL    DIVIS
		LD      A,(QUOZIE+00H)
		JR      RAPP11
RAPP10:         CCF
		LD      A,00H
RAPP11:         LD      (RAPPO1),A      ;VERIFICO SE E'


		;CALCOLO RAPPORTO POSIZINE PIENO S2

		LD      IX,PIENO2       ;DIVIDO PIENO
		LD      E,(IX+00H)      ;PER DIECI
		LD      D,(IX+01H)      ;E SOTTRAGGO
		LD      (DIVDEN),DE     ;IL RISULTATO
		LD      BC,000AH        ;A POSIZIONE
		LD      (DIVSOR),BC     ;SE IL RISULTATO
		CALL    DIVIS           ;E' NEGATIVO
		LD      IX,QUOZIE       ;VUOLE DIRE CHE
		LD      E,(IX+00H)      ;DIVIDENDO
		LD      D,(IX+01H)      ;POSIZIONE X 10
		LD      IY,POSIZ2       ;CON PIENO AVRO'
		LD      L,(IY+00H)      ;UN NUMERO MINORE
		LD      H,(IY+01H)      ;DI 0,1 PER CUI
		SBC     HL,DE           ;CARICO IN MEM.
		JR      C,RAPP20        ;RAPPORTO ZERO.
		LD      E,(IY+00H)      ;SE LA SOTTRZIONE
		LD      D,(IY+01H)      ;NON DA RISULTATO
		LD      (MOLTI),DE      ;NEGATIVO PROCEDO
		LD      A,0AH           ;NELLA DIVISIONE
		LD      (MOLPL),A       ;POSIZIONE X 10
		CALL    MOLT            ;DIVISO PIENO
		LD      IX,PROD         ;E OTTERRO'UN
		LD      C,(IX+00H)      ;RISULTATO 
		LD      B,(IX+01H)      ;COMPRESO 
		LD      (DIVDEN),BC     ;TRA 0,1 E 0,9
		LD      IY,PIENO2
		LD      E,(IY+00H)
		LD      D,(IY+01H)
		LD      (DIVSOR),DE
		CALL    DIVIS
		LD      A,(QUOZIE+00H)
		JR      RAPP21
RAPP20:         CCF
		LD      A,00H
RAPP21:         LD      (RAPPO2),A      ;VERIFICO SE E'

		;CALCOLO POSIZIONE TOTTALE S1

		LD      DE,(FASES1)     ;FASES1 x 10
		LD      (MOLTI),DE
		LD      A,0AH
		LD      (MOLPL),A
		CALL    MOLT
		LD      DE,(PROD)
		LD      HL,(RAPPO1)
		LD      H,00H
		ADD     HL,DE

;+++++++++++++++++++++++++++++++++++++++++++++++++++++++
         
;                LD      A,(PROVLT)      ;PRRR
;                CP      00H             ;PRRR
;                JR      NZ,PROVAL       ;PRRR

;+++++++++++++++++++++++++++++++++++++++++++++++++++++++


		LD      (POSTO1),HL


		;CALCOLO POSIZIONE TOTTALE S2
		
PROVAL:
                LD      DE,(FASES2)     ;FASES2 x 10
		LD      (MOLTI),DE
		LD      A,0AH
		LD      (MOLPL),A
		CALL    MOLT
		LD      DE,(PROD)
		LD      HL,(RAPPO2)
		LD      H,00H
		ADD     HL,DE
		LD      (POSTO2),HL
		LD      DE,(POSTO1)
		SBC     HL,DE
		JR      NC,Z1           ;SE LA MISURA E'
		CCF                     ;FATTA A CAVALLO
		LD      HL,0A000H       ;DI ZERO ENCODER
		LD      DE,(POSTO2)     ;POSTO2<POSTO1
		ADD     HL,DE           ;PER CUI SOMMO  
		LD      DE,(POSTO1)     ;A POSTO2 40960
		SBC     HL,DE           ;E RIPETO SBC.

		;(ERRORE x DECIMILLES.IN DIV.ENC.)-
		;DISTANZA IN CENTIMILLESIMI : 1000 =ERRORE
		;IN CENTESIMI

Z1:             LD      (MDO032),HL     ;HL=DISTANZA S1/S2
		LD      HL,0000H
		LD      (MDO232),HL
		LD      BC,(DMILLE)
		LD      (MRE032),BC
		LD      (MRE232),HL
		CALL    MOL32
		LD      BC,(PTO032)
		LD      DE,(PTO232)
		LD      (MINUE0),BC
		LD      (MINUE2),DE
		LD      BC,(DISTA0)
		LD      DE,(DISTA2)
		LD      (SUBTR0),BC
		LD      (SUBTR2),DE
                LD      A,00H           ;AVVISO CARICO
                LD      (ALTDIV),A      ;VALORE PER
                CALL    SOTT32          ;LONGITUD.

		CALL    DI1000
                LD      DE,(QU1000)     ;ERRORE  
                LD      (ERATTU),DE     

		LD      A,(MTASTI)      ;CONTROLLO SE
		CP      00H             ;SONO PASSATO
		JR      NZ,ERR1         ;DALLA TASIERA.
		LD      HL,0064H        ;SOMMO A ERPREC
		LD      BC,(ERPREC)     ;1mm IL RISULTATO
		ADD     HL,BC           ;LO SOTTRAGGO A
		SBC     HL,DE           ;ERATTU SE CARRY
		JR      NC,ERR2         ;SE VI E' STATA  
		CCF                     ;UNA LETTURA SBAL-
		LD      BC,(ERPREC)     ;LATA LA IGNORO.
		LD      (ERATTU),BC     

		LD	A,(SALTO)	;SE SALTO E'	EEUU
		CP	00H		;ZERO CORREGGO EEUU
		JR	Z,ERR7		;SEMPRE EEUU

		LD      A,(CONSAL)      ;CONTROLLA CHE NON
		DEC     A               ;CHE NON RIMANGA
		LD      (CONSAL),A      ;IN BLOCCO PER PIU'
		CP      00H             ;DI N GIRI MEMO- 
		JR      Z,ERR3          ;RIZZATI IN SALTO  
		JP      GIR1            ;E POI
ERR3:           LD      (ERATTU),DE     ;RICARICA L'ULTIMO
		LD      (ERPREC),DE     ;ERRORE LETTO
		JR      ERR2            
ERR1:           DEC     A               ;ATTESA 4 GIRI SE
		LD      (MTASTI),A      ;PASSATO DA TATSI.
ERR2:           LD      A,(SALTO)       ;CARICA I GIRI DI
		LD      (CONSAL),A      ;ATTESA.
ERR7:		LD      A,(MKBUSY)      ;VEDO SE TASTIERA EEUU
		CP      00H             ;E' IN USO
		JP      NZ,GIR1

                CALL    LMEDIA          ;WWAA

ERR5:           CALL    DISPLL          
                CALL    DISPLD         
ERR4:
		LD      HL,(BINSET)
                LD      (DISPRE),HL     
                LD      A,01H           ;SEGNALAZ.DISPLAY
		LD      (MDBUSY),A      ;OCCUPATO DA ERROR
                CALL    TRAVER
                LD      A,01H
                LD      (TMEM4),A
                CALL    CORTRA

		;CONTROLLO SOGLIA INSERZIONE

SOGLIN:         CALL    VELO
                LD      HL,(ISTVEL)     ;VVVVLD      HL,(VELMED)     
		LD      DE,(INSER)      
		SBC     HL,DE            
		JR      C,SOGLI2

SOGLI1:         LD      A,00H           ;FFLL
                LD      (PROTEZ),A      ;FFLL
                JR      ALLA1 
SOGLI2:         CCF
             	LD      A,05H           ;BLOCCO ALL.
		LD      (CONALL),A
		;LD      A,07H           ;SE INSER E'
		;LD      (MATTES),A      ;MAGGIORE

		CALL	INC_CICLO	;AACC

		LD      A,(MEMC)        ;BLOCC0 LA COR-
		RES     3,A             ;REZIONE E AL
		LD      (MEMC),A        ;TANDO I CICLI
		OUT     (PC),A          ;DI ATTESA.
		BIT     2,A             ;SE NON E' IN
                JP      Z,GIRO          ;AUTO SALTO
		CALL    LOWSPE          
                JP      GIRO

                ;CONTROLLO SOGLIA ALLARME CIRCONFERENZIALE 

ALLA1:          LD      A,(ALLAR)       ;SE ALLARME E'
		CP      00H             ;MESSO A ZERO
		JR      Z,NOALL         ;SALTA.
		LD      HL,(ALLAR)      ;CONTROLLO SE 
		LD      DE,(ERMEDI)     ;L'ERRORE HA SU-
		SBC     HL,DE           ;PERATO LA SOGLIA
		JR      NC,NOALL        ;DI ALLARME
		CCF
		LD      A,(MEMC)        ;SE SONO IN
		BIT     2,A             ;MANUALE SALTO
		JR      Z,NOALL
		LD      A,(CONALL)      ;CONTO 5 AVVISI
		CP      00H             ;PRIMA DI ATTIVA- 
		JR      Z,ALLA2         ;RE L'ALLARME
		DEC     A
		LD      (CONALL),A
		JR      GIRO
ALLA2:          LD      A,(MEMC)
		SET     3,A             ;ATTIVO ALLARME
		LD      (MEMC),A
		OUT     (PC),A
		JR      GIRO
NOALL:          LD      A,(MEMC)
		RES     3,A             ;DISATTIVO ALLARM
		LD      (MEMC),A
		OUT     (PC),A
		LD      A,05H           ;CARICO 5 AVVISI
		LD      (CONALL),A      ;DI ALLARME


                ;CONTROLLO SOGLIA ALLARME TRASVERSALE 

	
                LD      A,(ALLAR)       ;SE ALLARME E'
		CP      00H             ;MESSO A ZERO
                JR      Z,NOALT         ;SALTA.
		LD      HL,(ALLAR)      ;CONTROLLO SE 
                LD      DE,(TERMED)     ;L'ERRORE HA SU-
		SBC     HL,DE           ;PERATO LA SOGLIA
                JR      NC,NOALT        ;DI ALLARME
		CCF
		LD      A,(MEMC)        ;SE SONO IN
		BIT     2,A             ;MANUALE SALTO
                JR      Z,NOALT
                LD      A,(CONALT)      ;CONTO 5 AVVISI
		CP      00H             ;PRIMA DI ATTIVA- 
                JR      Z,ALLAT         ;RE L'ALLARME
		DEC     A
                LD      (CONALT),A
		JR      GIRO
ALLAT:          LD      A,(MEMC)
		SET     3,A             ;ATTIVO ALLARME
		LD      (MEMC),A
		OUT     (PC),A
		JR      GIRO
NOALT:          LD      A,(MEMC)
		RES     3,A             ;DISATTIVO ALLARM
		LD      (MEMC),A
		OUT     (PC),A
		LD      A,05H           ;CARICO 5 AVVISI
                LD      (CONALT),A      ;DI ALLARME

GIRO:           CALL    CORREZ

		JP      GIR1		;SSPP

		;ROUTINE DI ATTESA

GIR2:           CALL    CODICE            

GIR1:           EI


		LD	A,(LIMIT)	;RRFF
		CP	00H
		JR	Z,G13
		CP	0D4H		;FINE CORSA 
		JR	Z,G2		;NON ATTIVI
		CP	0D7H		
		JR	Z,G10		;FC_DX
		CP	0D8H
		JR	Z,G11		;FC_SX
		CP	0DBH
		JR	Z,G12
		JR	G13
G2:		
		LD	A,00H
		LD	(LIMIT),A
		JR	G13
G10:
		CALL	FINECO
		CALL    BANDAS
		JR	G13
G11:
		CALL	FINECO
		CALL    BANDAD		;RRFF
		JR	G13
G12:		
		CALL	EXECUT


G13:
		LD	A,(CONTGIR)	;RRFF
		CP	0FDH		;200
		JR	NZ,G9

		LD	A,01H		;SEGNALO VERIFICA CCGG
		LD	(TESTCO),A	;CODICE CICLICA
		CALL	VERIFICA_CODICE ;CCGG

		LD      A,0E0H          ;RICHIESTA DI        
                LD      (DATOTX),A      ;CONTROLLO 
                CALL    TX485           ;FINE CORSA
G9:          

		LD      A,(MKBUSY)      ;SE STO USANDO
		CP      01H             ;LA TASTIERA
		JR      NZ,G7           ;BLOCCO LE 
		CALL	RESEPC
G7:            
		LD      BC,1FFH       ;AACC
G1:             DEC     BC             ;
                LD      A,B            ;
                OR      C              ;
                JR      NZ,G1          ;
		
		LD	A,(WATCH)	;INCREMENTO IL CONTATORE WWDD
		INC	A		;DI WATCH DOG SE
		LD	(WATCH),A	;PER QUALSIASI CASO
		CP	0FFH		;NON PASSA DA  
		JR	NZ,G6		;CTC0 SCATTA
		LD	(WATCH1),A	;IL RESET DI
		JP	VIA		;WATCH DOG WWDD
G6:
		LD      A,(MKBUSY)      ;SE TASTIERA 
		BIT     0,A             ;IN USO SALTA
		JR      NZ,G3
                LD      BC,01FFFH
G4:             DEC     BC
                LD      A,B
                OR      C
                JR      Z,G8
                IN      A,(PB)          ;SOLO QUANDO LA
		BIT     4,A             ;MACCHINA GIRA
		JR      Z,G4            ;ESEGUE IL CON-
G5:             DEC     BC              ;TROLLO SE NO
                LD      A,B             ;ASPETTA E
                OR      C               ;METTE ZERO
                JR      Z,G8            ;ALLA VELOCITA'
                IN      A,(PB)          
                BIT     4,A             
		JR      NZ,G5
                JR      G3
G8:             LD      A,48
                LD      (NUMCOL+11H),A
                LD      (NUMCOL+12H),A
                LD      (NUMCOL+13H),A
                CALL    INISI
                LD      HL,NUMCOL
                CALL    TX
G3:             JP      FASAUT




                
                ;GESTIONE TASTIERA


PIOA:           PUSH    BC
		PUSH    DE
		PUSH    HL
		PUSH    AF
		PUSH    IX
		PUSH    IY
		LD      A,04H           ;SERVE IN ERR1
		LD      (MTASTI),A      ;PER E ELIMINARE
		LD      A,(MEMA)        ;IL SALTO QUANDO 
		RES     7,A             ;DA TASTIERA IN
		OUT     (PA),A          ;AUTO O IN MANUA-
		LD      (MEMA),A        ;LE SI FA UN GROS-
                LD      DE,02FFH        ;SO SPOSTAMENTO.   TTTT
KRIT1:          DEC     DE                
		LD      A,D
		OR      E
		JR      NZ,KRIT1
		IN      A,(PA)          
		BIT     4,A
		JP      NZ,ESCI
                CALL    SERITA
                LD      C,(HL)          ;DA LETTURA SE 
                LD      DE,050FFH       ;SONO EGUALI
KRIT2:          DEC     DE              ;PROCEDO SE NO 
		LD      A,D             ;ESCO
		OR      E
		JR      NZ,KRIT2
		IN      A,(PA)
		BIT     4,A
		JP      NZ,ESCI
                CALL    SERITA
		LD      A,(HL)          ;SECONDA LETTURA
                CP      C               ;C= PRIMA LETTU-
                JP      NZ,ESCI         ;RA
		LD      A,(MDBUSY)      ;SE IL DISPLAY
		CP      00H             ;E' OCCUPATO 
		JR      Z,PIOA1         ;DALL'ERRORE DI
		LD      A,00H           ;REGISTRO LO
		LD      (MDBUSY),A      ;CANCELLO
		LD      IX,BINSET+06H
		LD      (IX+00H),A
		LD      (IX+01H),A
		LD      (IX+02H),A
		LD      (IX+03H),A
		LD      (IX+04H),A
		LD      (BINSET+10H),A
PIOA1:          LD      A,01H           ;SEGNALA L'USO
		LD      (MKBUSY),A      ;DELLA TATSIERA
		LD      A,(HL)          
		CP      0AH
                JP      Z,CLEA1
		CP      0BH
		JP      Z,ENTE1
		LD      A,(MEM0)        ;CONTROLLO SE
		BIT     0,A             ;INSERITE FUN-
		JP      NZ,KBRD1        ;ZIONI
		LD      A,(MEM1)
		BIT     0,A
		JP      NZ,KBRD1
		LD      A,(MEM2)
		BIT     0,A
		JP      NZ,KBRD1
		LD      A,(MEM3)
		BIT     0,A
		JP      NZ,KBRD1
		LD      A,(MEM6)
		BIT     0,A
		JP      NZ,KBRD1
		LD      A,(MEM7)
		BIT     0,A
		JP      NZ,KBRD1
                LD      A,(MEM15)       ;CENTRATURA TTTT
                BIT     0,A             ;MECCANICA
		JP      NZ,KBRD1

		LD      A,(HL)          ;CONTINUO LA
		CP      0DH             ;LA CODIFICA
                JP      Z,MENO1         ;DELLA TASTIERA
		CP      0CH
                JP      Z,PIU1
                CP      0EH             ;T24
                JP      Z,MANC
                CP      10H             ;T24
                JP      Z,AUTOC
                CP      11H
                JP      Z,MANT
                CP      12H
                JP      Z,AUTOT
                CP      13H
                JP      Z,OPERA
                CP      14H
                JP      Z,TRAS
                CP      16H
                JR      NZ,PIOA2        
                CALL    MODPA
PIOA2:          CP      17H
                JR      NZ,PIOA3        ;T24  
                CALL    TEST
PIOA3:          LD      A,(MEMTF)       ;CONTROLLO SE
		CP      00H             ;PIGIATO PRECE-
                JP      NZ,FUNZI        ;DENTEMENTE F
		LD      A,(HL)

                CP      15H             ;TTTT OOOO
                JP      Z,PUNTO         ;TTTT OOOO

		CP      0FH
		JP      Z,FUNZI
		CP      0AH             ;SE NON E' UN
		JR      NC,NONUM        ;NUMERO SALTA
		CALL    MUOVO
                EXX                     ;D111
                CALL    BIOTTD
                XOR     A               ;CALL    BIOTT
NONUM:          LD      (MEMTF),A       ;MEMORIZZA
		JP      ESCI            ;LA FUNZIONE

CLEA1:          LD      A,00H           ;CANCELLA
		LD      IX,BINSET+06H   ;LE MEMORIE
		LD      (IX+00H),A      ;TEMPORANEE
		LD      (IX+01H),A
		LD      (IX+02H),A
		LD      (IX+03H),A
		LD      (IX+04H),A
		LD      (BINSET+10H),A  ;E LA LETTERA
		LD      (MEM0),A        ;AZZERO MEMORIE
		LD      (MEM1),A
		LD      (MEM2),A        
		LD      (MEM3),A

                LD      (MEM5),A        ;OOOO

		LD      (MEM6),A
		LD      (MEM7),A
                LD      (MEM15),A       ;TTTT
		LD      (MRIC+00H),A
		LD      (MRIC+02H),A
		LD      (MRIC+04H),A
                LD      (MRIC+06H),A     ;TTTT
		LD      (MEMTF),A       ;AZZERO MEM.
		LD      (MEMID),A       ;TASTO F E INIZIA-
		LD      (MDATER),A      ;LIZAZZIONE DISP.
		LD      (MKBUSY),A      ;DATA ERROR E

                LD      (USOSCI),A      ;OOOO
                LD      (LIMIT),A       ;RRFF
                LD      A,(SEQSEG)
                ADD     A,48
                LD      (NUMCOL+09H),A  
                CALL    INISI           
                LD      HL,NUMCOL
                CALL    TX

	        JP      ESCI

MENO1:          LD      A,(MEMC)        ;SE MANUALE
                BIT     2,A             ;MOTORE RITARDO
                JP      Z,MANRIT
                LD      DE,0000H
                LD      (BINSET),DE
                LD      A,(LINGUA)
                CP      00H
                JR      Z,RITM
                CP      01H
                JR      Z,RITI
                CP      02H
                JR      Z,RITF
                CP      03H
                JR      Z,RITGB
                CP      04H
                JR      Z,RITE
RITM:           CALL    INISI
                LD      HL,RITARD
                JR      RITTX
RITI:           CALL    INISI
                LD      HL,RITARD+14H
                JR      RITTX
RITF:           CALL    INISI
                LD      HL,RITARD+28H
                JR      RITTX
RITGB:          CALL    INISI
                LD      HL,RITARD+3CH
                JR      RITTX
RITE:           CALL    INISI
                LD      HL,RITARD+50H
RITTX:          CALL    TX              
                LD      A,40H           ; -
		LD      (BINSET+10H),A
                CALL    BIN7
		JP      ESCI

PIU1:           LD      A,(MEMC)        ;SE MANUALE 
                BIT     2,A             ;MOTORE AVANTI
                JP      Z,MANAVA
                LD      DE,0000H
                LD      (BINSET),DE
                LD      A,(LINGUA)
                CP      00H
                JR      Z,AVAM
                CP      01H
                JR      Z,AVAI
                CP      02H
                JR      Z,AVAF
                CP      03H
                JR      Z,AVAGB
                CP      04H
                JR      Z,AVAE
AVAM:           CALL    INISI
                LD      HL,AVANTI
                JR      AVATX
AVAI:           CALL    INISI
                LD      HL,AVANTI+14H
                JR      AVATX
AVAF:           CALL    INISI
                LD      HL,AVANTI+28H
                JR      AVATX
AVAGB:          CALL    INISI
                LD      HL,AVANTI+3CH
                JR      AVATX
AVAE:           CALL    INISI
                LD      HL,AVANTI+50H
AVATX:          CALL    TX              
                LD      A,70H           ; +
		LD      (BINSET+10H),A
                CALL    BIN7
		JP      ESCI

                
OPERA:          LD      A,(MEMC)        ;SE MANUALE
                BIT     4,A             ;TRAVERS MOTORE
                JP      Z,MANOPE        ;LATO OPERATORE
                LD      DE,0000H
                LD      (BINSET),DE
                LD      A,(LINGUA)
                CP      00H
                JR      Z,OPEM
                CP      01H
                JR      Z,OPEI
                CP      02H
                JR      Z,OPEF
                CP      03H
                JR      Z,OPEGB
                CP      04H
                JR      Z,OPEE
OPEM:           CALL    INISI
                LD      HL,OPERAT
                JR      OPETX
OPEI:           CALL    INISI
                LD      HL,OPERAT+14H
                JR      OPETX
OPEF:           CALL    INISI
                LD      HL,OPERAT+28H
                JR      OPETX
OPEGB:          CALL    INISI
                LD      HL,OPERAT+3CH
                JR      OPETX
OPEE:           CALL    INISI
                LD      HL,OPERAT+50H
OPETX:          CALL    TX              
                LD      A,3FH           ; O
		LD      (BINSET+10H),A
                CALL    BIN7
		JP      ESCI

TRAS:           LD      A,(MEMC)        ;MANUALE TRAV
                BIT     4,A             ;MOTORE LATO
                JP      Z,MANTRA        ;TRASMISSIONE
                LD      DE,0000H
                LD      (BINSET),DE
                LD      A,(LINGUA)
                CP      00H
                JR      Z,TRAM
                CP      01H
                JR      Z,TRAI
                CP      02H
                JR      Z,TRAF
                CP      03H
                JR      Z,TRAGB
                CP      04H
                JR      Z,TRAE
TRAM:           CALL    INISI
                LD      HL,TRASMI
                JR      TRATX
TRAI:           CALL    INISI
                LD      HL,TRASMI+14H
                JR      TRATX
TRAF:           CALL    INISI
                LD      HL,TRASMI+28H
                JR      TRATX
TRAGB:          CALL    INISI
                LD      HL,TRASMI+3CH
                JR      TRATX
TRAE:           CALL    INISI
                LD      HL,TRASMI+50H
TRATX:          CALL    TX              
                LD      A,78H           ; t
		LD      (BINSET+10H),A
                CALL    BIN7
		JP      ESCI



ENTE1:          LD      A,(MEM0)
		BIT     0,A
		JP      NZ,FUN3
		LD      A,00H           ;AZZERO MEM.
		LD      (MEM0),A
		LD      (MEM1),A
		LD      (MEM2),A
		LD      (MEM3),A

                LD      (MEM5),A        ;OOOO

		LD      (MEM6),A
		LD      (MEM7),A
                LD      (MEM15),A       ;TTTT
                LD      (LIMIT),A       ;RRFF

		LD      (MRIC+00H),A
		LD      (MRIC+02H),A
		LD      (MRIC+06H),A
		;LD      (MRIC+08H),A	SSDD
		LD      (MEMTF),A       ;TASTO F E INI-
		LD      (MEMID),A       ;ZIALIZZAZIONE
		CALL    BCDBIN          ;DISPLAY
		LD      A,(BINSET+10H)  ;SE SELEZIONATO
		CP      40H             ;MENO SALTO
		JP      Z,ENTE3         ;SE SELEZIONATO
		CP      70H             ;PIU' SALTO
		JP      Z,ENTE3
                CP      3FH             ;SE SELEZIONATO
                JP      Z,ENTE3         ;OPERATORE SALTO
                CP      78H             ;SE SELEZIONATO
                JP      Z,ENTE3         ;TRASMISS. SALTO
		CP      73H             ;SE SELEZIONATO
		JP      Z,ENTE4         ;P SALTO
                CP      39H             
                JP      NZ,ENTE2        
                CALL    INTCOR          ;AGGIORNA CICLI
                CALL    TINTCO          ;FOFF
		LD      DE,(CILIN)      ;MOLTIPLICO PER
		LD      (MOLTI),DE      ;10 IL CILINDRO
		LD      A,0AH           ;PER POTER USARE
		LD      (MOLPL),A       ;AGGIUSTAMENTO
		CALL    MOLT            ;DECIMALE
		LD      BC,(PROD)
		LD      (CILMOL),BC     ;CILINDRO x 10
		LD      (MDO032),BC
		LD      DE,0000H        
		LD      (MDO232),DE     
		LD      BC,03E8H         
		LD      (MRE032),BC      
		LD      (MRE232),DE     
		CALL    MOL32
		LD      BC,(PTO032)     ;CILNDRO X 10000
		LD      DE,(PTO232)
		LD      (EDEND0),BC
		LD      (EDEND2),DE
		CALL    DIV32
		LD      DE,(QUOZ32)
		LD      (DMILLE),DE     ;DECIMILLESIMI
		LD      (DIVDEN),DE     ;CALCOLO QUANTI
		LD      BC,000AH        ;MILLESIMI CI 
		LD      (DIVSOR),BC     ;SONO IN UN
		CALL    DIVIS           ;CILINDRO
		LD      DE,(QUOZIE)
		LD      (MILLES),DE     ;MILLESIMI
		LD      (DIVDEN),DE     ;DIVIDO PER 10
		LD      BC,000AH        ;PER AVERE 
		LD      (DIVSOR),BC     ;I CENTESIMI
		CALL    DIVIS           
		LD      DE,(QUOZIE)
		LD      (CENTES),DE
		LD      DE,(CILIN)      ;DIVISIONE DEL
		LD      (DIVDEN),DE     ;CILNDRO PER 10
		LD      BC,000AH
		LD      (DIVSOR),BC
		CALL    DIVIS
		LD      DE,(QUOZIE)
		LD      (CILDIV),DE
		LD      DE,2710H        ;10000/DMILLE=                                     
		LD      (DIVDEN),DE     ;IMPULSI ENCO-
		LD      DE,(DMILLE)     ;DER PER 1mm
		LD      (DIVSOR),DE     
		CALL    DIVIS           
		LD      DE,(QUOZIE)     

		LD      (UNOMIL),DE     
		LD      DE,4E20H        ;=20000
		LD      (DIVDEN),DE
		LD      BC,(MILLES)
		LD      (DIVSOR),BC
		CALL    DIVIS
		LD      HL,(QUOZIE)
		LD      (MILL20),HL     ;20mm
		ADD     HL,HL
		LD      (MILL40),HL     ;40mm 

                LD      DE,0E4EH        ;4000x4096=  
                LD      (MDO032),DE     ;1638400
                LD      DE,0000H        ;60\1638400=
                LD      (MDO232),DE     ;0,000003662
                LD      (MRE232),DE     ;3662=0E4EH
                LD      DE,(CILIN)
                LD      (MRE032),DE
                LD      A,02H           
                LD      (ALTDIV),A      
                CALL    MOL32
                CALL    DI1000
                LD      BC,(QU1000)
                LD      (COSVEL),BC     ;COSTANTE VEL. 


		;CALCOLO VALORI PER RICERCA CODICE
		;AL CAMBIO DI FORMATO

                ;####################################
                ;# IL SEGNO DEVE ESSERE 20% IN PIU  #   
                ;# DI UNOMIL LA DISTANZA DEL CODICE #
                ;# E' DI BIANCO E' DI 13mm DATO CHE #
                ;# GLI IMPULSI SONO 2048 MOLTIPLICO #
                ;# PER LA META'ARROTONDATA CIOE' 6  #
                ;# PER AVERE SPAZI1 E UN 20% IN     #
                ;# MENO PER AVERE SPAZI2            #
                ;####################################

                LD      DE,(UNOMIL)     ;OOOO

		SRL     E               ;DIVISO DUE

                LD      A,E             ;IMPULSI DA OOOO
                INC     A               ;2048 PER mm+1
                LD      (IMPMIL),A      ;OOOO


                LD      DE,(UNOMIL)     ;PUUU  TTTT
                LD      A,E
                LD      (MOLPL),A
                LD      DE,0014H        ;20
                LD      (MOLTI),DE
                CALL    MOLT
                LD      DE,(PROD)
                LD      (DIVDEN),DE      
                LD      BC,64H          
                LD      (DIVSOR),BC      
                CALL    DIVIS           
                LD      BC,(QUOZIE)     
                LD      HL,(UNOMIL)
                ADC     HL,BC
                LD      (SEGNO),HL      ;TTTT

                
                LD      (MOLTI),HL
                LD      A,05H           ;13 mm SCARSI RRII
                LD      (MOLPL),A       ;DI SPAZIO
                CALL    MOLT            ;BIANCO
                LD      DE,(PROD)       ;PUUU
                LD      (SPABIA),DE     ;PUUU TTTT

		LD      DE,(MILL40)     ;MILL40:2=A
		SRL     E               ;40mm IN
		LD      A,E             ;IMPULSI DA 2048
		LD      (SPAZ40),A


                ;CALCOLO POSIZIONE GATE1 NELL'OSCILLOSCOPIO OOOO

                LD      HL,100H         ;OOOO
                LD      (DIVDEN),HL     ;DIVIDO IL
                LD      BC,(IMPMIL)     ;NUMERO DI 
                LD      B,00H           ;IMPULSI TRA IL
                LD      (DIVSOR),BC     ;TRIGGER E LA
                CALL    DIVIS           ;FASE PER IMP-
                LD      DE,(QUOZIE)     ;MIL+1 IL VALORE
                LD      (BINSET),DE     ;OTTENUTO LO
                CALL    AGGIUS          ;AGGIUSTO PER
                LD      DE,(QUOZIE)     ;ELIMINARE LE 
                LD      (DIVDEN),DE     ;UNITA' E POI
                LD      BC,000AH        ;DIVIDO PER 10
                LD      (DIVSOR),BC     ;E OTTENGO LA
                CALL    DIVIS           ;POSIZIONE DEL
                LD      DE,(QUOZIE)     ;CARATTERE DOVE
                LD      (POSGA1),DE     ;INIZIA IL GATE
                LD      A,01H           
                LD      (MAGGI1),A      ;AGGIUSTAMENTO
                LD      DE,(AMPGA)      ;PER PORTARE
                LD      (QUOZIE),DE     ;A 0 O 5
                LD      (BINSET),DE     ;AMPGATE PER
                CALL    AGGIUS          ;L'OSCILLOSCOPIO
                LD      DE,(QUOZIE)     ;E SAPERE I 
                LD      (GATOSC),DE     ;CARATTERI OC-


ENTE2:          JP      CLEA1


ENTE3:          LD      A,(BINSET+10H)   
                CP      40H
		JR      Z,ENTE31
                CP      70H
                JR      Z,ENTE31
                CALL    TSPOST
		JP      CLEA1
ENTE31:         CALL    SPOSTA
                CALL    TSPOST          
		JP      CLEA1

ENTE4:       
	        LD      A,01H           ;PER SALTARE SSDD
                LD      (MRIC+04H),A    ;CALL CODICE SSDD

		LD      DE,0FH          ;FISSO A 15mm
                LD      (AMPGA),DE      ;OOOO

                LD      (MOLTI),DE      ;AMPIEZZA GATE
		LD      A,64H           ;PER 100
		LD      (MOLPL),A
		CALL    MOLT
		LD      DE,(PROD)       ;AMPIEZA IN CENT.
		LD      (DIVDEN),DE
		LD      BC,(CENTES)
		LD      (DIVSOR),BC
		CALL    DIVIS           ;AMPIEZZA GATE IN
		LD      DE,(QUOZIE)     ;IMPULSI ENCODER.
ENTE41:         LD      (AMPIMP),DE     

                LD      A,(AMPIMP)      ;OOOO
                SRL     A
                LD      (AMPMEZ),A      ;OOOO

                LD      (MOLTI),DE
                LD      A,25H           ;VALORE PER AVERE
                LD      (MOLPL) ,A      ;IL SEGNO TRINGO-
                CALL    MOLT            ;LARE IN MEZZO
                LD      DE,(PROD)       ;AL GATE 23/3
		LD      (DIVDEN),DE
		LD      BC,0064H
		LD      (DIVSOR),BC
		CALL    DIVIS
		LD      DE,(QUOZIE)
		LD      (MEZGA),DE      ;CALCOLO DEL
		LD      (DIVDEN),DE     ;GATE CI STANNO
		LD      BC,(AMPIMP)     ;IN UN GIRO E
		LD      (DIVSOR),BC     ;NE SOTTRAGGO
		CALL    DIVIS           ;1 E IL RISUL-
		LD      HL,(QUOZIE)     ;TATO LO SALVO.
		LD      DE,7D0H         ;2000 = 20mmX100
		LD      (MOLTI),DE
		LD      A,(SEQSEG)
		LD      (MOLPL),A
		CALL    MOLT
		LD      HL,(PROD)
		SBC     HL,DE
		LD      (DISTAN),HL
		LD      (MDO032),HL     ;CALCOLO
		LD      BC,0000H        ;DISTANZA IN
		LD      (MDO232),BC     ;CENTIMILLESIMI
		LD      HL,03E8H
		LD      (MRE032),HL
		LD      (MRE232),BC
		CALL    MOL32
		LD      HL,(PTO032)
		LD      (DISTA0),HL     ;DISTANZA IN
                LD      (TDIST0),HL     ;CENTIMILLESIMI
                LD      HL,(PTO232)     ;SIA PER LONG.
                LD      (DISTA2),HL     ;CHE PER TRAVERS
                LD      (TDIST2),HL
                CALL    INTCOR          ;FOFF
                CALL    TINTCO          ;FOFF
ENTE42:
                LD      A,01H           ;PER AVERLO OOOO
                LD      (MAGGI1),A      ;ANCHE SOLO IN
                LD      DE,(AMPGA)      ;CAMBIO AMPIEZZA
                LD      (QUOZIE),DE     ;GATE
                LD      (BINSET),DE     ;VEDI SOPRA
                CALL    AGGIUS          ;IN CALCOLO GATE
                LD      DE,(QUOZIE)     ;PER OSCILLO. 
                LD      (GATOSC),DE     


                ;CALCOLO POSIZIONE GATE2 NELL'OSCILLOSCOPIO OO22

                LD      A,(SEQSEG)      ;OO22
                CP      02H
                JR      NZ,SEQUE3
                LD      A,09H
                JR      SEQFIN
SEQUE3:         CP      03H
                JR      NZ,SEQUE4
                LD      A,0CH
                JR      SEQFIN
SEQUE4:         CP      04H
                JR      NZ,SEQUE5
                LD      A,0FH
                JR      SEQFIN
SEQUE5:         CP      05H
                JR      NZ,SEQUE6
                LD      A,12H
                JR      SEQFIN
SEQUE6:         CP      06H
                JR      NZ,SEQUE7
                LD      A,16H
                JR      SEQFIN
SEQUE7:         CP      07H
                JR      NZ,SEQUE8
                LD      A,19H
                JR      SEQFIN
SEQUE8:         CP      08H
                JR      NZ,SEQUE9
                LD      A,1CH
                JR      SEQFIN
SEQUE9:         CP      09H
                JR      NZ,SEQERR
                LD      A,20H
SEQFIN:         LD      (POSGA2),A
                JR      SEQEND
SEQERR:         CALL    ERROR
                CALL    RITDIS
SEQEND:         JP      CLEA1




FUNZI:          LD      A,00H           ;RESETTO PORTA C
		LD      (MEMC),A        ;IMPONENDO MANUALE
                OUT     (PC),A
		LD      A,(HL)          ;ASPETTO CHE    
		LD      (MEMTF),A       ;VENGA SCELTA
                LD      A,(LINGUA)
                CP      00H
                JR      Z,FUNM
                CP      01H
                JR      Z,FUNI
                CP      02H
                JR      Z,FUNF
                CP      03H
                JR      Z,FUNB
                CP      04H
                JR      Z,FUNE
FUNM:           CALL    INISI
                LD      HL,FUNDIS
                JR      FUNTX
FUNI:           CALL    INISI
                LD      HL,FUNDIS+14H
                JR      FUNTX
FUNF:           CALL    INISI
                LD      HL,FUNDIS+28H
                JR      FUNTX
FUNB:           CALL    INISI
                LD      HL,FUNDIS+3CH
                JR      FUNTX
FUNE:           CALL    INISI
                LD      HL,FUNDIS+50H
FUNTX:          CALL    TX              

                LD      A,(MEMTF)
		CP      00H
		JR      Z,FUNZ0
		CP      01H
		JP      Z,FUNZ1
		CP      02H
		JP      Z,FUNZ2
		CP      03H
		JP      Z,FUNZ3
		CP      04H
		JP      Z,FUNZ4
		CP      05H
		JP      Z,FUNZ5
		CP      06H
		JP      Z,FUNZ6
		CP      07H
		JP      Z,FUNZ7
                CP      15H             ;TTTT
                JP      Z,FUNZ15        ;TTTT
                JP      ESCI            
		
	     
		;AZZERAMENTO DOPO REGISTRO MANUALE

FUNZ0:          LD      A,00H           ;IMPONGO MANUALE
		LD      (MEMC),A        
                OUT     (PC),A
		LD      A,01H
		LD      (MEM0),A
                LD      A,(LINGUA)
                CP      00H
                JR      Z,AZZM
                CP      01H
                JR      Z,AZZI
                CP      02H
                JR      Z,AZZF
                CP      03H
                JR      Z,AZZGB
                CP      04H
                JR      Z,AZZE
AZZM:           CALL    INISI
                LD      HL,AZZER1
                JR      AZZTX
AZZI:           CALL    INISI
                LD      HL,AZZER1+14H
                JR      AZZTX
AZZF:           CALL    INISI
                LD      HL,AZZER1+28H
                JR      AZZTX
AZZGB:          CALL    INISI
                LD      HL,AZZER1+3CH
                JR      AZZTX
AZZE:           CALL    INISI
                LD      HL,AZZER1+50H
AZZTX:          CALL    TX              
                CALL    BASSA
                LD      HL,AZZER2
                CALL    TX

		JP      ESCI

FUN3:           LD      BC,(ERATTU)     ;CARICO L'ERRORE
		LD      (SHIFT),BC      ;LETTO IN SHIFT                                          
		LD      A,(MSCORR)      ;VEDO SE IN AVANTI
		CP      01H             ;O IN RITARDO E
		JR      Z,FUN1          ;CHIAMO LA ROUTINE
		LD      A,70H           ;SPOSTA PER CEN-
		LD      (PIUMEN),A      ;TRARLO NEL GATE.
		JR      FUN2
FUN1:           LD      A,40H
		LD      (PIUMEN),A
FUN2:           CALL    SPOSTA
                LD      A,01H           ;AVVISO DI AZZERA-
                LD      (MAZTRA),A      ;RE TRAVERS
		JP      CLEA1

		              		
		;PARAMETRI CILINDRO

FUNZ1:          LD      A,00H           ;IMPONGO MANUALE
		LD      (MEMC),A
                OUT     (PC),A
		LD      A,01H
		LD      (MEM1),A
		LD      DE,(CILIN)
		LD      (BINSET),DE
                LD      A,(LINGUA)
                CP      00H
                JR      Z,CILM
                CP      01H
                JR      Z,CILI
                CP      02H
                JR      Z,CILF
                CP      03H
                JR      Z,CILGB
                CP      04H
                JR      Z,CILE
CILM:           CALL    INISI
                LD      HL,FORCIL
                JR      CILTX
CILI:           CALL    INISI
                LD      HL,FORCIL+14H
                JR      CILTX
CILF:           CALL    INISI
                LD      HL,FORCIL+28H
                JR      CILTX
CILGB:          CALL    INISI
                LD      HL,FORCIL+3CH
                JR      CILTX
CILE:           CALL    INISI
                LD      HL,FORCIL+50H
CILTX:          CALL    TX              
		LD      A,39H           ;C
		LD      (BINSET+10H),A
		CALL    BIN7
		JP      ESCI
KBRD1:          LD      A,(MEMA)        
                RES     2,A
                OUT     (PA),A
                SET     2,A
                OUT     (PA),A
                LD      D,00H           
                LD      B,08H           
KBRD2:          LD      A,(MEMA)        
                RES     1,A
                OUT     (PA),A
                IN      A,(PA)
                RR      A     
                RL      D
                SET     1,A
                SET     2,A
                OUT     (PA),A
                LD      (MEMA),A
                DJNZ    KBRD2
                LD      A,D
                AND     1FH
                NOP                             ;CALL    CAG
		LD      L,A
		LD      H,00H
		LD      DE,TABLE
		ADD     HL,DE
		LD      A,(HL)
		CP      0AH
		JP      Z,CLEA1
		CP      0BH
		JP      Z,ENTE1
		CP      0AH             ;SE NON NUMERO
		JP      NC,ESCI         ;ESCI
		LD      B,A
		LD      A,(MEMID)       ;SE E' IL PRIMO
		BIT     0,A             ;NUMERO INSERITO
		JR      NZ,ADIS1        ;INIZIALIZZA IL
		LD      A,01H           ;DISPLAY METTENDO
		LD      (MEMID),A       ;DEGLI ZERI
		CALL    INIZDI
ADIS1:          LD      A,B
		CALL    MUOVO
                EXX                     ;D2222
                CALL    BIOTTD
                XOR     A               ;CALL    BIOTT
		JP      ESCI

		;PARAMETRI ALLARME

FUNZ2:          LD      A,00H           ;IMPONGO MANUALE
		LD      (MEMC),A
                OUT     (PC),A
		LD      A,01H
		LD      (MEM2),A
		LD      DE,(ALLAR)
		LD      (BINSET),DE
                LD      A,(LINGUA)
                CP      00H
                JR      Z,SOAM
                CP      01H
                JR      Z,SOAI
                CP      02H
                JR      Z,SOAF
                CP      03H
                JR      Z,SOAGB
                CP      04H
                JR      Z,SOAE
SOAM:           CALL    INISI
                LD      HL,SOALLR
                JR      SOATX
SOAI:           CALL    INISI
                LD      HL,SOALLR+14H
                JR      SOATX
SOAF:           CALL    INISI
                LD      HL,SOALLR+28H
                JR      SOATX
SOAGB:          CALL    INISI
                LD      HL,SOALLR+3CH
                JR      SOATX
SOAE:           CALL    INISI
                LD      HL,SOALLR+50H
SOATX:          CALL    TX              
		LD      A,77H           ;A
		LD      (BINSET+10H),A
		CALL    BIN7
                JP      ESCI

		;PARAMETRI POSIZIONE SEGNO

FUNZ3:          LD      A,01H
		LD      (MEM3),A
                LD      (MRIC+04H),A
                LD      DE,(SEQSEG)
		LD      (BINSET),DE
                LD      A,(LINGUA)
                CP      00H
                JR      Z,POSM
                CP      01H
                JR      Z,POSI
                CP      02H
                JR      Z,POSF
                CP      03H
                JR      Z,POSGB
                CP      04H
                JR      Z,POSE
POSM:           CALL    INISI
                LD      HL,POSSEG
                JR      POSTX
POSI:           CALL    INISI
                LD      HL,POSSEG+14H
                JR      POSTX
POSF:           CALL    INISI
                LD      HL,POSSEG+28H
                JR      POSTX
POSGB:          CALL    INISI
                LD      HL,POSSEG+3CH
                JR      POSTX
POSE:           CALL    INISI
                LD      HL,POSSEG+50H
POSTX:          CALL    TX              
		LD      A,73H           ;P
		LD      (BINSET+10H),A
		CALL    BIN7
		JP      ESCI

		;SEGNALAZIONE FASATURA AUTOMATICA

FUNZ4:          LD      A,00H           ;IMPONGO MANUALE
                LD      (MEMC),A        ;++++++++++++++++
                OUT     (PC),A          ;DA VERIFICARE
		LD      (SEGOFF),A      ;SSPP

		LD	(MNOPR3),A	;CCDD

                LD      BC,0000H        ;SSSS SSPP
                LD      (OFFSET),BC     ;SSSS
		LD      A,01H 
		LD      (MRIC+00H),A
		LD      (MRIC+02H),A
                LD      (MRIC+06H),A    ;NO LETT.FINE CORSA TTTT
     ;SSDD      LD      (MRIC+08H),A    ;RIPETIZ.RICERC.
                LD      A,08H           ;DOPO 16 GIRI
		LD      (ALTGUA),A      ;STOP GUAD.AUTO
		LD      A,60H           ;INIZIO CON
		LD      (GUADS1),A      ;GUADAGNO MINIMO
		LD      (GUADS2),A      

                LD      A,(LINGUA)
                CP      00H
                JR      Z,FASM
                CP      01H
                JR      Z,FASI
                CP      02H
                JR      Z,FASF
                CP      03H
                JR      Z,FASGB
                CP      04H
                JR      Z,FASESP
FASM:           CALL    INISI
                LD      HL,FASEAU
                JR      FASTX
FASI:           CALL    INISI
                LD      HL,FASEAU+14H
                JR      FASTX
FASF:           CALL    INISI
                LD      HL,FASEAU+28H
                JR      FASTX
FASGB:          CALL    INISI
                LD      HL,FASEAU+3CH
                JR      FASTX
FASESP:         CALL    INISI
                LD      HL,FASEAU+50H
FASTX:          CALL    TX
                CALL    AZZF4           
		JP      ESCI


		;FASATURA MANUALE

FUNZ5:          LD      A,01H           ;OOOO
                LD      (MEM5),A

                LD      A,00H           ;IMPONGO MANUALE
                LD      (MEMC),A
                OUT     (PC),A

                LD      A,03H           ;OOOO
                LD      (USOSCI),A

                LD      A,0C2H          ;LUCE LED  TTTT      
                LD      (DATOTX),A      ;ORIZZONTALE TTTT
                CALL    TX485           ;TTTT

                LD      A,00H           ;OOOO
                LD      (MEM5),A
            
                JP      ESCI



		;LETTURA PARAMETRI LAVORO

FUNZ6:          
;+++++++++++++++++++++++++++++++++++++++++++++++++++++++              
;	        LD      A,00H           ;PRRR
;                LD      (PROVLT),A      ;PRRR
;;+++++++++++++++++++++++++++++++++++++++++++++++++++++++
		
		JP      CLEA1           ;###########

		;SCRITTURA PARAMETRI LAVORO


FUNZ7:          
;+++++++++++++++++++++++++++++++++++++++++++++++++++++++              
;	        LD      A,01H           ;PRRR
;                LD      (PROVLT),A      ;PRRR
;;+++++++++++++++++++++++++++++++++++++++++++++++++++++++
     
		JP      CLEA1           ;###########

                ;CENTRATURA MECCANICA DELLA TESTA  TTTT

FUNZ15:         LD      A,00H           ;IMPONGO MANUALE TTTT
		LD      (MEMC),A
                OUT     (PC),A
		LD      A,01H
                LD      (MEM15),A

                LD      A,(LINGUA)
                CP      00H
                JR      Z,TMECM
                CP      01H
                JR      Z,TMECI
                CP      02H
                JR      Z,TMECF
                CP      03H
                JR      Z,TMECGB
                CP      04H
                JR      Z,TMECE
TMECM:          CALL    INISI
                LD      HL,CENMEC
                JR      TMECTX
TMECI:          CALL    INISI
                LD      HL,CENMEC+14H
                JR      TMECTX
TMECF:          CALL    INISI
                LD      HL,CENMEC+28H
                JR      TMECTX
TMECGB:         CALL    INISI
                LD      HL,CENMEC+3CH
                JR      TMECTX
TMECE:          CALL    INISI
                LD      HL,CENMEC+50H
TMECTX:         CALL    TX

;                LD      A,(LINGUA)      ;NON ABILI-  TTEE
;                CP      00H             ;TATA
;                JR      Z,ABIM
;                CP      01H
;                JR      Z,ABII
;                CP      02H
;                JR      Z,ABIF
;                CP      03H
;                JR      Z,ABIGB
;                CP      04H
;                JR      Z,ABIE
;ABIM:           CALL    BASSA
;                LD      HL,ABILIT
;                JR      ABITX
;ABII:           CALL    BASSA
;                LD      HL,ABILIT+14H
;                JR      ABITX
;ABIF:           CALL    BASSA
;                LD      HL,ABILIT+28H
;                JR      ABITX
;ABIGB:          CALL    BASSA
;                LD      HL,ABILIT+3CH
;                JR      ABITX
;ABIE:           CALL    BASSA
;                LD      HL,ABILIT+50H
;ABITX:          CALL    TX              
;                JP      ESCI            ;TTEE

TMETX1:         LD      A,0C1H          ; TTTT
                LD      (DATOTX),A      ;

                CALL    TX485           ;   TTTT

                JP      ESCI

                
		;MANUALE AUTOMATICO LONGITUDINALE

AUTOC:          LD      A,00H           ;TOLGO USO DELLA                
		LD      (MKBUSY),A      ;TASTIERA
		LD      A,(MEMC)        ;METTO IN AUTOMAT.
		SET     2,A             
		LD      (MEMC),A
                OUT     (PC),A
		JP      ESCI

MANC:           LD      A,00H           ;TOLGO USO DELLA                
		LD      (MKBUSY),A      ;TASTIERA
                LD      A,(MEMC)        ;METTO IN MANUL.
                RES     0,A
                RES     1,A
                RES     2,A             
		LD      (MEMC),A
                OUT     (PC),A
		JP      ESCI

MANAVA:         LD      A,(MEMC)        ;SE E' IN AUTO-
                BIT     2,A             ;MATICO SALTO
		JR      NZ,MANEND
		LD      A,(MEMC)
		RES     1,A
		SET     0,A
		LD      (MEMC),A
                OUT     (PC),A          ;MOTORE AVANTI
                IN      A,(PA)
                BIT     4,A
                JR      NZ,MANEND
		LD      A,(HL)
                AND     1FH
                CP      0CH
                JR      Z,MANAVA

MANRIT:         LD      A,(MEMC)        ;SE E' IN AUTO-
                BIT     2,A             ;MATICO SALTA
		JR      NZ,MANEND
		LD      A,(MEMC)
		RES     0,A
		SET     1,A
		LD      (MEMC),A
                OUT     (PC),A          ;MOTORE RITARDO
		IN      A,(PA)
                BIT     4,A
                JR      NZ,MANEND
                LD      A,(HL)
                AND     1FH
                CP      0DH
		JR      Z,MANRIT

MANEND:         LD      A,00H           ;TOLGO L'USO
		LD      (MKBUSY),A      ;DELLA TASTIERA
		LD      A,(MEMC)
		RES     0,A
		RES     1,A
		RES     6,A
		RES     7,A
		LD      (MEMC),A
                OUT     (PC),A
		JP      ESCI    

		;MANULAE AUTOMATICO TRAVERS

AUTOT:          LD      A,00H           ;TOLGO L'USO
		LD      (MKBUSY),A      ;DELLA TASTIERA
		LD      A,(MEMC)        ;METTO IN AUTMAT.
                SET     4,A
		LD      (MEMC),A
                OUT     (PC),A
		JP      ESCI

MANT:           LD      A,00H           ;TOLGO L'USO
		LD      (MKBUSY),A      ;DELLA TASTIERA
                LD      A,(MEMC)        ;METTO IN MANUL.
                RES     6,A
                RES     7,A
                RES     4,A
		LD      (MEMC),A
                OUT     (PC),A
		JP      ESCI

MANOPE:         LD      A,(MEMC)        ;SE IN AUTO-
                BIT     4,A             ;MATICO SALTA
		JR      NZ,MANEND
		LD      A,(MEMC)
                SET     6,A
                RES     7,A
		LD      (MEMC),A        ;MOTORE LATO
                OUT     (PC),A          ;OPERATORE
		IN      A,(PA)
                BIT     4,A
                JR      NZ,MANEND
                LD      A,(HL)
                AND     1FH
                CP      13H
		JR      Z,MANOPE


MANTRA:         LD      A,(MEMC)        ;SE IN AUTO-
                BIT     4,A             ;MATICO SALTA
		JR      NZ,MANEND
		LD      A,(MEMC)
                RES     6,A
                SET     7,A
		LD      (MEMC),A        ;MOTORE LATO
                OUT     (PC),A          ;TRASMISSIONE
		IN      A,(PA)
                BIT     4,A
                JP      NZ,MANEND
                LD      A,(HL)
                AND     1FH
                CP      14H
		JR      Z,MANTRA



MUOVO:          LD      IX,BINSET+06H
		LD      B,(IX+00H)      ;MEMORIZZO I
		LD      C,(IX+01H)      ;NUMERI E LI
		LD      D,(IX+02H)      ;MUOVO VERSO
		LD      E,(IX+03H)      ;SINISTRA
		LD      (IX+00H),A
		LD      (IX+01H),B
		LD      (IX+02H),C
		LD      (IX+03H),D
		LD      (IX+04H),E
		RET

INIZDI:         LD      A,00H
		LD      IX,BINSET+06H
		LD      (IX+00H),A
		LD      (IX+01H),A
		LD      (IX+02H),A
		LD      (IX+03H),A
		LD      (IX+04H),A
		RET

PUNTO:
                LD      A,02H           ;OOOO OO22
                LD      (USOSCI),A
		LD      A,0C2H          ;LUCE LED  TTTT      
                LD      (DATOTX),A      ;ORIZZONTALE TTTT
                CALL    TX485           ;TTTT
                LD      A,00H
                LD      (MEM5),A        ;OOOO
                LD      A,00H           ;TOLGO L'USO BBBB
                LD      (MKBUSY),A      ;DELLA TASTIERA  BBBB


ESCI:
      		
MAR_C1:         LD      A,0AH           ;CARICO IL	PUUU
MAR_C2:		LD      (ALTERR),A      ;BLOCCO ALLE
		LD	A,02H
		LD	(TALTER),A	;CARICO IL UUU
					;BLOCCO ALLE
		LD      A,0D7H          ;CORREZZIONI
		OUT     (71H),A         ;PER X GIRI
		LD      A,01H           ;ALL'USCITA
		OUT     (71H),A         ;DALLA TASTIERA

		POP     IY              ;INIZIO COSI'
		POP     IX              ;AGGIORNA IL
		POP     AF              ;TUTTO.
		POP     HL
		POP     DE
		POP     BC
		EI

		RETI





PIOB:           PUSH    BC
		PUSH    DE
		PUSH    HL
		PUSH    AF
		PUSH    IX
		PUSH    IY


	        IN      A,(PB)          ;TTTT
                BIT     5,A
                JP      Z,RICEZ         ;TTTT SSDD

		LD      A,(ALTERR)      ;QUANDO ALTERR PUUU
		CP      00H             ;ARRIVA A ZERO
		JR      Z,PIOB3         ;RIPRENDE IL
		CP	0BH             ;CALCOLO DELLO
		JR	NC,PIOB4        ;ERRORE
		DEC     A               ;CALCOLO DELLO
		LD      (ALTERR),A      ;ERRORE
		JR	PIOB3
PIOB4:		LD	A,00H
		LD	(ALTERR),A	;PUUU

PIOB3:
                LD      A,(ENCOD2)     ;PPDD
                CP      02H
                JP      Z,PIOB1

                LD      A,(MEMFAS)      ;WWWW
                CP      00H
                JR      Z,PIOB2

		LD      A,0D7H          ;CONTROLLO CTC0
		OUT     (70H),A         ;CARICO AMPIEZZA
		LD	 A,(AMPIMP)	;LD      A,(AMPIM1)      ;GATE IN IMPULSI  WWWW
		OUT     (70H),A         ;ENCODER.

                LD      A,(MEMFAS)      ;WWWW
		CP      02H             ;SE ABILITAZ.
		JR      Z,PIOB1         ;PA7 SALTO

		LD      A,(GUADS1)      ;AMPLIFICAZIONE
		LD      B,A             ;S1
                LD      A,(MEMA)        
		RES     5,A
		RES     6,A
		ADD     A,B
		LD      (MEMA),A
                OUT     (PA),A     
		LD      A,(MRIC+06H)    ;VEDO SE DEVO  SSDD
                CP      00H             ;CONTROLLARE IL
                JR      Z,PIOB1         ;DOPPIO SEGNO
                LD      A,0D7H          ;METTO PER
                OUT     (73H),A         ;PRIMO SEGNO 
                LD      A,02H           ;02H 
                OUT     (73H),A         ;
                JR      PIOB1		;SSDD

PIOB2:
                LD      A,0D7H          ;CONTROLLO CTC0   WWWWW
                OUT     (70H),A         ;CARICO AMPIEZZA
		LD	A,(AMPIMP)	;LD      A,(AMPIM2)      ;GATE IN IMPULSI  WWWW
		OUT     (70H),A         ;ENCODER.

                LD      A,(GUADS2)      ;AMPLIFICAZIONE
		LD      B,A             ;S2
                LD      A,(MEMA)        
		RES     5,A
		RES     6,A
		ADD     A,B             
		LD      (MEMA),A
                OUT     (PA),A    
		
		LD      A,(MRIC+06H)    ;VEDO SE DEVO  SSDD
                CP      00H             ;CONTROLLARE IL
                JR      Z,PIOB1         ;DOPPIO SEGNO
                LD      A,0D7H          ;METTO PER
                OUT     (73H),A         ;PRIMO SEGNO 
                LD      A,02H           ;02H 
                OUT     (73H),A         ;
                JR      PIOB1		;SSDD

RICEZ:
WTSTB:
                IN      A,(PB)          ;TTTT
                RLA
                RLA
                RLA
                JR      C,WTSTB
                CALL    DHALF
                LD      D,80H
RCVB:
                CALL    DFULL
                IN      A,(PB)
                RLA
                RLA
                RLA
                RR      D
                JR      NC,RCVB
                LD      A,D
                JP      PO,PIOB1
                LD      (DATORX),A         ;TTTT
		LD	(LIMIT),A

PIOB1:          POP     IY
		POP     IX
		POP     AF
		POP     HL
		POP     DE
		POP     BC
		EI
		RETI



		;VERIFICA POSIZIONE S1

CTC0:           PUSH    BC
		PUSH    DE
		PUSH    HL
		PUSH    AF
		PUSH    IX
		PUSH    IY

		LD	A,(ALTERN)	;CONTROLLO CHE ALTERN	AALL
		CP	03H		;NON SUPERI DUE
		JR	C,CTC06		;PER NON FARE
		LD	A,02H		;LETTURE SBAGLIATE
		LD	(ALTERN),A
		LD	A,00H		;RESETTO IL CONTATORE WWDD
		LD	(WATCH),A	;DEL WATCH DOG WWDD
CTC06:					;AALL

                LD      A,(ENCOD1)     ;SE NON   EEEE
                CP      00H            ;ABILITATO
                JR      Z,CTC01        ;SALTA   EEEE
                CP      01H
                JP      Z,CTC025
                LD      A,(ENCOD2)     ;INCREMENTO
                INC     A              ;A OGNI 255
                LD      (ENCOD2),A     ;IMPULSI
                LD      A,0DFH         ;RICARICO CTC0 EEEE
		OUT     (70H),A
                LD      A,0FFH
                OUT     (70H),A
                JP      CTC025         ;EEEE EEEE EEEE EEEE




CTC01:          LD      A,(MEMFAS)      ;EEEE
		CP      00H              
		JP      Z,CTC010        ;VAI FASE S2
		CP      02H
		JP      Z,CTC016        ;VAI ABILIT.PA7
                IN      A,(30H)         ;LEGGO IL VALORE
		LD      E,A             ;DI PIENO
		IN      A,(40H)
		LD      D,A
                LD      (MPIEN1),DE
		IN      A,(50H)         ;LEGGO IL VALORE
		LD      E,A             ;DELLA POSIZIONE
		IN      A,(60H)         ;DI S1
		LD      D,A
                LD      (MPOSI1),DE
		IN      A,(61H)         ;LEGGO IL VALORE
		LD      E,A             ;DI ENCODER
		IN      A,(62H)         ;ALL'ARRIVO DI S1
		LD      D,A
                LD      (MASES1),DE
		LD      HL,(FASE2)      ;CARICO IL CONTA-
		LD      A,H             ;TORE PER LEGGERE
		OUT     (20H),A         ;LA FASE 2
		LD      A,L
		OUT     (10H),A         
                LD      A,(MEMA)        ;IMPONGO 
		SET     5,A             ;NELL'INTERVALLO
		SET     6,A             ;GUADAGNO MINIMO
		LD      (MEMA),A
                OUT     (PA),A          
                OUT     (52H),A         
		LD      A,00H           
		LD      (MEMFAS),A      
		LD      A,(MEMC)        ;SE SONO IN MA-
		BIT     2,A             ;NUALE SALTO
		JR      Z,CTC03
		IN      A,(PB)          ;SE MANCA IL 
		BIT     3,A             ;SEGNO BLOCCO
		JR      Z,CTC03         ;LA CORREZIONE
;		LD      A,02H           ;AUMENTANDO I
;		LD      (MATTES),A      ;CICLI DI ATTESA.

		CALL	INC_CICLO	;AACC

		LD	A,01H		;NNFF
		LD	(MNOPR1),A
		LD	A,(MNOPR2)
		INC	A
		LD	(MNOPR2),A	;NNFF

CTC03:          NOP                     ;LD      A,00H           ;SE NON ARRIVA A 2
                NOP                     ;LD      (MNOPR1),A      ;ANNULLO LA CONTA
                LD      (SWEEP1),A
CTC05:          IN      A,(PB)
		BIT     3,A
		JR      Z,CTC08
		LD      A,(ALTGUA)      ;SE FINITA RICERCA
		CP      00H             ;GUADAGNO AUTOMAT.
		JR      Z,CTC07         ;SALTA
		CALL    GAINS1          
CTC07:          LD      A,(MEMC)
		RES     0,A
		RES     1,A
                RES     6,A
                RES     7,A
		LD      (MEMC),A
                NOP                     ;CALL    FLASH
                JP      CTC025          
CTC08:          LD      A,(MEMA)
		SET     7,A
		LD      (MEMA),A
		OUT     (PA),A
		LD      A,43H
		OUT     (70H),A

ZOMP5:
	        LD      A,(MEMC)                ;DATOTX TTTT
                BIT     5,A                     ;CP      0C2H    BIT     5,A             ;LLLL
                JR      Z,CTC09                 ;SSSS JR      NZ,CTC09        
CTC027:         LD      DE,(MPIEN1)     ;SSSS
                LD      (PIENO1),DE
                LD      DE,(MPOSI1)
                LD      (POSIZ1),DE
                LD      DE,(MASES1)
		LD      (FASES1),DE
                JP      CTC025                  
CTC09:          LD      DE,(MPIEN1)
                LD      (TPIEN1),DE
                LD      DE,(MPOSI1)
                LD      (TPOSI1),DE
                LD      DE,(MASES1)
                LD      (TASES1),DE     
                JP      CTC025          

		;VERIFICA POSIZIONE DI S2

CTC010:         LD      A,(ALTGUA)      ;SE ATTIVO
		CP      00H             ;GUADAGNO AUTOM.
		JR      Z,CTC011        ;DECREMENTA
		DEC     A      
		LD      (ALTGUA),A
CTC011:         IN      A,(30H)         ;LEGGO IL VALORE
		LD      E,A             ;DI PIENO
		IN      A,(40H)
		LD      D,A
                LD      (MPIEN2),DE
		IN      A,(50H)         ;LEGGO IL VALORE
		LD      E,A             ;DELLA POSIZIONE
		IN      A,(60H)
		LD      D,A
                LD      (MPOSI2),DE
		IN      A,(61H)         ;LEGGO IL VALORE
		LD      E,A             ;DI ENCODER
		IN      A,(62H)         ;ALL'ARRIVO DI S2
		LD      D,A
                LD      (MASES2),DE
		LD      HL,(FASE3)      ;CARICO IL CONTA-
		LD      A,H             ;TORE PER POI
		OUT     (20H),A         ;L'ABILITARE PA7
		LD      A,L
		OUT     (10H),A

ZOMP6:
	        LD      A,(MEMC)        ;LD      A,(DATOTX)       
                BIT     5,A             ;LLLL    CP      0C2H 
                JR      Z,CTC019        ;SSSS JR      NZ,CTC019       
	        LD      DE,(MPIEN2)
                LD      (PIENO2),DE
                LD      DE,(MPOSI2)
                LD      (POSIZ2),DE
                LD      DE,(MASES2)
                LD      (FASES2),DE
                LD      A,(MRIC+00H)    
                CP      01H
                JP      Z,CTC018        
                LD      A,(ALTERN)
                DEC     A
                LD      (ALTERN),A
                CP      00H
                JP      NZ,CTC018       ;TTTT
                LD      A,(MEMC)        ;
                RES     5,A             ;SSSS    SET     5,A               
                LD      (MEMC),A        ;        ;COMMUT. LED

                LD      A,0C4H          ;LD      A,(MEMD)        ;LUCE LED        
                LD      (DATOTX),A      ;RES     0,A             ;TRAVER
                CALL    TX485           ;LD      (MEMD),A        ;TTTT
ZOMP7:
		LD	A,01H ;LD      A,02H
                LD      (ALTERN),A
                JP      CTC018        
CTC019:         LD      DE,(MPIEN2)
                LD      (TPIEN2),DE
                LD      DE,(MPOSI2)
                LD      (TPOSI2),DE
                LD      DE,(MASES2)
                LD      (TASES2),DE     
                LD      A,(ALTERN)
                DEC     A
                LD      (ALTERN),A
                CP      00H
                JP      NZ,CTC018
                LD      A,(MEMC)        ;
                SET     5,A             ;SSSS RES     5,A               
                LD      (MEMC),A        ;COMMUT. LED

                LD      A,0C2H          ;LD      A,(MEMD)        ;LUCE LED        
                LD      (DATOTX),A      ;RES     0,A             ;ORIZZONTALE
                CALL    TX485           ;LD      (MEMD),A        ;TTTT
ZOMP8:
	        LD	A,01H ;LD      A,02H
                LD      (ALTERN),A


		LD	A,(TESTCO)	;BBCC
		CP	00H
		JR	Z,CTC02
		CP	04H
		JR	C,CTC04
		LD	A,00H
		LD	(TESTCO),A
		JR	CTC02
CTC04:
		LD	A,(TESTCO)	;BBCC
		DEC	A
		LD	(TESTCO),A	;
		CP	00H		;
		JR	Z,CTC02
		JR	CTC018



CTC02:
		
                LD      DE,(POSTO1)     ;SOTTRAGGO PER TTTT
                LD      HL,(TPOST1)     ;TOVARE LA POSIZ.
                SBC     HL,DE           ;DELLA TESTA

		LD	(CRAPAE),HL	;MMTT
		CALL	MEDIA		;MMTT
		LD	HL,(CRAPAM)	;MMTT

                EX      DE,HL           ;SALVO
                LD      HL,0A0H		;100H         ;300 VALORE  TTTT
                SBC     HL,DE           ;CENTRALE
                JR      C,CTC026        ;COMPARO IL
                LD      A,L             ;RESTO CON UN
                CP	20H		;25H             ;CP      10H             ;VALORE SE IL 
                JR      C,CTC018        ;RESTO E'MAG-
                LD      A,(MEMC)        ;GIORE CORREGGOTTTT
                BIT     2,A
                JR      Z,CTC018        ;TTTT
                LD      A,0C8H          ;VALORE PER IPOTENUSA IN ALTO
                LD      (DATOTX),A      ;LD      (BASCRA),BC ;DI 0,25mm A SX

                ;CALL    TX485           ;NOP    ;CALL    CRAPSX  TTTT
		CALL	CENTRA_TESTA
                JR      CTC018

CTC026:         CCF                     ;TTTT
                EX      DE,HL
                LD      DE,0A0H		;100H         ;TTTT
                SBC     HL,DE
                LD      A,L
                CP	20H		;25H		;CP      10H
                JR      C,CTC018
                LD      A,(MEMC)        ;TTTT
                BIT     2,A
                JR      Z,CTC018        ;TTTT
                LD      A,0C7H          ;VALORE PER IPOTENUSA IN ALTO
                LD      (DATOTX),A      ;LD      (BASCRA),BC  ;DI 0,25mm A DX

                ;CALL    TX485           ;NOP   ;CALL    CRAPDX   TTTT
		CALL	CENTRA_TESTA

CTC018:         LD      A,(MEMA)        ;IMPONGO 
		SET     5,A             ;NELL'INTERVALLO
		SET     6,A             ;GUADAGNO MINIMO
		LD      (MEMA),A
                OUT     (PA),A          
		LD      A,02H
		LD      (MEMFAS),A
                OUT     (52H),A         ;STABILE DA 0,5 mS
		IN      A,(PB)          ;SE MANCA SEGNO
		BIT     3,A             ;MODIFICO IL
		JR      Z,CTC012        ;GUADAGNO DI S2
		LD      A,(ALTGUA)      ;SE FINITA RICERCA
		CP      00H             ;GUADAGNO AUTOM.
		JR      Z,CTC012        ;SALTA
		CALL    GAINS2          
CTC012:         LD      A,01H           ;SEGNALA AL MAIN
		LD      (MCALER),A      ;CHE HA LETTO.
		LD      A,(MEMC)        ;SE SONO IN MA-
		BIT     2,A             ;NUALE SALTO
		JR      Z,CTC014
		IN      A,(PB)          ;SE MANCA IL 
		BIT     3,A             ;SEGNO BLOCCO
		JR      Z,CTC014        ;LA CORREZIONE
;		LD      A,02H           ;AUMENTANDO I
;		LD      (MATTES),A      ;CICLI DI ATTESA.
		
		CALL	INC_CICLO	;AACC

CTC014:         IN      A,(PB)
		BIT     3,A
		JR      Z,CTC015
		CALL    RESEPC
                JP      CTC025          
CTC015:         LD      A,(MEMA)
		RES     7,A
		LD      (MEMA),A
		OUT     (PA),A
		LD      A,43H
		OUT     (70H),A
                JR      CTC017          
CTC016:         LD      HL,(FASE)       ;CARICO IL 
		LD      A,H             ;CONTATORE PER
		OUT     (20H),A         ;LEGGERE POI S1
		LD      A,L
		OUT     (10H),A         
		LD      A,(MEMA)
		SET     7,A
		LD      (MEMA),A
		OUT     (PA),A
		LD      A,43H
		OUT     (70H),A
		LD      A,01H
		LD      (MEMFAS),A
                JR      CTC025          

CTC017:         LD      A,(MRIC+00H)
                CP      00H
                JR      NZ,CTC025


                LD      A,00H
                LD      (CALCOD),A

                LD      BC,011DH        ;4mS TEMPO   
                LD      IX,IMPVEL       ;PER MISURARE
                LD      A,00H           ;GLI IMPULSI
                LD      (IX+01H),A
                LD      A,057H          ;SETTO CTC0
                OUT     (70H),A         ;SENZA INTERUPT
                LD      A,0FFH          
                OUT     (70H),A         
CTC021:         IN      A,(70H)         ;NEL CASO IL 
                CP      00H             ;DECREMENTO 
                JR      NZ,CTC022       ;ARRIVI A ZERO
                INC     (IX+01H)        ;LO MEMORIZZO
CTC022:         DEC     BC              ;IN IX+01
                LD      A,B
                OR      C
                JR      NZ,CTC021       
                IN      A,(70H)         
                CPL                     ;IMPULSI PROPOR
                LD      (IMPVEL),A      ;ALLA VELOCITA.

                LD      A,(MEMC)        ;SE E'IN MANUALE
		BIT     2,A             ;SALTO
                JR      Z,CTC020

                LD      IX,TRIP         
                LD      A,(IX)          ;SE TRIP
                CP      00H             ;= ZERO NON
                JR      Z,CTC020        ;OPERA


CTC023:         LD      HL,(VELMED)     ;CONTROLLO SE 
                LD      DE,(VELPRE)     ;TRA LA NUOVA 
                SBC     HL,DE           ;E LA VECCHIA 
                JR      C,CTC024        ;VELOCITA'C'E' 
                LD      A,L             ;UN DIFFERENZA
                CP      (IX)            ;TRIP IN METRI SIA  
                JP      M,CTC020        ;IN PIU' CHE
                CALL    ACCEL           ;MENO SE C'E'
                JR      CTC020          ;BLOCCO CON
CTC024:         CCF                     ;LA SCRITTA  
                LD      HL,(VELPRE)     ;APPROPIATA
                LD      DE,(VELMED)
                SBC     HL,DE
                LD      A,L
                CP      (IX)            
                JP      M,CTC020
                CALL    DECEL
CTC020:         LD      DE,(VELMED)
                LD      (VELPRE),DE

CTC025:        
		LD	A,(CONTGIR)	;COTEGGIO GIRI RRFF
		INC	A
		LD	(CONTGIR),A	;RRFF
		CP	0FEH		;201
		JR	C,CTC013
		LD	A,00H
		LD	(CONTGIR),A
CTC013:					;RRFF

		

		POP     IY
		POP     IX
		POP     AF
		POP     HL
		POP     DE
		POP     BC
		EI
		RETI




		;CONTEGGIO GIRI ALL'USCITA DALLA TASTIERA
		

CTC1:           PUSH    BC
		PUSH    DE
		PUSH    HL
		PUSH    AF
		PUSH    IX
		PUSH    IY
		LD      A,(ENCOD1)      ;VEDO SE SONO
		CP      00H             ;IN TEST
                JR      Z,CTC16         ;ENCODER
		CP      01H
                JR      Z,CTC17
		CP      02H
                JR      Z,CTC18
CTC17:          LD      A,02H           ;PARTENZA TEST
		LD      (ENCOD1),A
                LD      HL,ENC2        
                JR      CTC14           
CTC18:          LD      HL,ENC6         ;FINE TEST                        
                JR      CTC14           
CTC16:          LD      A,(MRIC+00H)    ;CONTROLLA
		CP      01H             ;SE FALLITA
		JR      Z,CTC12         ;RICERCA CODICE
		LD      A,(ALTERR)      ;QUANDO ALTERR
		CP      00H             ;ARRIVA A ZERO
		JR      Z,CTC10         ;RIPRENDE IL
		DEC     A               ;CALCOLO DELLO
		LD      (ALTERR),A      ;ERRORE
		JR      CTC11
CTC10:          LD      A,43H
		OUT     (71H),A
CTC11:          POP     IY
		POP     IX              
		POP     AF
		POP     HL
		POP     DE      
		POP     BC
		JR      CTC15
CTC12:          LD      A,(MRIC+02H)    ;QUANDO = 0
                CP      00H             ;LA PRIMA VOLTATTTT
                JR      Z,CTC101        ;RIPETO LA TTTT
                DEC     A               ;RICERCA
		LD      (MRIC+02H),A
		CP      00H
		JR      NZ,CTC13

CTC101:        
		LD	A,(MNOPR3)	;CCDD
		CP	01H
		JR	NZ,CTC102	;CCDD
		CALL	FLASH		;CCDD
CTC102:
                LD      A,0CDH          ;RICERCA SEGNO FF44
                LD      (DATOTX),A      ;2mm 
		CALL    TX485           ;FF44

                LD      A,01H           ; FF44
		LD      (MRIC+02H),A

                LD      A,00H           ;RIPETIZIONE
         ;SSDD       LD      (MRIC+08H),A    ;FASATURA
                LD      A,01H           ;AUTOMATICA
                LD      (MRIC+00H),A
       ;SSDD         LD      (MRIC+06H),A    ;TTTT
                LD      A,08H           ;DOPO 16 GIRI
		LD      (ALTGUA),A      ;STOP GUAD.AUTO
		LD      A,60H           ;INIZIO CON
		LD      (GUADS1),A      ;GUADAGNO MINIMO
		LD      (GUADS2),A      
                JR      CTC19           ;TTTT

CTC13:          CALL    GAINS1
CTC19:          LD      HL,GIR2         ;CODICE       ;TTTT
CTC14:          POP     IY
		POP     IX              
		POP     AF
		POP     DE      
		POP     BC
                EX      (SP),HL

CTC15:          EI              
		RETI




CTC2:           PUSH    BC
		PUSH    DE
		PUSH    HL
		PUSH    AF
		PUSH    IX
		PUSH    IY

                LD      A,(DECORR)      ;SE EXTRA 
                CP      00H             ;CORREZIONE 
                JR      NZ,CTC21        ;ATTIVA SALTO.
CTC23:          LD      A,(MEMC)        ;FINE DELLA
		RES     0,A             ;CORREZIONE
		RES     1,A
		LD      (MEMC),A
                OUT     (PC),A
		LD      A,43H           ;RESETTO
		OUT     (71H),A         ;CTC1
		OUT     (72H),A         ;CTC2
                JR      CTC22           
CTC21:          LD      A,37H           ;CONTROLLO CTC1
		OUT     (71H),A         
                LD      A,40H           ;COSTANTE DI
		OUT     (71H),A         ;TEMPO
                LD      A,0D7H          ;CONTROLLO CTC2
                OUT     (72H),A         ;CARICO PER 
                LD      A,0FFH          ;EXTRA CORREZ.
		OUT     (72H),A

                LD      A,(DECORR)      ;SE E' MAGGIORE ZZZ
                DEC     A               ;DI UNO LA CORREZ-
                LD      (DECORR),A      ;ZIONE DIVENTA
                CP      00H             ;CONTINUA
                JR      NZ,CTC22

                LD      A,(CIDE75)      ;SE FATTO 75% ZZZ
                CP      00H             ;DEL CICLO
                JR      Z,CTC23         ;BLOCCO CORREZ.

CTC22:          POP     IY
		POP     IX
		POP     AF
		POP     HL
		POP     DE      
		POP     BC
		EI
		RETI




CTC3:           PUSH    BC
		PUSH    DE
		PUSH    HL
		PUSH    AF
		PUSH    IX
                PUSH    IY
		LD      A,(TMEM4)       ;SE ATTIVATA
		CP      01H             ;CORREZIONE
		JP      Z,CTC32         ;SALTA
		LD      A,(MRIC+06H)    ;SE NON SONO IN
		CP      00H             ;FUNZ4 SALTO
		JP      Z,CTC31
		LD      A,00H
		LD      (MRIC+04H),A
CTC32:

                LD      A,(DECORT)      ;SE EXTRA   ZZZ
                CP      00H             ;CORREZIONE
                JR      NZ,CTC31        ;ATTIVA SALTO.


                LD      BC,(TMEM5)       ;CONTIENE IL
                DEC     BC               ;VALORE 
                LD      (TMEM5),BC       ;DELL'ERRORE
                LD      A,B
                OR      C
                JR      NZ,CTC31        ;ZZZ

CTC33:          LD      A,(MEMC)        ;FINITO IL DE-  
                RES     6,A             ;CREMENTO DELLO
                RES     7,A             ;ERRORE TOGLI
                LD      (MEMC),A        ;LE CORREZIONI.
                OUT     (PC),A
		LD      A,43H
		OUT     (73H),A
		LD      A,00H
		LD      (TMEM4),A
CTC31:          POP     IY
		POP     IX
		POP     AF
		POP     HL
		POP     DE
		POP     BC
		EI
		RETI



		;CONVERSIONE BCD BINARIO PER 10 DIGIT


BCDBIN:         EXX        
		LD      IX,BINSET+06H
		LD      A,(IX+03H)
		RL      A
		RL      A
		RL      A
		RL      A
		ADD     A,(IX+02H)
		LD      IY,TABCON
		LD      (IY+05H),A
		LD      A,(IX+01H)
		RL      A
		RL      A
		RL      A
		RL      A
		ADD     A,(IX+00H)
		LD      (IY+04H),A
		LD      A,00H
		LD      (IY+06H),A
		LD      (IY+07H),A
		LD      (IY+08H),A
		LD      C,20H
DBLP:           LD      B,05H
		XOR     A
		LD      HL,TABCON+08H
COR0:           LD      A,(HL)
		RRA
		PUSH    AF
		BIT     7,A
		JR      Z,COR1
		SUB     30H
COR1:           BIT     3,A
		JR      Z,COR2
		SUB     03H
COR2:           LD      (HL),A
		DEC     HL
		POP     AF
		DJNZ    COR0
		LD      B,04H
SHR4:           RR      (HL)
		DEC     HL
		DJNZ    SHR4
		DEC     C
		JR      NZ,DBLP
                LD      A,(BINSET+10H)  ;MEMORIZZO IL
		CP      39H             ;VALORE DELLA 
		JR      Z,LETTC         ;FUNZIONE NELLA
		CP      77H             ;SUA MEMORIA
		JR      Z,LETTA
		CP      73H
		JR      Z,LETTP
		CP      50H
		JR      Z,LETRU
		CP      1CH
		JR      Z,LETRU
		CP      40H
		JR      Z,LEMEN
		CP      70H
		JR      Z,LEPIU
                CP      3FH
                JR      Z,LETTO
                CP      78H
                JR      Z,LETTT
                JR      LETT2
LETTC:          LD      HL,(TABCON)
		LD      (CILIN),HL
                JR      LETT2
LETTA:          LD      HL,(TABCON)
		LD      (ALLAR),HL
                JR      LETT2
LETTP:          LD      HL,(TABCON)
		LD      (SEQSEG),HL
                JR      LETT2
LETRU:          LD      HL,(TABCON)
		LD      (LAVORO),HL
                JR      LETT2
LEMEN:          LD      HL,(TABCON)
		LD      (SHIFT),HL
                LD      (TSHIFT),HL     ;
		LD      A,(BINSET+10H)
		LD      (PIUMEN),A
                LD      A,3FH           ;
                LD      (TIUMEN),A      ;
                JR      LETT2
LEPIU:          LD      HL,(TABCON)
		LD      (SHIFT),HL
                LD      (TSHIFT),HL     ;
		LD      A,(BINSET+10H)
		LD      (PIUMEN),A
                LD      A,78H           ;
                LD      (TIUMEN),A      ;
LETT2:          LD      DE,(SHIFT)      ;ACCETTO SPOSTA-
		LD      HL,01F4H        ;MENTO MASSIMO
		SBC     HL,DE           ;DI 500 CENTESIMI
		JR      NC,LETT1
		CCF
		LD      A,01H
		LD      (MDATER),A
                JR      LETT1
LETTO:          LD      HL,(TABCON)
		LD      (TSHIFT),HL
		LD      A,(BINSET+10H)
		LD      (TIUMEN),A
		JR      LETT1
LETTT:          LD      HL,(TABCON)
		LD      (TSHIFT),HL
		LD      A,(BINSET+10H)
		LD      (TIUMEN),A
LETT1:          EXX
		RET

		;CALCOLO CENTRATURA GATE


CENTRA:         EXX
		LD      HL,(FASE)       ;SOTTRAGGO IL VA-
		LD      BC,(MEZGA)      ;LORE DI 1/2 GATE
		LD      B,00H           ;DAL VALORE LETTO
		SBC     HL,BC           ;SE IL RISULTATO
		JR      C,RISNEG        ;E'POSITIVO LO
		JR      TRFASE          ;MEMORIZZO IN
RISNEG:         CCF                     ;IN FASE.
		LD      HL,1000H        ;SE E'NEGATIVO
		SBC     HL,BC           ;SOTTRAGGO DA 4096
		LD      BC,(FASE)       ;IL 1/2 GATE E IL
		ADD     HL,BC           ;RESTO LO SOMMO
TRFASE:         LD      (FASE),HL       ;AL VALORE LETTO.
		LD      A,H
		OUT     (20H),A
		LD      A,L
		OUT     (10H),A
                EXX                     
		RET

		;CALCOLO DELLO SPOSTAMENTO DI REGISTRO 


SPOSTA:         LD      HL,(SHIFT)
		LD      (MDO032),HL
		LD      HL,0000H
		LD      (MDO232),HL
		LD      HL,3E8H
		LD      (MRE032),HL
		LD      HL,0000H
		LD      (MRE232),HL
		CALL    MOL32
		LD      BC,(PTO032)
		LD      DE,(PTO232)
		LD      A,(PIUMEN)
		CP      40H
		JR      NZ,TOGLI
		LD      (ADDEN0),BC
		LD      (ADDEN2),DE
		LD      BC,(DISTA0)
		LD      DE,(DISTA2)
		LD      (AUGEN0),BC
		LD      (AUGEN2),DE
		CALL    SOMM32
		LD      BC,(ADDEN0)
		LD      DE,(ADDEN2)
		LD      (DISTA0),BC
		LD      (DISTA2),DE
		JR      SPOFIN
TOGLI:          LD      (MINUE0),BC
		LD      (MINUE2),DE
		LD      BC,(DISTA0)
		LD      DE,(DISTA2)
		LD      (SUBTR0),BC
		LD      (SUBTR2),DE
		CALL    SOTT32
		LD      BC,(RESTO0)
		LD      DE,(RESTO2)
		LD      (DISTA0),BC
		LD      (DISTA2),DE
SPOFIN:         RET



		;ROUTINE SCRITTA ERRORE


ERROR:          LD      A,(LINGUA)
                CP      00H
                JR      Z,ERRM
                CP      01H
                JR      Z,ERRI
                CP      02H
                JR      Z,ERRF
                CP      03H
                JR      Z,ERRGB
                CP      04H
                JR      Z,ERRE
ERRM:           CALL    BASSA
                LD      HL,ERRORE
                JR      ERRTX
ERRI:           CALL    BASSA
                LD      HL,ERRORE+14H
                JR      ERRTX
ERRF:           CALL    BASSA
                LD      HL,ERRORE+28H
                JR      ERRTX
ERRGB:          CALL    BASSA
                LD      HL,ERRORE+3CH
                JR      ERRTX
ERRE:           CALL    BASSA
                LD      HL,ERRORE+50H
ERRTX:          CALL    TX              
		LD      A,01H           ;ERRORE SI ELI-
                LD      (MDATER),A      ;MINA CON CLEAR.
		RET


		;ROUTINE SCRITTURA NO PRINT



NOPRI: 
		LD      A,0C2H          ;ACCENDO LED
                LD      (DATOTX),A      ;LONGITUDINALE 
		CALL    TX485           ;

		LD      A,(MEMC)        ;SE SONO IN
		BIT     2,A             ;MANUALE SALTO
                JR      Z,NOPRI2
		
                CALL    VELIST          ;BBLL
                CALL    DISPLD          ;TTVV

                LD      HL,(ISTVEL)     
                LD      DE,(INSER)      
                SBC     HL,DE            
                JR      C,NOPRI3         ;BBLL

		LD      A,(ALLAR)       ;SE ALLARME E' NNFF
		CP      00H             ;MESSO A ZERO
                JR      Z,NOPRI2        ;SALTA

                LD      A,(MEMC)
		SET     3,A             ;ATTIVO ALLARME
		LD      (MEMC),A
		OUT     (PC),A
                JR      NOPRI2

NOPRI3:
                CCF                     ;BBLL
              
 
NOPRI2:                                 ;BBLL
                CALL    RESEPC          ;FFLL
              
                LD      A,(LINGUA)
		CP      00H
                JR      Z,NOPM
		CP      01H
                JR      Z,NOPI
		CP      02H
                JR      Z,NOPF
		CP      03H
                JR      Z,NOPGB
                CP      04H
                JR      Z,NOPE
                CP      05H
                JR      Z,NOPD          ;DDDD

                JR      NOPFIN
NOPM:           CALL    BASSA           ;TTVV
                LD      HL,NOSTAM
                JR      NOPTX
NOPI:           CALL    BASSA
                LD      HL,NOSTAM+14H
                JR      NOPTX
NOPF:           CALL    BASSA
                LD      HL,NOSTAM+28H
                JR      NOPTX
NOPGB:          CALL    BASSA
                LD      HL,NOSTAM+3CH
                JR      NOPTX
NOPE:           CALL    BASSA
                LD      HL,NOSTAM+50H
                JR      NOPTX
NOPD:           CALL    BASSA
                LD      HL,NOSTAM+64H

NOPTX:          CALL    TX

                LD      A,01H           ;FFLL
                LD      (PROTEZ),A      ;FFLL

NOPFIN:         CALL    FLASH           ; NNFF     
;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
;DA VERIFICARE
;                LD      A,(MEMC)        ;QUANDO NO PRINT
;                RES     5,A             ;IMPONGO SOLO
;                LD      (MEMC),A        ;LETTURE LON-
;                OUT     (PC),A          ;GITUDINALI
;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                LD	A,05H		;LD      A,0AH
                LD      (ALTERN),A
                ;CALL    FLASH           ;    FFLL
		CALL	AZZER_ERROR	;CCDD			
	
		RET


		;ROUTINE SCRITTURA LOW-SPEED

                

LOWSPE:
                CALL    RESEPC          ;FFLL

                CALL    VELIST          ;TTVV
                CALL    DISPLD          ;TTVV

                ;CALL    FLASH           ;FFLL22 TVVV

                LD      A,(LINGUA)
		CP      00H
                JR      Z,LOWM
		CP      01H
		JR      Z,LOWI
		CP      02H
                JR      Z,LOWF
		CP      03H
                JR      Z,LOWGB
                CP      04H
                JR      Z,LOWE
                CP      05H             ;DDDD
                JR      Z,LOWD

		JR      LOWFIN
LOWM:           CALL    BASSA            ;TTVV
                LD      HL,VADASI
                JR      LOWTX
LOWI:           CALL    BASSA
                LD      HL,VADASI+14H
                JR      LOWTX
LOWF:           CALL    BASSA
                LD      HL,VADASI+28H
                JR      LOWTX
LOWGB:          CALL    BASSA
                LD      HL,VADASI+3CH
                JR      LOWTX
LOWE:           CALL    BASSA
                LD      HL,VADASI+50H
                JR      LOWTX
LOWD:           CALL    BASSA
                LD      HL,VADASI+64H

LOWTX:          CALL    TX

                LD      A,01H           ;FFLL
                LD      (PROTEZ),A      ;FFLL

                CALL    FLASH           ;TVVV
                ;CALL    RITDIS         ;BBLL TVVV

LOWFIN:         RET





		;CONTROLO ZONA MORTA

CORREZ:         LD      HL,(ERMEDI)     ;SE ZONA MORTA E'
		LD      DE,(ZONA)       ;> DELL'ERRORE
		SBC     HL,DE           ;NON CORREGGO
		JR      NC,CORRE1
		CCF
		LD      A,(MEMC)        
		RES     0,A             
		RES     1,A             
		LD      (MEMC),A        
                OUT     (PC),A  
		JP      COFINE


		;########################################
		;# CALCOLO CORREZIONE MOTORE            #
		;# [Ea x C/10 + (Ea - Ep) x D] x G      #
		;########################################


CORRE1:         LD      DE,(ERATTU)     ;Ea x C/10 = W
		LD      (MOLTI),DE
		LD      A,(CILDIV)
		LD      (MOLPL),A
		CALL    MOLT
		LD      DE,(PROD)       ;SALVA IL PRIMO
		LD      (MEMW),DE       ;RISULTATO
		LD      B,00H           ;Ea - Ep = ED
		LD      HL,(ERATTU)
		LD      DE,(ERPREC)
		SBC     HL,DE
		JR      NC,CORRE2
		CCF
		LD      HL,(ERPREC)     ;SE NEGATIVO
		LD      DE,(ERATTU)     ;ALLORA
		SBC     HL,DE           ;Ep - Ea = (-ED)
		LD      B,01H           ;E SEGNALALO

CORRE2:         LD      (MOLTI),HL      ;ED x D = Y
		LD      A,(DERIVA)
		LD      (MOLPL),A
		CALL    MOLT            
		LD      A,B             ;SEGALA (-ED)
		CP      00H
		JR      Z,CORRE3
		LD      DE,(PROD)       ;W + (-Y) = Z
		LD      HL,(MEMW)
		SBC     HL,DE
		JR      NC,CORRE4
		CCF                     ;SE Z E' NEGATIVO
		LD      DE,(MEMW)       ;ALLORA
		LD      HL,(PROD)       ;(-Y) + W = Z
		SBC     HL,DE           ;PERO' DEVO 
		LD      A,(MSCORR)      ;INVERTE IL SENSO
		CP      01H             ;DI CORREZIONE
		JR      Z,INVER1
		LD      A,01H
		LD      (MSCORR),A
		JR      CORRE4
INVER1:         LD      A,08H
		LD      (MSCORR),A
		JR      CORRE4
CORRE3:         LD      DE,(PROD)       ;W + Y = Z
		LD      HL,(MEMW)
		ADD     HL,DE
CORRE4:         LD      (MOLT24),HL     ;Z x G = CORREZ.  
		LD      A,(GUADA)
                LD      (MOLP24),A      
                CALL    MOL24
                LD      BC,(PROD24)
                LD      A,(PROD24+02H)
                LD      (MDECOR),A      ;VALORE PER 
                CP      00H             ;EXTRA CORREZ.
                JR      NZ,CORRE6

                LD      A,B             ;ZZZ

                LD      (CORRE),A       ;ZZZ
                JR      CORRE7          
CORRE6:         LD      A,0FFH          ;ZZZ
                LD      (CORRE),A       ;ZZZ



		;ROUTINE DI CORREZIONE


CORRE7:         LD      A,(CIDE75)      ;DECREMENTO ZZZ
                CP      00H             ;DEL 75% DEL
                JR      Z,CORRE8        ;CICLO
                DEC     A
                LD      (CIDE75),A


CORRE8:         LD      A,(MATTES)      ;CONTROLLO CICLO
		DEC     A               ;DI ATTESA
		LD      (MATTES),A
		CP      00H
		JP      NZ,COFINE

                LD      A,(CICL75)      ;RICARICO IL ZZZ
                LD      (CIDE75),A      ;75% DEL CICLO ZZZ

                LD      A,(CICLO)       ;RICARICO IL CI-
		LD      (MATTES),A      ;CLO DI ATTESA.
                LD      HL,(ERMEDI)
		LD      DE,(ZONA)
		SBC     HL,DE           ;SE ZONA MORTA
		JR      NC,CORRE5       ;MAGGIORE DI
		CCF                     ;ERMEDI SALTO
		JP      COFINE
CORRE5:         LD      A,(MEMC)        ;SE E'IN MANUALE
		BIT     2,A             ;SALTO
		JP      Z,COFINE

                LD      A,(CORRE)      ;ZZZ

                CP      00H            ;OR      C               ;SALTO
                JP      Z,KRAPIN        
                                        

                LD      A,(MDECOR)      ;ZZZ
                LD      (DECORR),A      ;ZZZ


                LD      A,37H           ;CONTROLLO CTC1   
		OUT     (71H),A         
                LD      A,47H           ;COSTANTE DI
		OUT     (71H),A         ;TEMPO
                LD      A,0D7H          ;CONTROLLO CTC2
		OUT     (72H),A
                LD      A,(CORRE)       ;MSB ERRORE  ZZZ



                OUT     (72H),A

		LD      A,(MSCORR)      ;VEDO IN CHE
		CP      01H             ;SENSO CORREG.
		JR      NZ,AUTRIT
		LD      A,(MEMC)        ;CORREZIONE IN
		RES     1,A             ;AVANTI
		SET     0,A
		LD      (MEMC),A
                OUT     (PC),A
                LD      A,114
		LD      (SIMCOL),A
                JR      COFINE
AUTRIT:         LD      A,(MEMC)        ;CORREZIONE IN
		RES     0,A             ;RITARDO
		SET     1,A
		LD      (MEMC),A
                OUT     (PC),A
                LD      A,97
		LD      (SIMCOL),A
COFINE:         RET


KRAPIN:         LD      A,(MEMC)        ;QUANDO L'ERRORE 
                RES     0,A             ;E' A ZERO
                RES     1,A             ;SI ANNULLA 
                LD      (MEMC),A        ;TUTTO PER
                OUT     (PC),A          ;EVITARE CHE
                LD      A,43H           ;CHE AVVENGANO
                OUT     (71H),A         ;CORREZZIONI
                OUT     (72H),A         ;INDESIDERATE
                RET

		;CALCOLO ERRORE MEDIO PER DISPLAY SSPP

LMEDIA:
                LD      A,(PRIMOB)      ;WWAA
                LD      B,A
                ;WWAA  LD      B,2FH           ;WWAA FA LA MEDIA  ma scrive 15
                LD      IX,MAVA00               ;+5CH     ;DMEP1C WWAA   ;SU SEDICI
                LD      DE,(VALORX)
                ADD     IX,DE
LMED01:
                LD      E,(IX)          ;DATI LETTI
                LD      D,(IX+01H)      ;INSERENDO
                LD      (IX+02H),E      ;IL NUOVO
                LD      (IX+03H),D      ;ERRORE AL
                DEC     IX              ;PRIMO POSTO
                DEC     IX              ;ED ELIMINANDO
                DJNZ    LMED01          ;L'ULTIMO
                INC     IX
                INC     IX


                LD      A,(PRIMOB)      ; LD      B,2FH           ;WWAA
                LD      B,A             ;WWAA
                LD      IY,MRIT00       ;+5CH   ;DMED1C       WWAA
                LD      DE,(VALORX)     ;WWAA
                ADD     IY,DE           ;WWAA
LMED02:
                LD      E,(IY)          ;RIPETE QUELLO
                LD      D,(IY+01H)      ;VISTO SOPRA
                LD      (IY+02H),E      ;CON ALTRE  
                LD      (IY+03H),D      ;16 CELLE
                DEC     IY
                DEC     IY
                DJNZ    LMED02
                INC     IY
                INC     IY


                LD      DE,(ERATTU)      ;WWAA LD      DE,(ERMEDI)    INSERIMENTO
                LD      BC,0000H         ;NUOVO ERRORE
                LD      A,(MSCORR)       ;NELLA PRIMA
                CP      01H              ;DELLE 16 CELLE
                JR      Z,LMED04
LMED03:
                LD      (MAVA00),DE
                LD      (MRIT00),BC
                JR      LMED05
LMED04:         
                LD      (MAVA00),BC
                LD      (MRIT00),DE
LMED05:
                LD      A,(SECONB)      ;WWAA
                LD      B,A             ;WWAA LD      B,30H            ;SOMMA DELLE  16 celle reali WWAA
                JR      NC,LMED06       ;48 CELLE 16 CELLE TMEPXX WWAA
                CCF                      ; 
LMED06:         LD      HL,0000H
LMED07:
                LD      E,(IX+00H)
                LD      D,(IX+01H)
                ADC     HL,DE
                INC     IX
                INC     IX
                DJNZ    LMED07
                LD      (SOMLO1),HL

                LD      A,(SECONB)      ;WWAA
                LD      B,A             ;WWAA LD      B,30H            ;SOMMA DELLE  16 celle reali WWAA
                JR      NC,LMED08        ;48 CELLE 16 CELLE DTEDXX    WWAA
                CCF
LMED08:         LD      HL,0000H
LMED09:
                LD      E,(IY+00H)
                LD      D,(IY+01H)
                ADC     HL,DE
                INC     IY
                INC     IY
                DJNZ    LMED09

                LD      (SOMLO2),HL
                LD      DE,(SOMLO1)
		SBC     HL,DE
                JR      C,LMED10        ;SIMBOLO ERRORE
                LD      A,114           ;r RITARDO
                LD      (SIMCOL),A
                LD      A,105           ;i
                LD      (SIMCOL+01H),A
                LD      A,116           ;t
                LD      (SIMCOL+02H),A
                JR      LMED11 
LMED10:         CCF
                LD      A,97            ;a SIMBOLO ERRORE
                LD      (SIMCOL),A      ;AVANTI
                LD      A,118           ;v
                LD      (SIMCOL+01H),A
                LD      A,97            ;a
                LD      (SIMCOL+02H),A
		EX      DE,HL
                LD      DE,(SOMLO2)
		SBC     HL,DE
LMED11:         LD      (DIVDEN),HL
                LD      BC,(SECONB)     ;DIVISIONE    WWAA
                LD      B,00H           ;WWAA
                LD      (DIVSOR),BC     ;PER XX GGAA
		CALL    DIVIS
		LD      HL,(QUOZIE)
                LD      (ERMEDI),HL

                ;LD      (BINSET),HL
                ;LD      (BINSE1),HL

                LD      A,(MAZTRA)      ;SENTE SE DEVE
                CP      00H             ;AZZERARE TRAVERS
                JR      Z,LMED12 
                ;LD      DE,000AH        ;QUANDO MINORE WWAA
                ;SBC     HL,DE           ;DI 10 INIZIA
                ;JR      NC,LMED12       ;AZZERAMENTO
                ;CCF                     ;TRAVERS
                CALL    AZZTRA
LMED12:         LD      DE,0000H
		SBC     HL,DE
                JR      NZ, LMED13 
                LD      A,32            ;NO ERRORE MMDD11  
                LD      (SIMCOL),A
                LD      (SIMCOL+01H),A
                LD      (SIMCOL+02H),A

LMED13:         ;JP      LONFIL           ;WWAA


                ;MEDIA ERRORE SU QUATTRO PER DISPLY LONGITUDINALE

                LD      A,(MSHIFT)
                CP      00H
                JR      Z,MEDL02
                CP      0FFH
                JR      NC,MEDL01
                DEC     A
                LD      (MSHIFT),A
                LD      DE,(SHIFT)
                ;FFFE LD      (FILONG),HL
                ;FFFE LD      (PREFIL),HL
                LD      (ERMEDI),DE
                LD      (ERATTU),DE
                JP      MEDL015
MEDL01:         LD      A,00H
                LD      (MSHIFT),A

MEDL02:         
                LD      B,03H           ;FFFE        0FH           ;WWAA 
                LD      IX,DAVA00       ;
                LD      DE,0004H        ;FFFE     ;001CH
                ADD     IX,DE
MEDL03:
                LD      E,(IX)          ;DATI LETTI
                LD      D,(IX+01H)      ;INSERENDO
                LD      (IX+02H),E      ;IL NUOVO
                LD      (IX+03H),D      ;ERRORE AL
                DEC     IX              ;PRIMO POSTO
                DEC     IX              ;ED ELIMINANDO
                DJNZ    MEDL03          ;L'ULTIMO
                INC     IX
                INC     IX


                LD      B,03H           ;FFFE  0FH           ;WWAA
                LD      IY,DRIT00       ;WWAA
                LD      DE,0004H        ;FFFE     001CH
                ADD     IY,DE           ;WWAA
MEDL04:
                LD      E,(IY)          ;RIPETE QUELLO
                LD      D,(IY+01H)      ;VISTO SOPRA
                LD      (IY+02H),E      ;CON ALTRE  
                LD      (IY+03H),D      ;4 CELLE
                DEC     IY
                DEC     IY
                DJNZ    MEDL04
                INC     IY
                INC     IY


                LD      DE,(ERMEDI)      ;FFFE  (ERATTU)   INSERIMENTO
                LD      BC,0000H         ;NUOVO ERRORE
                LD      A,(MSCORR)       ;NELLA PRIMA
                CP      01H              ;DELLE 4 CELLE
                JR      Z,MEDL06
MEDL05:
                LD      (DAVA00),DE
                LD      (DRIT00),BC
                JR      MEDL07
MEDL06:         
                LD      (DAVA00),BC
                LD      (DRIT00),DE
MEDL07:
                LD      B,04H              ;FFFE 10H            ;SOMMA DELLE  
                JR      NC,MEDL08        ;4 CELLE  WWAA
                CCF                      ; 
MEDL08:         LD      HL,0000H
MEDL09:
                LD      E,(IX+00H)
                LD      D,(IX+01H)
                ADC     HL,DE
                INC     IX
                INC     IX
                DJNZ    MEDL09
                LD      (SOMDL1),HL

                LD      B,04H            ; FFFE  10H            ;SOMMA DELLE   WWAA
                JR      NC,MEDL10        ;4 CELLE  WWAA
                CCF
MEDL10:         LD      HL,0000H
MEDL11:
                LD      E,(IY+00H)
                LD      D,(IY+01H)
                ADC     HL,DE
                INC     IY
                INC     IY
                DJNZ    MEDL11

                LD      (SOMDL2),HL
                LD      DE,(SOMDL1)
                SBC     HL,DE
                JR      C,MEDL12       ;SIMBOLO ERRORE
                JR      MEDL13   
MEDL12:         CCF
		EX      DE,HL
                LD      DE,(SOMDL2)     ;WWAA
		SBC     HL,DE
MEDL13:         LD      (DIVDEN),HL
                LD      BC,0004H        ;FFFE     0010H        ;
                LD      (DIVSOR),BC     ;
                CALL    DIVIS
                LD      DE,(QUOZIE)
                                        ;LD      (ERDILO),HL

                LD      HL,0004H        ;SCRIVO IL 
                SBC     HL,DE           ;SENSO DI
                JR      C,MEDL014       ;CORREZIONE
                LD      A,32            ;QUANDO  
                LD      (SIMCOL),A      ;SUPERA 4  
                LD      (SIMCOL+01H),A   
                LD      (SIMCOL+02H),A  
                JR      MEDL015
MEDL014:
                CCF
MEDL015:
                LD      (BINSET),DE
                LD      (BINSE1),DE

                RET



                ;RANGE  TTT

CODICE:       
                LD      A,0C2H          ; TTTT
                LD      (DATOTX),A      ;
                CALL    TX485           ;   TTTT

COD4:           LD      A,(MEMB)        ;TTTT
		SET     6,A             ;BLOCCO GATE
		LD      (MEMB),A
		OUT     (PB),A
		LD      A,(GUADS1)      ;CARICO 
		LD      B,A             ;GUADAGNO DI
                LD      A,(MEMA)        ;S1 
		ADD     A,B
		LD      (MEMA),A
                OUT     (PA),A          
                LD      A,0D7H          ;SE DOPO 16 GIRI  TTTT
                OUT     (71H),A         ;############DI RICERCA
                LD      A,08H           ;# ERA 10H ###FALLITA ESCI     TTTT
                OUT     (71H),A         ;##############
COD1:           LD      A,(SPAZ40)      ;40mm MAX A8
		LD      E,A
COD2:           IN      A,(PB)          
		BIT     2,A
		JR      NZ,COD1
		BIT     4,A
		JR      Z,COD2
COD3:           IN      A,(PB)
		BIT     2,A
		JR      NZ,COD1
		BIT     4,A
		JR      NZ,COD3
		DEC     E
		JR      NZ,COD2
		
		;PRIMO SEGNO

                LD      A,(SEGNO)       ;1mm
		LD      E,A
		LD      BC,0FFFFH       ;NEL CASO MANCHI
TER:            DEC     BC              ;IL CODICE
		LD      A,B
		OR      C
		JR      Z,COD1
		IN      A,(PB)
		BIT     2,A
		JR      Z,TER
		CALL    RIT
		IN      A,(PB)          ;SE>1mm COD1
		BIT     2,A
		JR      NZ,COD1



		;PRIMO SPAZIO BIANCO

                LD      A,(SPABIA)      ;RRII
		LD      E,A
MIS2:           IN      A,(PB)          ;SE STAMPA COD1
		BIT     2,A
		JR      NZ,COD1
		BIT     4,A
		JR      Z,MIS2
MIS3:           IN      A,(PB)
		BIT     2,A
		JR      NZ,COD1         ;SE STAMPA COD1
		BIT     4,A
		JR      NZ,MIS3
		DEC     E
		JR      NZ,MIS2
		CALL    MARC            ;SENTE SE NEI
		LD      A,00H           ;PROSSIMI 2mm
		OR      B               ;ARRIVA IL SEGNO
		JR      Z,COD1          ;DI CODICE.





		;SECONDO SEGNO

                LD      A,(SEGNO)
		LD      E,A
QUAR:           IN      A,(PB)
		BIT     2,A
		JR      Z,QUAR
		CALL    RIT
		IN      A,(PB)
		BIT     2,A
                JR      NZ,COD1         ;SE STAMPA COD1 



		;SECONDO SPAZIO BIANCO

                LD      A,(SPABIA)      
		LD      E,A
MIS4:           IN      A,(PB)
		BIT     2,A
                JR      NZ,COD1         ;SE STAMPA COD1
		BIT     4,A
		JR      Z,MIS4
MIS5:           IN      A,(PB)
		BIT     2,A
                JR      NZ,COD1         ;SE STAMPA COD1
		BIT     4,A
		JR      NZ,MIS5
		DEC     E
		JR      NZ,MIS4
		CALL    MARC
		LD      A,00H
		OR      B
		JP      Z,COD1

		LD	A,(TESTCO)	;SE SONO IN
		CP	01H		;TEST CODE
		JR	Z,MIS9		;SALTO

		LD	A,(MNOPR3)	;CCDD
		CP	01H		;CCDD
		JR	NZ,MIS8		;CCDD

;+++++++++++++++++++++++++++++++++++++++++++++++++
		LD	A,00H		;CCDD
		LD	(MNOPR3),A	;CCDD
;+++++++++++++++++++++++++++++++++++++++++++++++++++++
		

		CALL	AZZER_ERROR	;CCDD

		CALL	INC_CICLO	;AACC
MIS9:
		RET			;CCDD



		;CALCOLO POSIZIONE PRIMO GATE

MIS8:           IN      A,(PB)
		BIT     2,A
		JR      Z,MIS8
		IN      A,(10H)         ;LEGGO LA POSI-
		LD      E,A             ;ZIONE
		IN      A,(20H)
		LD      D,A
		LD      (FASE),DE
		CALL    CENTRA
		
		;CALCOLO POSIZIONE SECONDO GATE

		LD      DE,(MILL20)           
		LD      (MOLTI),DE
		LD      A,(SEQSEG)
		DEC     A
		LD      (MOLPL),A
		CALL    MOLT
		LD      HL,(PROD)
		LD      DE,(FASE)       
		ADD     HL,DE
		LD      A,H             ;CONTROLLO SE 
		CP      10H             ;LA SOMMA HA
		JR      C,W1            ;SUPERATO 4096
		LD      DE,1000H        ;SE LO E'
		SBC     HL,DE           ;SOTTRAGGO AL
		LD      (FASE2),HL      ;RISULTATO 4096
		JR      W2
W1:             CCF
		LD      (FASE2),HL      


		;CALCOLO PUNTO DI ABILITAZIONE DI PA7

W2:             LD      HL,(FASE)
		LD      DE,(MILL40)
		SBC     HL,DE
		JR      NC,W3
		CCF
		LD      HL,1000H        ;4096
		SBC     HL,DE
W3:             LD      (FASE3),HL
		LD      A,00H
		LD      (MRIC+02H),A

		RET

		;SUBROUTINE DI RITARDO

RIT:            IN      A,(PB)
		BIT     4,A
		JR      Z,RIT
RIT1:           IN      A,(PB)
		BIT     4,A
		JR      NZ,RIT1
		DEC     E
		JR      NZ,RIT
		RET

		;SUROUTINE DI CONTROLLO CODICE

MARC:           LD      A,(SEGNO)       ;MISURA 2mm IN      
		LD      B,A             ;MODO CHE IN
MAR1:           IN      A,(PB)          ;QUESTO SPAZIO
		BIT     2,A             ;PASSI IL SEGNO
		JR      NZ,RIT0         ;DI CODICE
		BIT     4,A
		JR      Z,MAR1
MAR2:           IN      A,(PB)
		BIT     2,A
		JR      NZ,RIT0
		BIT     4,A
		JR      NZ,MAR2
		DEC     B
		JR      NZ,MAR1
RIT0:           RET

		;ADEGUAMENTO GUADAGNO AMPLIFICAT. ESTERNO


GAINS1:         EXX
		LD      A,(GUADS1)
		CP      60H
		JR      Z,GS11
		CP      40H
		JR      Z,GS12
		CP      20H
		JR      Z,GS13
		CP      00H
		JR      Z,GS14
GS11:           LD      A,40H
		JR      GS15
GS12:           LD      A,20H
		JR      GS15
GS13:           LD      A,00H
		JR      GS15
GS14:           LD      A,60H
GS15:           LD      (GUADS1),A
		EXX
		RET

GAINS2:         EXX
		LD      A,(GUADS2)
		CP      60H
		JR      Z,GS21
		CP      40H
		JR      Z,GS22
		CP      20H
		JR      Z,GS23
		CP      00H
		JR      Z,GS24
GS21:           LD      A,40H
		JR      GS25
GS22:           LD      A,20H
		JR      GS25
GS23:           LD      A,00H
		JR      GS25
GS24:           LD      A,60H
GS25:           LD      (GUADS2),A
		EXX
		RET

		;CONTROLLO PARAMETRI E EVENTUALE
		;INSERIMENTO VALORI DI DEFAULT



DEFAUL:         LD      IX,TRIP         
		LD      (IX+01H),00H
                LD      A,(IX)
                CP      0FH
                JR      NC,DEF1
		JR      DEF2
DEF1:           LD      A,06H
		LD      (IX),A

DEF2:           LD      IX,GUADA
		LD      (IX+01H),00H
		LD      A,(IX)
		CP      00H
                JR      Z,DEF3
		CP      64H
                JR      NC,DEF3
                JR      DEF4
DEF3:           LD      A,0AH
		LD      (IX),A
		
DEF4:           LD      IX,CICLO
		LD      (IX+01H),00H
		LD      A,(IX)
		CP      00H
                JR      Z,DEF5
		CP      64H
                JR      NC,DEF5
                JR      DEF6
DEF5:           LD      A,03H
		LD      (IX),A
		
DEF6:           LD      IX,DERIVA
		LD      (IX+01H),00H
		LD      A,(IX)
		CP      00H
                JR      Z,DEF7
		CP      0FFH
                JR      NC,DEF7
                JR      DEF8
DEF7:           LD      A,02H
		LD      (IX),A
		
DEF8:           LD      IX,ZONA
		LD      (IX+01H),00H
		LD      A,(IX)
		CP      00H
                JR      Z,DEF9
		CP      15H
                JR      NC,DEF9
                JR      DEF10
DEF9:           LD      A,00H
		LD      (IX),A
		
DEF10:          LD      IX,INSER
		LD      (IX+01H),00H
		LD      A,(IX)
		CP      00H
                JR      Z,DEF11
                CP      65H
                JR      NC,DEF11
                JR      DEF12
DEF11:          LD      A,0AH
		LD      (IX),A

DEF12:          LD      IX,SALTO
		LD      (IX+01H),00H
		LD      A,(IX)
		CP      00H
                JR      Z,DEF13
		CP      0AH
                JR      NC,DEF13
                JR      DEF14
DEF13:          LD      A,09H
		LD      (IX),A
                                        
DEF14:          LD      IX,GUATRA
		LD      (IX+01H),00H
		LD      A,(IX)
		CP      00H
                JR      Z,DEF15
                CP      64H
                JR      NC,DEF15
                JR      DEF16
DEF15:          LD      A,0AH
		LD      (IX),A
		
DEF16:          LD      IX,TCICLO
		LD      (IX+01H),00H
		LD      A,(IX)
		CP      00H
                JR      Z,DEF17
		CP      64H
                JR      NC,DEF17
                JR      DEF18
DEF17:          LD      A,0AH
		LD      (IX),A

DEF18:          LD      IX,ZONT
		LD      (IX+01H),00H
		LD      A,(IX)
		CP      00H
                JR      Z,DEF19
                CP      15H
                JR      NC,DEF19
                JR      DEF20
DEF19:          LD      A,00H
		LD      (IX),A

DEF20:          LD      IX,LINGUA
		LD      (IX+01H),00H
		LD      A,(IX)
                CP      0FFH
                JR      Z,DEF21
                CP      05H
                JR      NC,DEF21
                JR      DEF22
DEF21:          LD      A,01H
		LD      (IX),A


DEF22:          LD      IX,OSGAIN        ;OOGG
		LD      (IX+01H),00H
		LD      A,(IX)
		CP      00H
                JR      Z,DEF23
                CP      04H
                JR      NC,DEF23
                JR      DEF24
DEF23:          LD      A,00H
		LD      (IX),A

		

DEF24:          LD      A,(GUADS1)      ;SE IN PARTENZA OOGG
                CP      00H             ;NON C'E UN
                JR      Z,DEF25         ;VALORE NORMALE
                CP      20H             ;CREA CASINO 
                JR      Z,DEF25         ;IN SERITA.
                CP      40H
                JR      Z,DEF25
                LD      A,60H
                LD      (GUADS1),A
DEF25:          RET                     ;OOGG



               ;CALCOLO RAPPORTO POSIZINE PIENO TRAVERS S1

TRAVER:                                 ;+++++++++++++++++
              
		LD	A,(MEMFAS)	;DEVE PASSARE PUUU
		CP	02H		;DUE VOLTE
		JP	NZ,GIR1		;DA PIOB
;TRAV5:		
		LD      A,(ALTERR)      ;VEDE SE DEVE PUUU
		CP      00H             ;ASPETTARE
		JR	Z,TRAV3
		
		JP	MEDT016
TRAV3:		
		LD      A,(TALTER)      ;QUANDO ALTERR PUUU
		CP      00H             ;ARRIVA A ZERO
		JR      Z,TRAV2         ;RIPRENDE IL
		CP	03H             ;CALCOLO DELLO
		JR	NC,TRAV1        ;ERRORE
		DEC     A               ;CALCOLO DELLO
		LD      (TALTER),A      ;ERRORE
		JR	Z,TRAV1
		JP	GIR1	
TRAV1:		LD	A,00H
		LD	(TALTER),A	;PUUU
TRAV2:
		LD	DE,(TASES1)	;VEDO SE PER
		LD	HL,(TASES2)	;ERRORE NON
		SBC	HL,DE		;HO LETTO
		JP	Z,MEDT016	;DUE VOLTE1		;PUUU
		JR	NC,TRAV4	;LS STESSA FASE
		CCF
TRAV4:					;PUUU
	
		
		LD      DE,(TERATT)     ;
		LD      (TERPRE),DE     ;
                                        ;
                LD      A,(TMSCOR)      ;

                LD      IX,TPIEN1       ;DIVIDO PIENO
		LD      E,(IX+00H)      ;PER DIECI
		LD      D,(IX+01H)      ;E SOTTRAGGO
		LD      (DIVDEN),DE     ;IL RISULTATO
		LD      BC,000AH        ;A POSIZIONE
		LD      (DIVSOR),BC     ;SE IL RISULTATO
		CALL    DIVIS           ;E' NEGATIVO
		LD      IX,QUOZIE       ;VUOLE DIRE CHE
		LD      E,(IX+00H)      ;DIVIDENDO
		LD      D,(IX+01H)      ;POSIZIONE X 10
                LD      IY,TPOSI1       ;CON PIENO AVRO'
		LD      L,(IY+00H)      ;UN NUMERO MINORE
		LD      H,(IY+01H)      ;DI 0,1 PER CUI
		SBC     HL,DE           ;CARICO IN MEM.
                JR      C,RAPP30        ;RAPPORTO ZERO.
		LD      E,(IY+00H)      ;SE LA SOTTRZIONE
		LD      D,(IY+01H)      ;NON DA RISULTATO
		LD      (MOLTI),DE      ;NEGATIVO PROCEDO
		LD      A,0AH           ;NELLA DIVISIONE
		LD      (MOLPL),A       ;POSIZIONE X 10
		CALL    MOLT            ;DIVISO PIENO
		LD      IX,PROD         ;E OTTERRO'UN
		LD      C,(IX+00H)      ;RISULTATO 
		LD      B,(IX+01H)      ;COMPRESO 
		LD      (DIVDEN),BC     ;TRA 0,1 E 0,9
                LD      IY,TPIEN1
		LD      E,(IY+00H)
		LD      D,(IY+01H)
		LD      (DIVSOR),DE
		CALL    DIVIS
		LD      A,(QUOZIE+00H)
                JR      RAPP31
RAPP30:         CCF
		LD      A,00H
RAPP31:         LD      (TRAPP1),A      ;VERIFICO SE E'
                



                ;CALCOLO RAPPORTO POSIZINE PIENO TRAVERS S2

                LD      IX,TPIEN2       ;DIVIDO PIENO
		LD      E,(IX+00H)      ;PER DIECI
		LD      D,(IX+01H)      ;E SOTTRAGGO
		LD      (DIVDEN),DE     ;IL RISULTATO
		LD      BC,000AH        ;A POSIZIONE
		LD      (DIVSOR),BC     ;SE IL RISULTATO
		CALL    DIVIS           ;E' NEGATIVO
		LD      IX,QUOZIE       ;VUOLE DIRE CHE
		LD      E,(IX+00H)      ;DIVIDENDO
		LD      D,(IX+01H)      ;POSIZIONE X 10
                LD      IY,TPOSI2       ;CON PIENO AVRO'
		LD      L,(IY+00H)      ;UN NUMERO MINORE
		LD      H,(IY+01H)      ;DI 0,1 PER CUI
		SBC     HL,DE           ;CARICO IN MEM.
                JR      C,RAPP40        ;RAPPORTO ZERO.
		LD      E,(IY+00H)      ;SE LA SOTTRZIONE
		LD      D,(IY+01H)      ;NON DA RISULTATO
		LD      (MOLTI),DE      ;NEGATIVO PROCEDO
		LD      A,0AH           ;NELLA DIVISIONE
		LD      (MOLPL),A       ;POSIZIONE X 10
		CALL    MOLT            ;DIVISO PIENO
		LD      IX,PROD         ;E OTTERRO'UN
		LD      C,(IX+00H)      ;RISULTATO 
		LD      B,(IX+01H)      ;COMPRESO 
		LD      (DIVDEN),BC     ;TRA 0,1 E 0,9
                LD      IY,TPIEN2
		LD      E,(IY+00H)
		LD      D,(IY+01H)
		LD      (DIVSOR),DE
		CALL    DIVIS
		LD      A,(QUOZIE+00H)
                JR      RAPP41
RAPP40:         CCF
		LD      A,00H
RAPP41:         LD      (TRAPP2),A      ;VERIFICO SE E'
                

                ;CALCOLO SPESSORE SEGNO DI RIFERIMENTO

		;CALCOLO POSIZIONE TOTTALE TRAVERS
		;(TASES1 x 10) + TRAPP1 = TPOST1

		LD      DE,(TASES1)     ;TASES1 x 10
		LD      (MOLTI),DE
		LD      A,0AH
		LD      (MOLPL),A
		CALL    MOLT
		LD      DE,(PROD)
		LD      HL,(TRAPP1)
		LD      H,00H
		ADD     HL,DE
		LD      (TPOST1),HL
                LD      DE,(POSTO1)
		SBC     HL,DE
                JR      NC,SPES1        ;SE LA MISURA E'  SSSS
		CCF                     ;FATTA A CAVALLO
		LD      HL,0A000H       ;DI ZERO ENCODER
		LD      DE,(TPOST1)     ;TPOST1<POSTOT
		ADD     HL,DE           ;PER CUI SOMMO  
                LD      DE,(POSTO1)     ;A TPOSTO 40960
		SBC     HL,DE           ;E RIPETO SBC.
SPES1:
;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++             
;		LD      A,(PROVLT)      ;PRRR
;                CP      00H             ;PRRR
;                JR      NZ,PROVAT       ;PRRR
;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
		LD      (SPELE1),HL


                ;CALCOLO POSIZIONE TOTTALE TRAVERS S2

PROVAT:
                LD      DE,(TASES2)     ;FASES2 x 10
                LD      (MOLTI),DE
		LD      A,0AH
		LD      (MOLPL),A
		CALL    MOLT
		LD      DE,(PROD)
                LD      HL,(TRAPP2)
		LD      H,00H
		ADD     HL,DE
                LD      (TPOST2),HL
                LD      DE,(POSTO2)     ;SSSS
		SBC     HL,DE
                JR      NC,SPES2        ;SE LA MISURA E'
		CCF                     ;FATTA A CAVALLO
		LD      HL,0A000H       ;DI ZERO ENCODER
                LD      DE,(TPOST2)     ;POSTO2<POSTO1
		ADD     HL,DE           ;PER CUI SOMMO  
                LD      DE,(POSTO2)     ;A POSTO2 40960  SSSS
		SBC     HL,DE           ;E RIPETO SBC.
SPES2:
                LD      (SPELE2),HL

		;(ERRORE x DECIMILLES.IN DIV.ENC.)-
		;DISTANZA IN CENTIMILLESIMI : 1000 =ERRORE
                ;IN CENTESIMI

                LD      A,(SEGOFF)      ;WWSS
                CP      00H
                JR      Z,SPES4     
                CP      02H             ;
                JR      Z,SPES3         
                LD      DE,(OFFSET)     
                SBC     HL,DE           
                JR      SPES4           
SPES3:          LD      DE,(OFFSET)     ;SSSS
                ADD     HL,DE
SPES4:
              ;  LD      (SPEOFF),HL     ;WWSS 

                EX      DE,HL
                LD      HL,(SPELE1)     ;HL=SPESSORE SEGNO WWAA
		SBC     HL,DE
                JR      NC,TZ2
                LD      A,08H           ;TTCC
		LD      (TMSCOR),A      
		CCF
		EX      DE,HL
                LD      DE,(SPELE1)
		SBC     HL,DE
                JR      TZ3              

TZ2:            LD      A,01H           ;TTCC
		LD      (TMSCOR),A      
TZ3:            LD      (TERATT),HL
                EX      DE,HL           ;SSSS          
                LD      A,(MTASTI)      ;CONTROLLO SE
		CP      00H             ;SONO PASSATO
                JR      NZ,ERR11        ;DALLA TASIERA.
		LD      HL,0064H        ;SOMMO A ERPREC
                LD      BC,(TERPRE)     ;1mm IL RISULTATO
		ADD     HL,BC           ;LO SOTTRAGGO A
		SBC     HL,DE           ;ERATTU SE CARRY
                JR      NC,ERR12        ;SE VI E' STATA  
		CCF                     ;UNA LETTURA SBAL-
                LD      BC,(TERPRE)     ;LATA LA IGNORO.
                LD      (TERATT),BC     

			
		LD	A,(SALTO)	;SE SALTO E'	EEUU
		CP	00H		;ZERO CORREGGO EEUU
		JR	Z,ERR16		;SEMPRE EEUU

                LD      A,(CONSAT)      ;CONTROLLA CHE NON EEAA
		DEC     A               ;CHE NON RIMANGA
                LD      (CONSAT),A      ;IN BLOCCO PER PIU'EEAA
		CP      00H             ;DI N GIRI MEMO- 
                JR      Z,ERR13         ;RIZZATI IN SALTO  
		JP      GIR1            ;E POI
ERR13:          LD      (TERATT),DE     ;RICARICA L'ULTIMO
                LD      (TERPRE),DE     ;ERRORE LETTO
                JR      ERR12            
ERR11:          DEC     A               ;ATTESA 4 GIRI SE
		LD      (MTASTI),A      ;PASSATO DA TATSI.

ERR12:          LD      A,(SALTO)       ;CARICA I GIRI DI
                LD      (CONSAT),A      ;ATTESA.    EEAA
ERR16:		LD      A,(MKBUSY)      ;VEDO SE TASTIERA EEUU
		CP      00H             ;E' IN USO
		JP      NZ,GIR1

                ;JP      GABOT          ;WWAA
                ;           ;WWAA TOGLIERE 
                ;**********************************
                ;* TOGLIERE GABOT                 +WWAA
                ;**********************************

                CALL    TMEDIA
ERR15:          CALL    DISPLT          

                CALL    DISPLD
ERR14:          LD      HL,(BINSET)
                LD      (TDISPR),HL     
                LD      A,01H           ;SEGNALAZ.DISPLAY
		LD      (MDBUSY),A      ;OCCUPATO DA ERROR
                RET



                ;CALCOLO ERRORE MEDIO PER CORREZIONE TRAVERS.


TMEDIA:
                LD      A,(TPRIMB)      ;WWAA SSPP
                LD      B,A
                LD      IX,MOPE00               ;+5CH     ;DMEP1C WWAA   ;SU SEDICI
                LD      DE,(TVALOX)
                ADD     IX,DE
TMED01:
                LD      E,(IX)          ;DATI LETTI
                LD      D,(IX+01H)      ;INSERENDO
                LD      (IX+02H),E      ;IL NUOVO
                LD      (IX+03H),D      ;ERRORE AL
                DEC     IX              ;PRIMO POSTO
                DEC     IX              ;ED ELIMINANDO
                DJNZ    TMED01          ;L'ULTIMO
                INC     IX
                INC     IX


                LD      A,(TPRIMB)      ; LD      B,2FH           ;WWAA
                LD      B,A             ;WWAA
                LD      IY,MTRA00       ;+5CH   ;DMED1C       WWAA
                LD      DE,(TVALOX)     ;WWAA
                ADD     IY,DE           ;WWAA
TMED02:
                LD      E,(IY)          ;RIPETE QUELLO
                LD      D,(IY+01H)      ;VISTO SOPRA
                LD      (IY+02H),E      ;CON ALTRE  
                LD      (IY+03H),D      ;16 CELLE
                DEC     IY
                DEC     IY
                DJNZ    TMED02
                INC     IY
                INC     IY


                LD      DE,(TERATT)      ;WWAA LD      DE,(ERMEDI)    INSERIMENTO
                LD      BC,0000H         ;NUOVO ERRORE
                LD      A,(TMSCOR)       ;NELLA PRIMA
                CP      01H              ;DELLE 16 CELLE
                JR      Z,TMED04
TMED03:
                LD      (MOPE00),DE
                LD      (MTRA00),BC
                JR      TMED05
TMED04:         
                LD      (MOPE00),BC
                LD      (MTRA00),DE
TMED05:
                LD      A,(TSECOB)      ;WWAA
                LD      B,A             ;WWAA LD      B,30H            ;SOMMA DELLE  16 celle reali WWAA
                JR      NC,TMED06       ;48 CELLE 16 CELLE TMEPXX WWAA
                CCF                      ; 
TMED06:         LD      HL,0000H
TMED07:
                LD      E,(IX+00H)
                LD      D,(IX+01H)
                ADC     HL,DE
                INC     IX
                INC     IX
                DJNZ    TMED07
                LD      (SOMTR1),HL

                LD      A,(TSECOB)      ;WWAA
                LD      B,A             ;WWAA LD      B,30H            ;SOMMA DELLE  16 celle reali WWAA
                JR      NC,TMED08        ;48 CELLE 16 CELLE DTEDXX    WWAA
                CCF
TMED08:         LD      HL,0000H
TMED09:
                LD      E,(IY+00H)
                LD      D,(IY+01H)
                ADC     HL,DE
                INC     IY
                INC     IY
                DJNZ    TMED09

                LD      (SOMTR2),HL
                LD      DE,(SOMTR1)
                SBC     HL,DE
                JR      C,TMED11 
;                LD      A,(DIAGON)
;                CP      01H
;                JR      Z,TMED10 
                LD      A,116           ;t SIMBOLO ERRORE
                LD      (SIMCOT),A      ;LATO TRASMISS.
                LD      A,114           ;r
                LD      (SIMCOT+01H),A
                LD      A,97            ;a
                LD      (SIMCOT+02H),A
                JR      TMED14 
;TMED10:         LD      A,111           ;o SIMBOLO ERRORE
;                LD      (SIMCOT),A      ;LATO OPERATORE
;                LD      A,112           ;p
;                LD      (SIMCOT+01H),A
;                LD      A,101           ;e
;                LD      (SIMCOT+02H),A
;                JR      TMED14 
TMED11:         CCF
;                LD      A,(DIAGON)
;                CP      01H
;                JR      Z,TMED12 

                LD      A,111           ;o SIMBOLO ERRORE
                LD      (SIMCOT),A      ;LATO OPERATORE
                LD      A,112           ;p
                LD      (SIMCOT+01H),A
                LD      A,101           ;e
                LD      (SIMCOT+02H),A
                JR      TMED13 

;TMED12:         LD      A,116           ;t SIMBOLO ERRORE
;                LD      (SIMCOT),A      ;LATO TRASMISS.
;                LD      A,114           ;r
;                LD      (SIMCOT+01H),A
;                LD      A,97            ;a
;                LD      (SIMCOT+02H),A


TMED13:         EX      DE,HL
                LD      DE,(SOMTR2)
		SBC     HL,DE
TMED14:         LD      (DIVDEN),HL
                LD      BC,(TSECOB)     ;DIVISIONE
                LD      B,00H
                LD      (DIVSOR),BC     ;PER 16 GGAA
		CALL    DIVIS
		LD      HL,(QUOZIE)
                LD      (TERMED),HL
                ;LD      (BINSET),HL
                ;LD      (BINSE2),HL     
		LD      DE,0000H
		SBC     HL,DE
                JR      NZ,TMED15 
                LD      A,32            ;NO ERRORI MMDD11
                LD      (SIMCOT),A
                LD      (SIMCOT+01H),A
                LD      (SIMCOT+02H),A

TMED15:         ;JP      TRAFIL             WWAA        



                ;MEDIA ERRORE SU QUATTRO PER DISPLAY TRASVERSALE

                LD      A,(MTSHIF)      ;FFFE
                CP      00H
                JR      Z,MEDT02
                CP      0FFH
                JR      NC,MEDT01
                DEC     A
                LD      (MTSHIF),A
                LD      DE,(TSHIFT)
                ;FFFE LD      (FILONG),HL
                ;FFFE LD      (PREFIL),HL
                LD      (TERMED),DE
                LD      (TERATT),DE
                JP      MEDT015
MEDT01:         LD      A,00H
                LD      (MTSHIF),A

MEDT02:         
                LD      B,03H           ;FFFE        0FH           ;WWAA 
                LD      IX,DTRA00       ;
                LD      DE,0004H        ;FFFE     ;001CH
                ADD     IX,DE
MEDT03:
                LD      E,(IX)          ;DATI LETTI
                LD      D,(IX+01H)      ;INSERENDO
                LD      (IX+02H),E      ;IL NUOVO
                LD      (IX+03H),D      ;ERRORE AL
                DEC     IX              ;PRIMO POSTO
                DEC     IX              ;ED ELIMINANDO
                DJNZ    MEDT03          ;L'ULTIMO
                INC     IX
                INC     IX


                LD      B,03H           ;FFFE  0FH           ;WWAA
                LD      IY,DOPE00       ;WWAA
                LD      DE,0004H        ;FFFE     001CH
                ADD     IY,DE           ;WWAA
MEDT04:
                LD      E,(IY)          ;RIPETE QUELLO
                LD      D,(IY+01H)      ;VISTO SOPRA
                LD      (IY+02H),E      ;CON ALTRE  
                LD      (IY+03H),D      ;4 CELLE
                DEC     IY
                DEC     IY
                DJNZ    MEDT04
                INC     IY
                INC     IY


                LD      DE,(TERMED)      ;FFFE  (ERATTU)   INSERIMENTO
                LD      BC,0000H         ;NUOVO ERRORE
                LD      A,(TMSCOR)       ;NELLA PRIMA
                CP      01H              ;DELLE 4 CELLE
                JR      Z,MEDT06
MEDT05:
                LD      (DTRA00),DE
                LD      (DOPE00),BC
                JR      MEDT07
MEDT06:         
                LD      (DTRA00),BC
                LD      (DOPE00),DE
MEDT07:
                LD      B,04H              ;FFFE 10H            ;SOMMA DELLE  
                JR      NC,MEDT08        ;4 CELLE  WWAA
                CCF                      ; 
MEDT08:         LD      HL,0000H
MEDT09:
                LD      E,(IX+00H)
                LD      D,(IX+01H)
                ADC     HL,DE
                INC     IX
                INC     IX
                DJNZ    MEDT09
                LD      (SOMDT1),HL

                LD      B,04H            ; FFFE  10H            ;SOMMA DELLE   WWAA
                JR      NC,MEDT10        ;4 CELLE  WWAA
                CCF
MEDT10:         LD      HL,0000H
MEDT11:
                LD      E,(IY+00H)
                LD      D,(IY+01H)
                ADC     HL,DE
                INC     IY
                INC     IY
                DJNZ    MEDT11

                LD      (SOMDT2),HL
                LD      DE,(SOMDT1)
                SBC     HL,DE
                JR      C,MEDT12       ;SIMBOLO ERRORE
                JR      MEDT13   
MEDT12:         CCF
		EX      DE,HL
                LD      DE,(SOMDT2)     ;WWAA
		SBC     HL,DE
MEDT13:         LD      (DIVDEN),HL
                LD      BC,0004H        ;FFFE     0010H        ;
                LD      (DIVSOR),BC     ;
                CALL    DIVIS
                LD      DE,(QUOZIE)
                                        ;LD      (ERDILO),HL

                LD      HL,0004H        ;SCRIVO IL 
                SBC     HL,DE           ;SENSO DI
                JR      C,MEDT014       ;CORREZIONE
                LD      A,32            ;QUANDO  
                LD      (SIMCOT),A      ;SUPERA 4  
                LD      (SIMCOT+01H),A   
                LD      (SIMCOT+02H),A  
                JR      MEDT015
MEDT014:
                CCF
MEDT015:
                LD      (BINSET),DE
                LD      (BINSE2),DE
MEDT016:				;PUUU
                RET


		

		;CALCOLO CORREZIONE TRAVERS

CORTRA:         LD      HL,(TERMED)     ;CONTROLLO LA
		LD      DE,(ZONT)       ;ZONA MORTA
		SBC     HL,DE
		JR      NC,TCORRE
		CCF
		JP      TOFINE


		;#####################################
		;# CALCOLO CORREZIONE MOTORE TRAVERS #
		;# Et x Gt = TEMPO DI CORREZIONE     #   
		;#####################################

		
TCORRE:         LD      DE,(TERATT)     ;ZZZ
                LD      (MOLT24),DE
		LD      A,(GUATRA)
                LD      (MOLP24),A
                CALL    MOL24           ;########################
                LD      BC,(PROD24)     ;# VEDER DI ELIMINARE C #
                                        ;########################
                LD      A,(PROD24+02H)
                LD      (MDECOT),A      ;VALORE PER BBB
                CP      00H             ;EXTRA CORREZ.
                JR      NZ,TCORR1

                LD      (TMEM6),BC      ;ZZZ
                JR      TCORR2          
TCORR1:         LD      B,0FFH
                
                LD      (TMEM6),BC       ;BC = ERRORE ZZZ



		;ROUTINE DI CORREZIONE TRAVERS

TCORR2:         LD      A,(TATTES)      ;CONTROLLO CICLO
		DEC     A               ;DI ATTESA
		LD      (TATTES),A
		CP      00H
                JR      NZ,TOFINE       
                LD      A,(TCICLO)      ;FOFF RICARICO 
                LD      (TATTES),A      ;CICLO
                LD      A,(MEMC)        ;SE IN MANUALE
                BIT     4,A             ;SALTO
		JR      Z,TOFINE
		LD      A,(TMEM4)
		CP      00H
		JR      Z,TOFINE        ;2
                LD      A,B             ;SE ERRORE = 0
                OR      C               ;SALTO ZZZ VEDERE DI ELIMINARE C
                JR      Z,TOFINE        ;################################

                LD      A,(MDECOT)      ;ZZZ
                LD      (DECORT),A      ;ZZZ

                LD      BC,(TMEM6)       ;ZZZ
                LD      (TMEM5),BC       ;ZZZ

                LD      A,0B7H           ;JJJ   B7H   
                OUT     (73H),A
                LD      A,07H           ;ZZZ

                OUT     (73H),A         ;
                            

                NOP                     ;LD      BC,(DIAGON)     
                NOP                     ;LD      A,(TMSCOR)
                NOP                     ;ADD     A,C
                NOP                     ;CP      02H
                NOP                     ;JR      Z,TAURIT
                NOP                     ;CP      08H
                NOP                     ;JR      Z,TAURIT
		LD      A,(MEMC)        ;CORREZIONE 
		RES     7,A             ;LATO OPERAT.
		SET     6,A
		LD      (MEMC),A
                OUT     (PC),A
                LD      A,116           ;LATO OPERAT.
		LD      (SIMCOT),A
                JR      TOFINE          
TAURIT:         LD      A,(MEMC)        ;CORREZIONE 
		RES     6,A             ;LATO TRASM.
		SET     7,A
		LD      (MEMC),A
                OUT     (PC),A
                LD      A,111           ;LATO TRASM.
		LD      (SIMCOT),A
TOFINE:         RET                     
		      


		;SPOATMENTO REGISTRO TRAVERS
                

AZZTRA:         
                LD      HL,(SPELE1)     ;SOTTRAGGO TRA
                LD      DE,(SPELE2)     ;LORO I DUE 
                SBC     HL,DE           ;SPESSORI LA
                JR      NC,AZZTR1       ;DIFFERENZA LA
                CCF
                LD      A,01H           ;SOMMO A QUELLO  WWSS
                LD      (SEGOFF),A      ;INFERIORE IN
                EX      DE,HL           ;MODO DI AVERE
                LD      DE,(SPELE1)     ;ALL'AZZERAMENTO
                SBC     HL,DE           ;DUE SPESSORI
                LD      (OFFSET),HL     ;EGUALI E
                JR      AZZTR2          ;NEGATIVO O
AZZTR1:         LD      A,02H           ;POSITIVO  WWSS
                LD      (SEGOFF),A
                LD      (OFFSET),HL
AZZTR2:       
                JP      TPOFIN


TSPOST:         LD      HL,(TSHIFT)     
		LD      A,(TIUMEN)               
                CP      3FH              ;SSWW 78H
		JR      Z,SOTTRA

                LD      A,(SEGOFF)
                CP      02H
                JR      Z,AZZTR3
                LD      HL,(TSHIFT)
                LD      DE,(OFFSET)
                SBC     HL,DE
                JR      C,AZZTR5
                LD      A,02H
                LD      (SEGOFF),A
                JP      AZZTR4

AZZTR5:
                CCF
                EX      DE,HL
                LD      DE,(TSHIFT)
                SBC     HL,DE
                JR      AZZTR4


		JR      TPOFIN


SOTTRA:         
                LD      A,(SEGOFF)
                CP      01H
                JR      Z,AZZTR3
                LD      HL,(OFFSET)
                LD      DE,(TSHIFT)
                SBC     HL,DE
                JR      NC,AZZTR4
                CCF
                EX      DE,HL
                LD      DE,(OFFSET)
                SBC     HL,DE
                LD      A,01H
                LD      (SEGOFF),A
                JR      AZZTR4
AZZTR3:         LD      HL,(OFFSET)
                LD      DE,(TSHIFT)
                ADD     HL,DE
AZZTR4:         LD      (OFFSET),HL

TPOFIN:                                   ;EELL

; WWAA                  +++++++++++
                        ;+ELIMINATO+
                        ;+++++++++++

TSHFIN:                                   ;EELL
                LD      A,00H
                LD      (MAZTRA),A        ; GGAA


                RET



                ;ROUTINE DI DIVISIONE A 16 BIT


DIVIS:          EXX
		LD      DE,(DIVDEN)
		LD      BC,(DIVSOR)
DIV16:          XOR     A
		LD      H,A
		LD      L,A
		LD      A,10H
DV0:            RL      E
		RL      D
		ADC     HL,HL
		SBC     HL,BC
		JR      NC,DIV1
		ADD     HL,BC
DIV1:           CCF
		DEC     A
		JR      NZ,DV0
		EX      DE,HL
		ADC     HL,HL
		LD      (QUOZIE),HL
		EXX
		RET

		;ROUTINE DI MOLTIPLICAZIONE


MOLT:           EXX
		LD      DE,(MOLTI)      ;MOLTIPLICANDO
		LD      A,(MOLPL)       ;MOLTIPLICATORE
		LD      HL,00H
		LD      B,08H
MULT:           ADD     HL,HL
		RLA
		JR      NC,CHCNT
		ADD     HL,DE
CHCNT:          DJNZ    MULT            ;SE IL RISULTATO
		CP      00H             ;E'> DI FFFFH IL
		JR      Z,CHC1          ;REGISTRO A SARA'
		LD      HL,0FFFFH       ;DIVERSO DA 0 PER
CHC1:           LD      (PROD),HL       ;CUI CARICA IL MAX
		EXX                     ;(SOLO IN CASO DI
		RET                     ;CORREZ.MOTORE)



		;ROUTINE DI AGGIUSTAMENTO DECIMALE


AGGIUS:         LD      A,01H           ;OOOO AAAA
                LD      (MAGGIU),A      ;OOOO AAAA
                JP      BIN7            ;OOOO
AGGIU1:         LD      A,00H           ;OOOO AAAA
                LD      (MAGGIU),A      ;OOOO AAAA

                LD      A,(MAGGI1)
                CP      01H
                JR      Z,AGGIU2

                LD      IX,QUOZIE
                LD      HL,BINSET+02H   ;OOOO AAAA
		RRD

		CP      06H
		JR      Z,PI4
		CP      07H
		JR      Z,PI3
		CP      08H
		JR      Z,PI2
		CP      09H
		JR      Z,PI1
		JR      FINP1
PI4:            LD      L,(IX+00H)
		LD      H,(IX+01H)
		LD      BC,0004H
		ADD     HL,BC
		JR      FINP0
PI3:            LD      L,(IX+00H)
		LD      H,(IX+01H)
		LD      BC,0003H
		ADD     HL,BC
		JR      FINP0
PI2:            LD      L,(IX+00H)
		LD      H,(IX+01H)
		LD      BC,0002H
		ADD     HL,BC
		JR      FINP0
PI1:            LD      L,(IX+00H)
		LD      H,(IX+01H)
		LD      BC,0001H
		ADD     HL,BC
FINP0:          LD      (QUOZIE),HL
FINP1:          EXX
		RET


AGGIU2:         LD      IX,QUOZIE
                LD      HL,BINSET+02H   ;OOOO AAAA
		RRD

                CP      00H
                JR      Z,PIU0
                CP      01H
                JR      Z,MEN1
                CP      02H
                JR      Z,MEN2
                CP      03H
                JR      Z,PLUS2
                CP      04H
                JR      Z,PLUS1
                CP      05H
                JR      Z,PIU0
                CP      06H
                JR      Z,MEN1
                CP      07H
                JR      Z,MEN2
                CP      08H
                JR      Z,PLUS2
                CP      09H
                JR      Z,PLUS1

PLUS1:          INC     (IX)
                JR      PIU0
PLUS2:          INC     (IX)
                INC     (IX)
                JR      PIU0

MEN1:           DEC     (IX)
                JR      PIU0
MEN2:           DEC     (IX)
                DEC     (IX)
                JR      PIU0
PIU0:           LD      E,(IX+00H)       
                LD      D,(IX+01H)      

                LD      (DIVDEN),DE     ;DIVISIONE
                LD      BC,0005H        ;PER CINQUE
                LD      (DIVSOR),BC     ;PER AVERE
                CALL    DIVIS           ;IL NUMERO
                LD      A,00H           ;DI CARATTERI
                LD      (MAGGI1),A      ;OCCUPATI
                EXX                     ;DAL GATE

		RET


                
		;MOLTIPLICAZIONE A 24 BIT  

MOL24:          EXX                                                                                        
		LD      DE,(MOLT24)
		LD      A,(MOLP24)
		LD      BC,800H                
		LD      H,C
		LD      L,C
MPX1:           ADD     HL,HL
		RLA
		JR      NC,MPX2
		ADD     HL,DE
		ADC     A,C             ;IL RISULTATO
MPX2:           DJNZ    MPX1            ;SI TROVA IN AHL
		LD      (PROD24),HL
		LD      (PROD24+02H),A
		EXX
		RET



		;DIVIS. 24 PER 8 BIT (DIVISIONE PER 1000)
		

DI1000:         EXX
                LD      A,(ALTDIV)      
                CP      00H
                JR      Z,DI1004
                CP      01H             
                JR      Z,DI1005
                LD      IX,PTO032
                JR      DI1006
DI1004:         LD      IX,RESTO0
                JR      DI1006
DI1005:         LD      IX,TREST0       
DI1006:         LD      DE,3E8H         ;1000
                LD      BC,0000H
		LD      A,16
		LD      (MDIVIS),A
DI1001:         LD      H,(IX+03H)
		LD      L,(IX+02H)
		SBC     HL,DE
		JP      M,DI1002
		LD      (IX+03H),H      ;RESTO
		LD      (IX+02H),L
		INC     BC
DI1002:         SLA     (IX+00H)        ;ROTAZ.DIV.DO
		RL      (IX+01H)
		RL      (IX+02H)
		RL      (IX+03H)
		SLA     C               ;ROTAZ.QUO.TE
		RL      B
		LD      A,(MDIVIS)
		DEC     A
		LD      (MDIVIS),A
		JR      NZ,DI1001
		LD      H,(IX+03H)
		LD      L,(IX+02H)
		SBC     HL,DE
		JP      M,DI1003
		INC     BC
DI1003:         LD      (QU1000),BC
		EXX
		RET
		

	       ;MOLTIPLICZIONE A 32 BIT


MOL32:          EXX
                LD      B,04H
		LD      HL,PTO032
INIT:           LD      (HL),00H
		INC     HL
		DJNZ    INIT
SHIFTX:         LD      B,04H
		LD      IX,MDO032+03H
		XOR     A
RTX:            RR      (IX)
		DEC     IX
		DJNZ    RTX
		JR      NC,ZERO
		LD      B,04H
		LD      HL,PTO032
		LD      IY,MRE032
		CCF
NXTBYT:         LD      A,(IY)
		ADC     A,(HL)
		LD      (HL),A
		INC     IY
		INC     HL
		DJNZ    NXTBYT
ZERO:           LD      B,04H
		LD      IX,MDO032
		XOR     A
ZCHK:           OR      (IX)
		JR      NZ,SHIFTY
		INC     IX
		DJNZ    ZCHK
		JR      END32
SHIFTY:         LD      B,04H
		LD      IY,MRE032
		XOR     A
LEFTY:          RL      (IY)
		INC     IY
		DJNZ    LEFTY
		JR      SHIFTX
END32:          EXX
		RET

		;DIVISIONE, 32BIT DIVISO 4096


DIV32:          EXX
		LD      HL,(EDEND0)
		LD      DE,(EDEND2)
		LD      B,0DH           ;PER DIVIDERE
MPW1:           DJNZ    MPW2            ;IN 4096 SHIFTO
		JR      MPW8            ;A DESTRA 12 VOLTE
MPW2:           SRL     L
		SRL     H
		JR      C,MPW7
MPW3:           SRL     E
		JR      C,MPW6
MPW4:           SRL     D
		JR      C,MPW5
		JR      MPW1
MPW5:           CCF
		SET     7,E
		JR      MPW1
MPW6            CCF
		SET     7,H
		JR      MPW4
MPW7:           CCF
		SET     7,L
		JR      MPW3
MPW8:           LD      (QUOZ32),HL
		EXX
		RET


SOTT32:         EXX
		AND     A
		LD      HL,(MINUE0)     ;SALVO MINU-
		LD      (MIXUE0),HL     ;ENDO E SOT-
		LD      HL,(MINUE2)     ;TRAENDO
		LD      (MIXUE2),HL     ;ORIGINALI
		LD      HL,(SUBTR0)
		LD      (SUXTR0),HL
		LD      HL,(SUBTR2)
		LD      (SUXTR2),HL
		LD      HL,(MIXUE2)     ;VERIFICO CHI E'
		LD      DE,(SUXTR2)     ;IL NUMERO PIU'
		SBC     HL,DE           ;GRANDE PER PER
		JR      Z,SOT01         ;NON AVERE IL
		JR      NC,SOT03        ;RISULTATO NEGA-
		JR      SOT02           ;TIVO E PER
SOT01:          LD      HL,(MIXUE0)     ;DETERMINARE IL
		LD      DE,(SUXTR0)     ;SENSO DI CORREZ-
		SBC     HL,DE           ;ZIONE
		JR      NC,SOT03
SOT02:          LD      HL,(MIXUE0)
		LD      DE,(SUXTR0)
		LD      (MIXUE0),DE
		LD      (SUXTR0),HL
		LD      HL,(MIXUE2)
		LD      DE,(SUXTR2)
		LD      (MIXUE2),DE
		LD      (SUXTR2),HL     
		LD      A,08H
		LD      (MSCORR),A
		JR      SOT04
SOT03:          LD      A,01H
		LD      (MSCORR),A
SOT04:          LD      HL,(MIXUE0)
		LD      DE,(MIXUE2)
		LD      BC,(SUXTR0)
		AND     A
		SBC     HL,BC
		LD      (RESTO0),HL
                LD      (MREST0),HL     ;MEMORIZZO
                JR      NC,SOT05        ;IL RESTO
                DEC     DE              ;PERCHE' LA
SOT05:          EX      DE,HL           ;LOCAZIONE
                LD      DE,(SUXTR2)     ;REST0 VIENE
                AND     A               ;IN SEGUITO
                SBC     HL,DE           ;MODIFICATA
		LD      (RESTO2),HL
                LD      (MREST2),HL     
		EXX
		RET


TSOTT32:        EXX
		AND     A
                LD      HL,(TINUE0)     ;SALVO MINU-
                LD      (TIXUE0),HL     ;ENDO E SOT-
                LD      HL,(TINUE2)     ;TRAENDO
                LD      (TIXUE2),HL     ;ORIGINALI
                LD      HL,(TUBTR0)
                LD      (TUXTR0),HL
                LD      HL,(TUBTR2)
                LD      (TUXTR2),HL
                LD      HL,(TIXUE2)     ;VERIFICO CHI E'
                LD      DE,(TUXTR2)     ;IL NUMERO PIU'
		SBC     HL,DE           ;GRANDE PER PER
                JR      Z,TSOT01        ;NON AVERE IL
                JR      NC,TSOT03       ;RISULTATO NEGA-
                JR      TSOT02          ;TIVO E PER
TSOT01:         LD      HL,(TIXUE0)     ;DETERMINARE IL
                LD      DE,(TUXTR0)     ;SENSO DI CORREZ-
		SBC     HL,DE           ;ZIONE
                JR      NC,TSOT03
TSOT02:         LD      HL,(TIXUE0)
                LD      DE,(TUXTR0)
                LD      (TIXUE0),DE
                LD      (TUXTR0),HL
                LD      HL,(TIXUE2)
                LD      DE,(TUXTR2)
                LD      (TIXUE2),DE
                LD      (TUXTR2),HL     
		LD      A,08H
                LD      (TMSCOR),A
                JR      TSOT04
TSOT03:         LD      A,01H
                LD      (TMSCOR),A
TSOT04:         LD      HL,(TIXUE0)
                LD      DE,(TIXUE2)
                LD      BC,(TUXTR0)
		AND     A
		SBC     HL,BC
                LD      (TREST0),HL
                JR      NC,TSOT05
		DEC     DE
TSOT05:         EX      DE,HL
                LD      DE,(TUXTR2)
		AND     A
		SBC     HL,DE
                LD      (TREST2),HL
		EXX
		RET


		;SOMMA A 32 BIT


SOMM32:         EXX
		LD      HL,ADDEN0
		LD      DE,AUGEN0
		LD      B,04H
		AND     A
ADDW:           LD      A,(DE)
		ADC     A,(HL)
		LD      (HL),A
		INC     DE              ;IL RISULTATO
		INC     HL              ;SI TROVA NELLA
		DJNZ    ADDW            ;LOCAZIONE 
		EXX                     ;ADDEN0 E ADDEN2
		RET


CSOTT32:        EXX
                AND     A
                LD      HL,(CINUE2)
                LD      DE,(CUBTR2)
                SBC     HL,DE
                JR      NC,COT00
                LD      HL,(CINUE2)
                LD      (CINUE2),DE
                LD      (CUBTR2),HL
                LD      HL,(CINUE0)
                LD      DE,(CUBTR0)
                LD      (CINUE0),DE
                LD      (CUBTR0),HL
COT00:          LD      HL,(CINUE0)
                LD      DE,(CINUE2)
                LD      BC,(CUBTR0)
                AND     A
                SBC     HL,BC
                LD      (CESTO0),HL
                JR      NC,COT01
                DEC     DE
COT01:          EX      DE,HL
                LD      DE,(CUBTR2)
                AND     A
                SBC     HL,DE
                LD      (CESTO2),HL
                EXX
                RET


CSOM32:         EXX
                SCF
                CCF
                LD      HL,(CADDE0)
                LD      DE,(CAUGE0)
                ADC     HL,DE
                LD      (CSOMM0),HL
                LD      HL,(CADDE2)
                LD      DE,(CAUGE2)
                ADC     HL,DE
                LD      (CSOMM2),HL
                SCF
                CCF
                EXX
                RET


                ;ROUTINE PER LCD

TXSET:          LD      B,07H           ;TRASMISSIONE
TXSET1:         LD      A,(HL)          ;INIZIALIZ.LCD
                CALL    SERPAR
                INC     HL
                DJNZ    TXSET1
                RET


TX:             LD      B,14H           ;TRASMISSIONE
TX1:            LD      A,(HL)          ;20 CARATTERI
                CALL    SERPAR
                INC     HL
                DJNZ    TX1
                RET

TXUNO:          LD      B,01H
TXUNO1:         LD      A,(HL)
                CALL    SERPAR
                INC     HL
                DJNZ    TXUNO1
                RET

INISI:          CALL    RSZERO          
                LD      HL,SETTA
                CALL    TXSET
                CALL    SPETA
                CALL    RSUNO
                RET

ALTA:           CALL    RSZERO          
                CALL    TXUNO
                CALL    SPETA           
                CALL    RSUNO           
                CALL    SPETA
                RET

BASSA:          CALL    RSZERO
                LD      HL,SECUND
                CALL    TXUNO
                CALL    RSUNO
                RET

SERPAR:         PUSH    BC              ;TRASMISSIONE
                LD      B,08H           ;SERIALE PARAL-
                LD      C,A             ;LELO
SERPA1:         LD      A,(MEMB)
                RL      C
                JR      NC,WA1
                SET     7,A
                JR      WA2
WA1:            RES     7,A
WA2:            LD      (MEMB),A
                OUT     (PB),A
                LD      A,(MEMA)
                SET     1,A
                OUT     (PA),A
                RES     1,A
                OUT     (PA),A
                LD      (MEMA),A
                DJNZ    SERPA1
                LD      A,(MEMA)
                SET     3,A
                OUT     (PA),A
                RES     3,A
                OUT     (PA),A
                LD      (MEMA),A
                POP     BC
                RET


RSZERO:         LD      A,(MEMB)        ;METTO A ZERO
                RES     0,A             ;RS
                OUT     (PB),A
                LD      (MEMB),A
                RET

RSUNO:          LD      A,(MEMB)        ;METTO A UNO
                SET     0,A             ;RS
                OUT     (PB),A
                LD      (MEMB),A
                RET

SPETA:          LD      E,0B0H
SPETA1:         DEC     E
                JR      NZ,SPETA1
                RET




SETTA:  DEFB    38H, 0EH, 06H, 01H, 38H, 0EH, 06H, 00H


RELES1:
                ;  ZELO ELETTRONICA 
        DEFB    32, 32, 90, 69, 76, 79, 32, 69, 76, 69
        DEFB    84, 84, 82, 79, 78, 73, 67, 65, 32, 32

RELES2:           
                ;RELESE P1.0 06/02/07
        DEFB	82, 69, 76, 69, 83, 69, 32, 80, 49, 46   
        DEFB    48, 32, 48, 54, 47, 48, 50, 47, 48, 55 

FUNDIS:

                ;##### FUNSIUN #####
        DEFB    35, 35, 35, 35, 35, 32, 70, 85, 78, 83
        DEFB    73, 85, 78, 32, 35, 35, 35, 35, 35, 32

                ;##### FUNZIONE #####
        DEFB    35, 35, 35, 35, 35, 32, 70, 85, 78, 90
        DEFB    73, 79, 78, 69, 32, 35, 35, 35, 35, 35

                ;##### FONCTION #####
        DEFB    35, 35, 35, 35, 35, 32, 70, 79, 78, 67
        DEFB    84, 73, 79, 78, 32, 35, 35, 35, 35, 35

                ;##### FUNCTION #####
        DEFB    35, 35, 35, 35, 35, 32, 70, 85, 78, 67
        DEFB    84, 73, 79, 78, 32, 35, 35, 35, 35, 35

                ;###### FUNCION ######
        DEFB    35, 35, 35, 35, 35, 35, 32, 70, 85, 78
        DEFB    67, 73, 79, 78, 32, 35, 35, 35, 35, 35

FORCIL:
                ;  FURMAA CILINDER
        DEFB    32, 32, 70, 85, 82, 77, 65, 65, 32, 67
        DEFB    73, 76, 73, 78, 68, 69, 82, 32, 32, 32

                ;  FORMATO CILINDRO
        DEFB    32, 32, 70, 79, 82, 77, 65, 84, 79, 32
        DEFB    67, 73, 76, 73, 78, 68, 82, 79, 32, 32

                ; DIMENSION CYLINDER
        DEFB    32, 68, 73, 77, 69, 78, 83, 73, 79, 78
        DEFB    32, 67, 89, 76, 73, 78, 68, 69, 82, 32

                ;   CYLINDER SIZE
        DEFB    32, 32, 32, 67, 89, 76, 73, 78, 68, 69
        DEFB    82, 32, 83, 73, 90, 69, 32, 32, 32, 32

                ;  FORMATO CILINDRO
        DEFB    32, 32, 70, 79, 82, 77, 65, 84, 79, 32
        DEFB    67, 73, 76, 73, 78, 68, 82, 79, 32, 32

SOALLR:
                ;   LIMIT D'ALARME
        DEFB    32, 32, 32, 76, 73, 77, 73, 84, 32, 68
        DEFB    39, 65, 76, 65, 82, 77, 69, 32, 32, 32

                ;   SOGLIA ALLARME
        DEFB    32, 32, 32, 83, 79, 71, 76, 73, 65, 32
        DEFB    65, 76, 76, 65, 82, 77, 69, 32, 32, 32

                ;   SEUIL D'ALERTE
        DEFB    32, 32, 32, 83, 69, 85, 73, 76, 32, 68
        DEFB    39, 65, 76, 69, 82, 84, 69, 32, 32, 32

                ;  ALARM THRESHOLD
        DEFB    32, 32, 65, 76, 65, 82, 77, 32, 84, 72
        DEFB    82, 69, 83, 72, 79, 76, 68, 32, 32, 32

                ;   NIVEL D'ALARMA
        DEFB    32, 32, 32, 78, 73, 86, 69, 76, 32, 68
        DEFB    39, 65, 76, 65, 82, 77, 65, 32, 32, 32

AZZER1:

                ;*** METT A SERO ***
        DEFB    42, 42, 42, 32, 77, 69, 84, 84, 32, 65
        DEFB    32, 83, 69, 82, 79, 32, 42, 42, 42, 32

                ;*** AZZERAMENTO ***
        DEFB    42, 42, 42, 32, 65, 90, 90, 69, 82, 65
        DEFB    77, 69, 78, 84, 79, 32, 42, 42, 42, 32

                ;** METRE AU ZERO **
        DEFB    42, 42, 32, 77, 69, 84, 82, 69, 32, 65
        DEFB    85, 32, 90, 69, 82, 79, 32, 42, 42, 32

                ;** TO SET TO ZERO **
        DEFB    42, 42, 32, 84, 79, 32, 83, 69, 84, 32
        DEFB    84, 79, 32, 90, 69, 82, 79, 32, 42, 42 

                ;**** PONER CERO ****
        DEFB    42, 42, 42, 42, 32, 80, 79, 78, 69, 82
        DEFB    32, 67, 69, 82, 79, 32, 42, 42, 42, 42

AZZER2:
                ;CIRCONF. TRASVERSAL
        DEFB    67, 73, 82, 67, 79, 78, 70, 46, 32, 84
        DEFB    82, 65, 83, 86, 69, 82, 83, 65, 76, 32
POSSEG:
                ;   POSISION SEGN
        DEFB    32, 32, 32, 80, 79, 83, 73, 83, 73, 79
        DEFB    78, 32, 83, 69, 71, 78, 32, 32, 32, 32


                ;  POSIZIONE SEGNO
        DEFB    32, 32, 80, 79, 83, 73, 90, 73, 79, 78
        DEFB    69, 32, 83, 69, 71, 78, 79, 32, 32, 32

                ;  POSITION MARQUE
        DEFB    32, 32, 80, 79, 83, 73, 84, 73, 79, 78
        DEFB    32, 77, 65, 82, 81, 85, 69, 32, 32, 32

                ;   MARK POSITION
        DEFB    32, 32, 32, 77, 65, 82, 75, 32, 80, 79
        DEFB    83, 73, 84, 73, 79, 78, 32, 32, 32, 32

                ;   POSICION MARCA
        DEFB    32, 32, 32, 80, 79, 83, 73, 67, 73, 79
        DEFB    78, 32, 77, 65, 82, 67, 65, 32, 32, 32

COLORE:
                ;  COLOR: 
        DEFB    32, 32, 67, 79, 76, 79, 82, 58, 32, 32
        DEFB    32, 32, 109, 116, 47, 109, 32, 32, 32, 32
            

                ; COLORE:
        DEFB    32, 67, 79, 76, 79, 82, 69, 58, 32, 32
        DEFB    32, 32, 109, 116, 47, 109, 32, 32, 32, 32

                ;COULEUR:
        DEFB    67, 79, 85, 76, 69, 85, 82, 58, 32, 32
        DEFB    32, 32, 109, 116, 47, 109, 32, 32, 32, 32

                ; COLOUR:
        DEFB    32, 67, 79, 76, 79, 85, 82, 58, 32, 32
        DEFB    32, 32, 109, 116, 47, 109, 32, 32, 32, 32

                ;  COLOR: 
        DEFB    32, 32, 67, 79, 76, 79, 82, 58, 32, 32
        DEFB    32, 32, 109, 116, 47, 109, 32, 32, 32, 32
                


IIRIGA:

        DEFB    45, 45, 45, 45, 45, 45, 45, 45, 45, 45
        DEFB    45, 45, 45, 45, 45, 45, 45, 45, 45, 45

AVANTI:
                ;****** INANS *******
        DEFB    42, 42, 42, 42, 42, 42, 32, 73, 78, 65
        DEFB    78, 83, 32, 42, 42, 42, 42, 42, 42, 42

                ;****** AVANTI ******
        DEFB    42, 42, 42, 42, 42, 42, 32, 65, 86, 65
        DEFB    78, 84, 73, 32, 42, 42, 42, 42, 42, 42

                ;****** AVANT ******
        DEFB    42, 42, 42, 42, 42, 42, 32, 65, 86, 65
        DEFB    78, 84, 32, 42, 42, 42, 42, 42, 42, 32
                
                ;***** ADVANCE *****
        DEFB    42, 42, 42, 42, 42, 32, 65, 68, 86, 65
        DEFB    78, 67, 69, 32, 42, 42, 42, 42, 42, 32
                
                ;***** ADELANTE *****
        DEFB    42, 42, 42, 42, 42, 32, 65, 68, 69, 76
        DEFB    65, 78, 84, 69, 32, 42, 42, 42, 42, 42        
RITARD:
                ;****** INDREE ******
        DEFB    42, 42, 42, 42, 42, 42, 32, 73, 78, 68
        DEFB    82, 69, 69, 32, 42, 42, 42, 42, 42, 42

                ;***** RITARDO *****
        DEFB    42, 42, 42, 42, 42, 32, 82, 73, 84, 65
        DEFB    82, 68, 79, 32, 42, 42, 42, 42, 42, 32

                ;****** RETARD ******
        DEFB    42, 42, 42, 42, 42, 42, 32, 82, 69, 84
        DEFB    65, 82, 68, 32, 42, 42, 42, 42, 42, 42

                ;****** RETARD ******
        DEFB    42, 42, 42, 42, 42, 42, 32, 82, 69, 84
        DEFB    65, 82, 68, 32, 42, 42, 42, 42, 42, 42

                ;****** ATRAS *******
        DEFB    42, 42, 42, 42, 42, 42, 32, 65, 84, 82
        DEFB    65, 83, 32, 42, 42, 42, 42, 42, 42, 32
OPERAT:
                ;***** OPERADOR *****
        DEFB    42, 42, 42, 42, 42, 32, 79, 80, 69, 82
        DEFB    65, 68, 79, 82, 32, 42, 42, 42, 42, 42

                ;**** OPERATORE ****
        DEFB    42, 42, 42, 42, 32, 79, 80, 69, 82, 65
        DEFB    84, 79, 82, 69, 32, 42, 42, 42, 42, 32

                ;**** OPERATEUR ****
        DEFB    42, 42, 42, 42, 32, 79, 80, 69, 82, 65
        DEFB    84, 69, 85, 82, 32, 42, 42, 42, 42, 32

                ;***** OPERATOR *****
        DEFB    42, 42, 42, 42, 42, 32, 79, 80, 69, 82
        DEFB    65, 84, 79, 82, 32, 42, 42, 42, 42, 42

                ;**** TRABAJADOR ****
        DEFB    42, 42, 42, 42, 32, 84, 82, 65, 66, 65
        DEFB    74, 65, 68, 79, 82, 32, 42, 42, 42, 42

TRASMI:
                ;**** TRASMISION ****
        DEFB    42, 42, 42, 42, 32, 84, 82, 65, 83, 77
        DEFB    73, 83, 73, 79, 78, 32, 42, 42, 42, 42

                ;*** TRASMISSIONE ***
        DEFB    42, 42, 42, 32, 84, 82, 65, 83, 77, 73
        DEFB    83, 83, 73, 79, 78, 69, 32, 42, 42, 42

                ;*** TRANSMISSION ***
        DEFB    42, 42, 42, 32, 84, 82, 65, 78, 83, 77
        DEFB    73, 83, 83, 73, 79, 78, 32, 42, 42, 42

                ;*** TRANSMISSION ***
        DEFB    42, 42, 42, 32, 84, 82, 65, 78, 83, 77
        DEFB    73, 83, 83, 73, 79, 78, 32, 42, 42, 42

                ;*** TRANSMISION ***
        DEFB    42, 42, 42, 32, 84, 82, 65, 78, 83, 77
        DEFB    73, 83, 73, 79, 78, 32, 42, 42, 42, 32



OSGDIS:
                ; SEGNAL OSCILLOSCOPI
        DEFB    32, 83, 69, 71, 78, 65, 76, 32, 79, 83   ;OOGG
        DEFB    67, 73, 76, 76, 79, 83, 67, 79, 80, 73

                ;SEGNALE OSCILLOSCOPIO
        DEFB    83, 69, 71, 78, 65, 76, 69, 32, 79, 83  ;OOGG
        DEFB    67, 73, 76, 76, 79, 83, 67, 79, 80, 76 

                ;SIGNAL D'OSCILLOSCOPE
        DEFB    83, 73, 71, 78, 65, 76, 32, 68, 39, 79
        DEFB    83, 67, 73, 76, 76, 79, 83, 67, 80, 69

                ;    SCOPE SIGNAL
        DEFB    32, 32, 32, 32, 83, 67, 79, 80, 69, 32
        DEFB    83, 73, 71, 78, 65, 76, 32, 32, 32, 32

                ; SENAL D'OSCILLOSCOPE
        DEFB    32, 83, 69, 78, 65, 76, 32, 68, 39, 79
        DEFB    83, 67, 73, 76, 76, 79, 83, 67, 80, 69

FASEAU:
                ;* METT IN POSISION *
        DEFB    42, 32, 77, 69, 84, 84, 32, 73, 78, 32
        DEFB    80, 79, 83, 73, 83, 73, 79, 78, 32, 42

                ;*  FASE AUTOMATICA *
        DEFB    42, 32, 70, 65, 83, 69, 32, 65, 85, 84
        DEFB    79, 77, 65, 84, 73, 67, 65, 32, 42, 32

                ; PHASE AUTOMATIQUE
        DEFB    32, 80, 72, 65, 83, 69, 32, 65, 85, 84
        DEFB    79, 77, 65, 84, 73, 81, 85, 69, 32, 32

                ;* AUTOMATIC PHASE *
        DEFB    42, 32, 65, 85, 84, 79, 77, 65, 84, 73
        DEFB    67, 32, 80, 72, 65, 83, 69, 42, 32, 32

                ;* FASE AUTOMATICA
        DEFB    42, 32, 70, 65, 83, 69, 32, 65, 85, 84
        DEFB    79, 77, 65, 84, 73, 67, 65, 32, 42, 32

ESEGUI:
                ;******* FAA ********
        DEFB    42, 42, 42, 42, 42, 42, 42, 32, 70, 65
        DEFB    65, 32, 42, 42, 42, 42, 42, 42, 42, 42

                ;***** ESEGUITA *****
        DEFB    42, 42, 42, 42, 42, 32, 69, 83, 69, 71
        DEFB    85, 73, 84, 65, 32, 42, 42, 42, 42, 42

                ;******* FAIT *******
        DEFB    42, 42, 42, 42, 42, 42, 42, 32, 70, 65
        DEFB    73, 84, 32, 42, 42, 42, 42, 42, 42, 42

                ;******** OK ********
        DEFB    42, 42, 42, 42, 42, 42, 42, 42, 32, 79
        DEFB    75, 32, 42, 42, 42, 42, 42, 42, 42, 42

                ;******** OK ********
        DEFB    42, 42, 42, 42, 42, 42, 42, 42, 32, 79
        DEFB    75, 32, 42, 42, 42, 42, 42, 42, 42, 42

;ABILIT:
;                ;* MINGA ABILIDADA **
;        DEFB    42, 32, 77, 73, 78, 71, 65, 32, 65, 66
;        DEFB    73, 76, 73, 68, 65, 68, 65, 32, 42, 42
;
;                ;** NON ABILITATA ***
;        DEFB    42, 42, 32, 78, 79, 78, 32, 65, 66, 73
;        DEFB    76, 73, 84, 65, 84, 65, 32, 42, 42, 42
;
;                ;* NE PAS HABILITE **
;        DEFB    42, 32, 78, 69, 32, 80, 65, 83, 32, 72
;        DEFB    65, 66, 73, 76, 73, 84, 69, 32, 42, 42
;
;                ;***** DISABLE ******
;        DEFB    42, 42, 42, 42, 42, 32, 68, 73, 83, 65
;        DEFB    66, 76, 69, 32, 42, 42, 42, 42, 42, 42
;
;                ;* NO HABILITACION **
;        DEFB    42, 32, 78, 79, 32, 72, 65, 66, 73, 76
;        DEFB    73, 84, 65, 67, 73, 79, 78, 32, 42, 42
FINCOR:
                 ;  FINE CURSA CRAPA
         DEFB   32, 32, 70, 73, 78, 69, 32, 67, 85, 82
         DEFB   83, 65, 32, 67, 82, 65, 80, 65, 32, 32

                 ;  FINE CORSA TESTA
         DEFB   32, 32, 70, 73, 78, 69, 32, 67, 79, 82
         DEFB   83, 65, 32, 84, 69, 83, 84, 65, 32, 32

                 ;  FIN COURSE TETE
         DEFB   32, 32, 70, 73, 78, 32, 67, 79, 85, 82
         DEFB   83, 69, 32, 84, 69, 84, 69, 32, 32, 32

                 ; LIMIT SWITCH HEAD
         DEFB   32, 76, 73, 77, 73, 84, 32, 83, 87, 73 
         DEFB   84, 67, 72, 32, 72, 69, 65, 68, 32, 32

                 ; FIN CARRERA CABEZA
         DEFB   32, 70, 73, 78, 32, 67, 65, 82, 82, 69
         DEFB   82, 65, 32, 67, 65, 66, 69, 90, 65, 32

LATODX:
                 ;      BANDA DESTRA
         DEFB   32, 32, 32, 66, 65, 78, 68, 65, 32, 68 
         DEFB   69, 83, 84, 82, 65, 32, 32, 32, 32, 32 

                 ;    LATO DESTRO
         DEFB   32, 32, 32, 32, 76, 65, 84, 79, 32, 68 
         DEFB   69, 83, 84, 82, 79, 32, 32, 32, 32, 32 

                 ;     COTE DROIT
         DEFB   32, 32, 32, 32, 32, 67, 79, 84, 69, 32
         DEFB   68, 82, 79, 73, 84, 32, 32, 32, 32, 32

                 ;     RIGHT SIDE
         DEFB   32, 32, 32, 32, 32, 82, 73, 71, 72, 84
         DEFB   32, 83, 73, 68, 69, 32, 32, 32, 32, 32

                ;      LATO DERECHO
         DEFB   32, 32, 32, 32, 76, 65, 84, 79, 32, 68
         DEFB   69, 82, 69, 67, 72, 79, 32, 32, 32, 32


LATOSX:
                 ;    BANDA SINISTRA
         DEFB   32, 32, 66, 65, 78, 68, 65, 32, 83, 73 
         DEFB   78, 73, 83, 84, 82, 79, 32, 32, 32, 32 

                 ;    LATO SINISTRO
         DEFB   32, 32, 32, 76, 65, 84, 79, 32, 83, 73 
         DEFB   78, 73, 83, 84, 82, 79, 32, 32, 32, 32 

                 ;     COTE GAUCHE
         DEFB   32, 32, 32, 32, 67, 79, 84, 69, 32, 71
         DEFB   65, 85, 67, 72, 69, 32, 32, 32, 32, 32

                 ;     LEFT SIDE
         DEFB   32, 32, 32, 32, 32, 76, 69, 70, 84, 32
         DEFB   83, 73, 68, 69, 32, 32, 32, 32, 32, 32

                ;    LATO IZQUIERDO
         DEFB   32, 32, 32, 76, 65, 84, 79, 32, 73, 90
         DEFB   81, 85, 73, 69, 82, 68, 79, 32, 32, 32


CENMEC:
                ;**CENTRATURA TESTA**
         DEFB   42, 42, 67, 69, 78, 84, 82, 65, 84, 85
         DEFB   82, 65, 32, 84, 69, 83, 84, 65, 42, 42

                ;**CENTRATURA TESTA**
         DEFB   42, 42, 67, 69, 78, 84, 82, 65, 84, 85
         DEFB   82, 65, 32, 84, 69, 83, 84, 65, 42, 42

                ;**CENTRATURA TESTA**
         DEFB   42, 42, 67, 69, 78, 84, 82, 65, 84, 85
         DEFB   82, 65, 32, 84, 69, 83, 84, 65, 42, 42

                ;**CENTRATURA TESTA**
         DEFB   42, 42, 67, 69, 78, 84, 82, 65, 84, 85
         DEFB   82, 65, 32, 84, 69, 83, 84, 65, 42, 42

                ;**CENTRATURA TESTA**
         DEFB   42, 42, 67, 69, 78, 84, 82, 65, 84, 85
         DEFB   82, 65, 32, 84, 69, 83, 84, 65, 42, 42



CENELE:
                ; CRAPA  1=ON  0=OFF
         DEFB   32, 67, 82, 65, 80, 65, 32, 32, 49, 61
         DEFB   79, 78, 32, 32, 48, 61, 79, 70, 70, 32

                ; TESTA  1=ON  0=OFF
         DEFB   32, 84, 69, 83, 84, 65, 32, 32, 49, 61
         DEFB   79, 78, 32, 32, 48, 61, 79, 70, 70, 32
            
                ;  TETE  1=ON  0=OFF
         DEFB   32, 32, 84, 69, 84, 69, 32, 32, 49, 61
         DEFB   79, 78, 32, 32, 48, 61, 79, 70, 70, 32

                ;  HEAD  1=ON  0=OFF
         DEFB   32, 32, 72, 69, 65, 68, 32, 32, 49, 61
         DEFB   79, 78, 32, 32, 48, 61, 79, 70, 70, 32

                ;CABEZA  1=ON  0=OFF
         DEFB   67, 65, 66, 69, 90, 65, 32, 32, 49, 61
         DEFB   79, 78, 32, 32, 48, 61, 79, 70, 70, 32

ERRORE:
                ;******* EROR *******
        DEFB    42, 42, 42, 42, 42, 42, 42, 32, 69, 82
        DEFB    79, 82, 32, 42, 42, 42, 42, 42, 42, 42

                ;****** ERRORE ******
        DEFB    42, 42, 42, 42, 42, 42, 32, 69, 82, 82
        DEFB    79, 82, 69, 32, 42, 42, 42, 42, 42, 42

                ;****** ERREUR ******
        DEFB    42, 42, 42, 42, 42, 42, 32, 69, 82, 82
        DEFB    69, 85, 82, 32, 42, 42, 42, 42, 42, 42

                ;****** ERROR ******
        DEFB    42, 42, 42, 42, 42, 42, 32, 69, 82, 82
        DEFB    79, 82, 32, 42, 42, 42, 42, 42, 42, 32

                ;****** ERROR ******
        DEFB    42, 42, 42, 42, 42, 42, 32, 69, 82, 82
        DEFB    79, 82, 32, 42, 42, 42, 42, 42, 42, 32

                
NOSTAM:         ;* GH'E' NO EL SEGN *
        DEFB    42, 32, 71, 72, 39, 69, 39, 32, 78, 79
        DEFB    32, 69, 76, 32, 83, 69, 71, 78, 32, 42

                ;***  MANCA SEGNO ***
        DEFB    42, 42, 42, 32, 77, 65, 78, 67, 65, 32
        DEFB    83, 69, 71, 78, 79, 32, 42, 42, 42, 32

                ;*** PAS DE SIGNE ***
        DEFB    42, 42, 42, 32, 80, 65, 83, 32, 68, 69
        DEFB    32, 83, 73, 71, 78, 69, 32, 42, 42, 42

                ;** NO SIGNAL MARK **
        DEFB    42, 42, 32, 78, 79, 32, 83, 73, 71, 78
        DEFB    65, 76, 32, 77, 65, 82, 75, 32, 42, 42 

                ;** FALTA DE SIGNO **
        DEFB    42, 42, 32, 70, 65, 76, 84, 65, 32, 68
        DEFB    69, 32, 83, 73, 71, 78, 79, 42, 42, 32

VADASI:
                ;*** TROPP A DASI ***
        DEFB    42, 42, 42, 32, 84, 82, 79, 80, 80, 32
        DEFB    65, 68, 65, 83, 73, 32, 42, 42, 42, 32

                ;* BASSA VELOCITA' *
        DEFB    42, 32, 66, 65, 83, 83, 65, 32, 86, 69
        DEFB    76, 79, 67, 73, 84, 65, 39, 32, 42, 32

                ;*** BAS VITESSE ***
        DEFB    42, 42, 42, 32, 66, 65, 83, 32, 86, 73
        DEFB    84, 69, 83, 83, 69, 32, 42, 42, 42, 32

                ;**** LOW SPEED ****
        DEFB    42, 42, 42, 42, 32, 76, 79, 87, 32, 83
        DEFB    80, 69, 69, 68, 32, 42, 42, 42, 42, 32

                ;** MAQUINA LENTA **
        DEFB    42, 42, 32, 77, 65, 81, 85, 73, 78, 65
        DEFB    32, 76, 69, 78, 84, 65, 32, 42, 42, 32

ACELER:
                ;** PUSEE VELOCITAA *
        DEFB    42, 42, 32, 80, 85, 83, 69, 69, 32, 86
        DEFB    69, 76, 79, 67, 73, 84, 65, 65, 32, 42


                ;** ACCELERAZIONE ***
        DEFB    42, 42, 32, 65, 67, 67, 69, 76, 69, 82
        DEFB    65, 90, 73, 79, 78, 69, 32, 42, 42, 42

                ;*** ACCELERATION ***
        DEFB    42, 42, 42, 32, 65, 67, 67, 69, 76, 69
        DEFB    82, 65, 84, 73, 79, 78, 32, 42, 42, 42

                ;*** ACCELERATING ***
        DEFB    42, 42, 42, 32, 65, 67, 67, 69, 76, 69
        DEFB    82, 65, 84, 73, 78, 71, 32, 42, 42, 42

                ;***** ACELERAR *****
        DEFB    42, 42, 42, 42, 42, 32, 65, 67, 69, 76
        DEFB    69, 82, 65, 82, 32, 42, 42, 42, 42, 42

DECELE:
                ;*** DECELERASIUN ***
        DEFB    42, 42, 42, 32, 68, 69, 67, 69, 76, 69
        DEFB    82, 65, 83, 73, 85, 78, 32, 42, 42, 42

                ;** DECELERAZIONE ***
        DEFB    42, 42, 32, 68, 69, 67, 69, 76, 69, 82
        DEFB    65, 90, 73, 79, 78, 69, 32, 42, 42, 42

                ;*** DECELERATION ***
        DEFB    42, 42, 42, 32, 68, 69, 67, 69, 76, 69
        DEFB    82, 65, 84, 73, 79, 78, 32, 42, 42, 42 

                ;*** DECELERATION ***
        DEFB    42, 42, 42, 32, 68, 69, 67, 69, 76, 69
        DEFB    82, 65, 84, 73, 79, 78, 32, 42, 42, 42 


                ;***** DECELERAR ****
        DEFB    42, 42, 42, 42, 42, 32, 68, 69, 67, 69
        DEFB    76, 69, 82, 65, 82, 32, 42, 42, 42, 42



PARAME:
                ;#### PARAMETER ####
        DEFB    35, 35, 35, 35, 32, 80, 65, 82, 65, 77
        DEFB    69, 84, 69, 82, 32, 35, 35, 35, 35, 32

                ;#### PARAMETRI ####
        DEFB    35, 35, 35, 35, 32, 80, 65, 82, 65, 77
        DEFB    69, 84, 82, 73, 32, 35, 35, 35, 35, 32

                ;#### PARAMETRES ####
        DEFB    35, 35, 35, 35, 32, 80, 65, 82, 65, 77
        DEFB    69, 84, 82, 69, 83, 32, 35, 35, 35, 35

                ;#### PARAMETERS ####
        DEFB    35, 35, 35, 35, 32, 80, 65, 82, 65, 77
        DEFB    69, 84, 69, 82, 83, 32, 35, 35, 35, 35

                ;#### PARAMETROS ####
        DEFB    35, 35, 35, 35, 32, 80, 65, 82, 65, 77
        DEFB    69, 84, 82, 79, 83, 32, 35, 35, 35, 32

TRIDIS:
                ;VARIASION VELOCITAA
        DEFB    86, 65, 82, 73, 65, 83, 73, 79, 78, 32
        DEFB    86, 69, 76, 79, 67, 73, 84, 65, 65, 32

                ;VARIAZIONE VELOCITA'
        DEFB    86, 65, 82, 73, 65, 90, 73, 79, 78, 69
        DEFB    32, 86, 69, 76, 79, 67, 73, 84, 65, 39

                ;VARIATION DE VITESSE
        DEFB    86, 65, 82, 73, 65, 84, 73, 79, 78, 32
        DEFB    68, 69, 32, 86, 73, 84, 69, 83, 83, 69 

                ;******* TRIP *******
        DEFB    42, 42, 42, 42, 42, 42, 42, 32, 84, 82
        DEFB    73, 80, 32, 42, 42, 42, 42, 42, 42, 42

                ;VARIACION VELOCIDAD
        DEFB    86, 65, 82, 73, 65, 67, 73, 79, 78, 32
        DEFB    86, 69, 78, 79, 67, 73, 68, 65, 68, 32

GUADAG:
                ;GUADAGN CIRCONFEREN.
        DEFB    71, 85, 65, 68, 65, 71, 78, 32, 67, 73
        DEFB    82, 67, 79, 78, 70, 69, 82, 69, 78, 46

                ;GUADAGNO CIRCONFERE.
        DEFB    71, 85, 65, 68, 65, 71, 78, 79, 32, 67
        DEFB    73, 82, 67, 79, 78, 70, 69, 82, 69, 46

                ;GAIN CIRCONFERENTIAL
        DEFB    71, 65, 73, 78, 32, 67, 73, 82, 67, 79   ;CONTROLLARE
        DEFB    78, 70, 69, 82, 69, 78, 84, 73, 65, 76

                ;GAIN CIRCUMFERENTIAL
        DEFB    71, 65, 73, 78, 32, 67, 73, 82, 67, 85
        DEFB    77, 70, 69, 82, 69, 78, 84, 73, 65, 76

                ;GANANCIA CIRCUNFERE.
        DEFB    71, 65, 78, 65, 78, 67, 73, 65, 32, 67
        DEFB    73, 82, 67, 85, 78, 70, 69, 82, 69, 46

CICLIC:
                ;INTERVALL CIRCONFER.
        DEFB    73, 78, 84, 69, 82, 86, 65, 76, 76, 32
        DEFB    67, 73, 82, 67, 79, 78, 70, 69, 82, 46

                ;INTERVALLO CIRCONF.
        DEFB    73, 78, 84, 69, 82, 86, 65, 76, 76, 79
        DEFB    32, 67, 73, 82, 67, 79, 78, 70, 46, 32

                ;CYCLIQUE CIRCONFER.
        DEFB    67, 89, 67, 76, 73, 81, 85, 69, 32, 67
        DEFB    73, 82, 67, 79, 78, 70, 69, 82, 46, 32

                ;CYCLIC CIRCONFERENT.
        DEFB    67, 89, 67, 76, 73, 67, 32, 67, 73, 82  
        DEFB    67, 79, 78, 70, 69, 82, 69, 78, 84, 46

                ;CICLICO CIRCONFEREN.
        DEFB    67, 73, 67, 76, 73, 67, 79, 32, 67, 73  
        DEFB    82, 67, 79, 78, 70, 69, 82, 69, 78, 46

DISDER:
                ;#### DERIVATIV #####
        DEFB    35, 35, 35, 35, 32, 68, 69, 82, 73, 86
        DEFB    65, 84, 73, 86, 32, 35, 35, 35, 35, 32

                ;#### DERIVATIVO ####
        DEFB    35, 35, 35, 35, 32, 68, 69, 82, 73, 86
        DEFB    65, 84, 73, 86, 79, 32, 35, 35, 35, 35

                ;#### DERIVATIV ####
        DEFB    35, 35, 35, 35, 32, 68, 69, 82, 73, 86 
        DEFB    65, 84, 73, 86, 32, 35, 35, 35, 35, 32

                ;#### DERIVATIVE ####
        DEFB    35, 35, 35, 35, 32, 68, 69, 82, 73, 86
        DEFB    65, 84, 73, 86, 69, 32, 35, 35, 35, 35

                ;#### DERIVATIVO ####
        DEFB    35, 35, 35, 35, 32, 68, 69, 82, 73, 86
        DEFB    65, 84, 73, 86, 79, 32, 35, 35, 35, 35


INSERZ:
                ;LIMIT DE VELOCITA.
        DEFB    32, 76, 73, 77, 73, 84, 32, 68, 69, 32
        DEFB    86, 69, 76, 79, 67, 73, 84, 65, 39, 32

                ;SOGLIA D'INSERZIONE
        DEFB    83, 79, 71, 76, 73, 65, 32, 68, 39, 73
        DEFB    78, 83, 69, 82, 90, 73, 79, 78, 69, 32

                ; SEUIL D'INSERTION
        DEFB    32, 83, 69, 85, 73, 76, 32, 68, 39, 73
        DEFB    78, 83, 69, 82, 84, 73, 79, 78, 32, 32

                ;INSERT THRESHOLD
        DEFB    32, 32, 73, 78, 83, 69, 82, 84, 32, 84
        DEFB    72, 82, 69, 83, 72, 79, 76, 68, 32, 32 

                ; NIVEL DE INSERCION.
        DEFB    32, 78, 73, 86, 69, 76, 32, 68, 69, 32
        DEFB    32, 73, 78, 83, 69, 82, 67, 73, 79, 78

DSALTO:
                ;    SALT D'EROR
        DEFB    32, 32, 32, 32, 32, 83, 65, 76, 84, 32
        DEFB    68, 39, 69, 82, 79, 82, 32, 32, 32, 32

                ;   SALTO D'ERRORE
        DEFB    32, 32, 32, 83, 65, 76, 84, 79, 32, 68
        DEFB    39, 69, 82, 82, 79, 82, 69, 32, 32, 32

                ;   SAUT D'ERREUR
        DEFB    32, 32, 32, 83, 65, 85, 84, 32, 68, 39
        DEFB    69, 82, 82, 69, 85, 82, 32, 32, 32, 32

                ;     JUMP ERROR
        DEFB    32, 32, 32, 32, 32, 74, 85, 77, 80, 32
        DEFB    69, 82, 82, 79, 82, 32, 32, 32, 32, 32

                ;   SALTO DE ERROR
       DEFB     32, 32, 32, 83, 65, 76, 84, 79, 32, 68
       DEFB     69, 32, 69, 82, 82, 79, 82, 32, 32, 32

ZONAMO:
                ;SPASI MORT CIRCONFER
        DEFB    83, 80, 65, 83, 73, 32, 77, 79, 82, 84
        DEFB    32, 67, 73, 82, 67, 79, 78, 70, 69, 82

                ;ZONA MORTA CIRCONFER
        DEFB    90, 79, 78, 65, 32, 77, 79, 82, 84, 65
        DEFB    32, 67, 73, 82, 67, 79, 78, 70, 69, 82

                ;ZONE MORTE CIRCONFER
        DEFB    90, 79, 78, 65, 32, 77, 79, 82, 84, 69
        DEFB    32, 67, 73, 82, 67, 79, 78, 70, 69, 82

                ;CIRCONFER. DEAD ZONE
        DEFB    67, 73, 82, 67, 79, 78, 70, 69, 82, 46 
        DEFB    68, 69, 65, 68, 32, 90, 79, 78, 69, 32

                ;ZONA MUERTA CIRCONF.
        DEFB    90, 79, 78, 65, 32, 77, 85, 69, 82, 84 
        DEFB    65, 32, 67, 73, 82, 67, 79, 78, 70, 46
TRAGUA:
                ;GUADAGN TRASVERSAL
        DEFB    32, 71, 85, 65, 68, 65, 71, 78, 32, 84
        DEFB    82, 65, 83, 86, 69, 82, 83, 65, 76, 32

                ;GUADAGNO TRASVERSALE
        DEFB    71, 85, 65, 68, 65, 71, 78, 79, 32, 84
        DEFB    82, 65, 83, 86, 69, 82, 83, 65, 76, 69

                ;  TRASVERSAL GAIN 
        DEFB    32, 32, 84, 82, 65, 83, 86, 69, 82, 83
        DEFB    65, 76, 32, 71, 65, 73, 78, 32, 32, 32
                
                ;  TRASVERSAL GAIN 
        DEFB    32, 32, 84, 82, 65, 83, 86, 69, 82, 83
        DEFB    65, 76, 32, 71, 65, 73, 78, 32, 32, 32

                ;GANANCIA TRASVERSAL
        DEFB    71, 65, 78, 65, 78, 67, 73, 65, 32, 84
        DEFB    82, 65, 83, 86, 69, 82, 83, 65, 76, 32

TRACIC:
                ;INTERVALL TRASVERSAL
        DEFB    73, 78, 84, 69, 82, 86, 65, 76, 76, 32
        DEFB    84, 82, 65, 83, 86, 69, 82, 83, 65, 76

                ; CICLICO TRASVERSALE
        DEFB    32, 67, 73, 67, 76, 73, 67, 79, 32, 84
        DEFB    82, 65, 83, 86, 69, 82, 83, 65, 76, 69

                ;CYCLIQUE TRASVERSAL
        DEFB    67, 89, 67, 76, 73, 81, 85, 69, 32, 84
        DEFB    82, 65, 83, 86, 69, 82, 83, 65, 76, 32

                ; CYCLIC TRASVERSAL
        DEFB    32, 67, 89, 67, 76, 73, 67, 32, 84, 82
        DEFB    65, 83, 86, 69, 82, 83, 65, 76, 32, 32

                ;CICLICO TRASVERSAL
        DEFB    32, 67, 73, 67, 76, 73, 67, 79, 32, 84
        DEFB    82, 65, 83, 86, 69, 82, 83, 65, 76, 32

TRAZON:
                ;SPASI MORT TRASVERS.
        DEFB    83, 80, 65, 83, 73, 32, 77, 79, 82, 84
        DEFB    32, 84, 82, 65, 83, 86, 69, 82, 83, 46

                ;ZONA MORTA TRASVERS.
        DEFB    90, 79, 78, 65, 32, 77, 79, 82, 84, 65
        DEFB    32, 84, 82, 65, 83, 86, 69, 82, 83, 46

                ;ZONE MORTE TRASVERS.
        DEFB    90, 79, 78, 65, 32, 77, 79, 82, 84, 69
        DEFB    32, 84, 82, 65, 83, 86, 69, 82, 83, 46

                ;TRASVERSAL DEAD ZONE    
        DEFB    84, 82, 65, 83, 86, 69, 82, 83, 65, 76
        DEFB    32, 68, 69, 65, 68, 32, 90, 79, 78, 69

                ;ZONA MUERTA TRASVER.
        DEFB    90, 79, 78, 65, 32, 77, 85, 69, 82, 84
        DEFB    65, 32, 84, 82, 65, 83, 86, 69, 82, 46

DISLIN:
                ;   -1I-2F-3GB-4E-
        DEFB    32, 32, 32, 45, 49, 73, 45, 50, 70, 45 
        DEFB    51, 71, 66, 45, 52, 69, 45, 32, 32, 32 

DIADIS:
                ;   DIAGONAL LATO
        DEFB    32, 32, 32, 68, 73, 65, 71, 79, 78, 65
        DEFB    76, 32, 76, 65, 84, 79, 32, 32, 32, 32

                ;   DIAGONALE LATO
        DEFB    32, 32, 32, 68, 73, 65, 71, 79, 78, 65
        DEFB    76, 69, 32, 76, 65, 84, 79, 32, 32, 32

                ;   DIAGONALE COTE
        DEFB    32, 32, 32, 68, 73, 65, 71, 79, 78, 65
        DEFB    76, 69, 32, 67, 79, 84, 69, 32, 32, 32

                ;   DIAGONAL SIDE
        DEFB    32, 32, 32, 68, 73, 65, 71, 79, 78, 65
        DEFB    76, 32, 83, 73, 68, 69, 32, 32, 32, 32

                ;   DIAGONAL LATO
        DEFB    32, 32, 32, 68, 73, 65, 71, 79, 78, 65
        DEFB    76, 32, 76, 65, 84, 79, 32, 32, 32, 32

DIADI1:
                ;***** OPERADOR *****
        DEFB    32, 32, 32, 32, 32, 32, 79, 80, 69, 82
        DEFB    65, 68, 79, 82, 32, 32, 32, 32, 32, 32

                ;**** OPERATORE ****
        DEFB    32, 32, 32, 32, 32, 79, 80, 69, 82, 65
        DEFB    84, 79, 82, 69, 32, 32, 32, 32, 32, 32

                ;**** OPERATEUR ****
        DEFB    32, 32, 32, 32, 32, 79, 80, 69, 82, 65
        DEFB    84, 69, 85, 82, 32, 32, 32, 32, 32, 32

                ;***** OPERATOR *****
        DEFB    32, 32, 32, 32, 32, 32, 79, 80, 69, 82
        DEFB    65, 84, 79, 82, 32, 32, 32, 32, 32, 32

                ;**** TRABAJADOR ****
        DEFB    32, 32, 32, 32, 32, 84, 82, 65, 66, 65
        DEFB    74, 65, 68, 79, 82, 32, 32, 32, 32, 32


DIADI2:
                ;**** TRASMISION ****
        DEFB    32, 32, 32, 32, 32, 84, 82, 65, 83, 77
        DEFB    73, 83, 73, 79, 77, 32, 32, 32, 32, 32

                ;*** TRASMISSIONE ***
        DEFB    32, 32, 32, 32, 84, 82, 65, 83, 77, 73
        DEFB    83, 83, 73, 79, 77, 69, 32, 32, 32, 32

                ;*** TRANSMISSION ***
        DEFB    32, 32, 32, 32, 84, 82, 65, 78, 83, 77
        DEFB    73, 83, 83, 73, 79, 78, 32, 32, 32, 32

                ;*** TRANSMISSION ***
        DEFB    32, 32, 32, 32, 84, 82, 65, 78, 83, 77
        DEFB    73, 83, 83, 73, 79, 78, 32, 32, 32, 32

                ;*** TRANSMISION ***
        DEFB    32, 32, 32, 32, 84, 82, 65, 78, 83, 77
        DEFB    73, 83, 73, 79, 78, 32, 32, 32, 32, 32



DITEST:
                ;******* TEST *******
        DEFB    35, 35, 35, 35, 35, 35, 35, 32, 84, 69
        DEFB    83, 84, 32, 35, 35, 35, 35, 35, 35, 35

TTESTA:
                ;PROEUVA DE LA CRAPA
        DEFB    80, 82, 79, 65, 85, 86, 65, 32, 68, 69
        DEFB    32, 76, 65, 32, 67, 82, 65, 80, 65, 32

                ;  TEST DELLA TESTA
        DEFB    32, 32, 84, 69, 83, 84, 32, 68, 69, 76
        DEFB    76, 65, 32, 84, 69, 83, 84, 65, 32, 32

                ;  TEST DE LA TETE
       DEFB     32, 32, 84, 69, 83, 84, 32, 68, 69, 32
       DEFB     76, 65, 32, 84, 69, 84, 69, 32, 32, 32

                ;     HEAD TEST
       DEFB     32, 32, 32, 32, 32, 72, 69, 65, 68, 32
       DEFB     84, 69, 83, 84, 32, 32, 32, 32, 32, 32

                ;TEST CABEZA ESPLORAD
       DEFB     84, 69, 83, 84, 32, 67, 65, 66, 69, 90
       DEFB     65, 32, 69, 83, 80, 76, 79, 82, 65, 68

TENCOD:

                ;    TEST ENCODER 
        DEFB    32, 32, 32, 32, 84, 69, 83, 84, 32, 69
        DEFB    78, 67, 79, 68, 69, 82, 32, 32, 32, 32


LAVANO:
                ;****** NOT OK ******
        DEFB    35, 35, 35, 35, 35, 35, 32, 78, 79, 84
        DEFB    32, 79, 75, 32, 35, 35, 35, 35, 35, 35

LAVA:   
                ;******** OK ********
        DEFB    35, 35, 35, 35, 35, 35, 35, 35, 32, 79
        DEFB    75, 32, 35, 35, 35, 35, 35, 35, 35, 35

PROGR1:
                ;  PROGRAMMA PUNTO_07  ;OO11  LLLL
        DEFB    32, 80, 82, 79, 71, 82, 65, 77, 77, 65
        DEFB    32, 80, 85, 78, 84, 79, 95, 48, 55, 32

PROGR2:
                ;    DEL 27/04/04    ;
        DEFB    32, 32, 32, 32, 68, 69, 76, 32, 50, 55
        DEFB    47, 48, 52, 47, 48, 52, 32, 32, 32, 32



SECUND: DEFB    0C0H

NETA:   DEFB    01H



TABLE:          DEFB    00H             ;0
		DEFB    01H             ;1
		DEFB    02H             ;2
		DEFB    03H             ;3
		DEFB    04H             ;4
		DEFB    05H             ;5
		DEFB    06H             ;6
		DEFB    07H             ;7
		DEFB    08H             ;8
		DEFB    09H             ;9
		DEFB    0AH             ;CLEAR
		DEFB    0BH             ;ENTER
                DEFB    0CH             ;PIU/AVANTI
                DEFB    0DH             ;MENO/RITARDO
                DEFB    0EH             ;MAN/CIRCONF.
		DEFB    0FH             ;FUNZIONE
                DEFB    10H             ;AUTO/CIRCONF
                DEFB    11H             ;MAN/TRAVERS
                DEFB    12H             ;AUTO/TRAVERS
                DEFB    13H             ;OPERATORE
                DEFB    14H             ;TRASMISSIONE
                DEFB    15H             ;PUNTO
                DEFB    16H             ;PARAMETRI
                DEFB    17H             ;TEST



SSEG:           DEFB    3FH             ;0
		DEFB    06H             ;1
		DEFB    5BH             ;2
		DEFB    4FH             ;3
		DEFB    66H             ;4
		DEFB    6DH             ;5
		DEFB    7DH             ;6
		DEFB    07H             ;7
		DEFB    7FH             ;8
		DEFB    6FH             ;9


		;CONVERSIONE BINARIO SETTE SGMENTI

		;REG. D CONTIENE IL NUMERO DI BYTE BINARI
		;REG. E CONTIENE IL NUMERO DI BYTE BCD
                ;ADDR. 4200H E 4201H MEM. NUMERO BINARIO
                ;ADDR. 4202H E 4203H MEM. NUMERO BCD


BIN7:           EXX
                LD      D,02H           ;OOOO AAAA
		LD      E,05H
		LD      A,00H
		LD      B,E
		LD      HL,BINSET+02H
CLR:            LD      (HL),A
		INC     HL
		DJNZ    CLR
		LD      A,D             ;A=NUMERO BYTE
		ADD     A,A
		ADD     A,A
		ADD     A,A
		LD      C,A             ;C=NUMERO BIT
LOOP:           LD      L,00H
		LD      B,D
SHLB:           RL      (HL)
		INC     HL
		DJNZ    SHLB
		LD      L,02H
		LD      B,E
BCDADJ:         LD      A,(HL)
		ADC     A,A
		DAA
		LD      (HL),A
		INC     HL
		DJNZ    BCDADJ
		DEC     C
		JR      NZ,LOOP
                LD      A,(MAGGIU)      ;OOOO
                CP      01H
                JP      Z,AGGIU1        ;OOOO



		;METTE IN MEMORIA UN SINGOLO BCD

		LD      IY,BINSET+05H   ;TAB.BCD SING-1
                LD      HL,BINSET+02H   ;TAB.COPPIA BCD
		RRD
		LD      (IY+01H),A
		RRD
		LD      (IY+02H),A
                INC     HL              
		RRD
		LD      (IY+03H),A
		RRD
		LD      (IY+04H),A
                INC     HL              
		RRD
		LD      (IY+05H),A

                LD      A,(VELMEM)      ;QUANDO ESE-
                CP      00H             ;GUE VELOCITA'
                JR      Z,BIOTTD        ;RITORNA DA 
                LD      HL,BINSET+06H   ;QUESTO PUNTO
                LD      DE,VELBCD
                LD      BC,0003H
                LDIR
                RET

BIOTTD:         LD      IY,BINSET+05H   
                LD      IX,SECFUN+07H   
                LD      A,(IY+01H)      
                ADD     A,48
                LD      (IX+04H),A
                LD      A,(IY+02H)      
                ADD     A,48
                LD      (IX+03H),A
                LD      A,(IY+03H)      
                ADD     A,48
                LD      (IX+02H),A
                LD      A,(IY+04H)      
                ADD     A,48
                LD      (IX+01H),A

                CALL    TXUNO           ;DD111
                CALL    BASSA
                LD      HL,SECFUN
                CALL    TX
		EXX
                RET



		;REG. D CONTIENE IL NUMERO DI BYTE BINARI
		;REG. E CONTIENE IL NUMERO DI BYTE BCD
                ;ADDR. 4220H E 4221H MEM. NUMERO BINARIO
                ;ADDR. 4222H E 4223H MEM. NUMERO BCD

DISPLL:         EXX
                LD      D,02H
                LD      E,05H
		LD      A,00H
		LD      B,E
                LD      HL,BINSE1+02H
CLRL:           LD      (HL),A
		INC     HL
                DJNZ    CLRL
		LD      A,D             ;A=NUMERO BYTE
		ADD     A,A
		ADD     A,A
		ADD     A,A
		LD      C,A             ;C=NUMERO BIT
LOOPL:          LD      L,20H
		LD      B,D
SHLBL:          RL      (HL)
		INC     HL
                DJNZ    SHLBL
                LD      L,22H
		LD      B,E
BCDAJL:         LD      A,(HL)
		ADC     A,A
		DAA
		LD      (HL),A
		INC     HL
                DJNZ    BCDAJL
		DEC     C
                JR      NZ,LOOPL


		;METTE IN MEMORIA UN SINGOLO BCD

                LD      IY,BINSE1+05H   ;TAB.BCD SING-1
                LD      HL,BINSE1+02H   ;TAB.COPPIA BCD
		RRD
		LD      (IY+01H),A
		RRD
		LD      (IY+02H),A
                INC     HL              
		RRD
		LD      (IY+03H),A
		RRD
		LD      (IY+04H),A
                INC     HL              
		RRD
		LD      (IY+05H),A
                EXX
                RET

		;REG. D CONTIENE IL NUMERO DI BYTE BINARI
		;REG. E CONTIENE IL NUMERO DI BYTE BCD
                ;ADDR. 4230H E 4231H MEM. NUMERO BINARIO
                ;ADDR. 4232H E 4233H MEM. NUMERO BCD

DISPLT:         EXX
                LD      D,02H
                LD      E,05H
		LD      A,00H
		LD      B,E
                LD      HL,BINSE2+02H
CLRT:           LD      (HL),A
		INC     HL
                DJNZ    CLRT
		LD      A,D             ;A=NUMERO BYTE
		ADD     A,A
		ADD     A,A
		ADD     A,A
		LD      C,A             ;C=NUMERO BIT
LOOPT:          LD      L,30H
		LD      B,D
SHLBT:          RL      (HL)
		INC     HL
                DJNZ    SHLBT
                LD      L,32H
		LD      B,E
BCDAJT:         LD      A,(HL)
		ADC     A,A
		DAA
		LD      (HL),A
		INC     HL
                DJNZ    BCDAJT
		DEC     C
                JR      NZ,LOOPT


		;METTE IN MEMORIA UN SINGOLO BCD

                LD      IY,BINSE2+05H   ;TAB.BCD SING-1
                LD      HL,BINSE2+02H   ;TAB.COPPIA BCD
		RRD
		LD      (IY+01H),A
		RRD
		LD      (IY+02H),A
                INC     HL              
		RRD
		LD      (IY+03H),A
		RRD
		LD      (IY+04H),A
                INC     HL              
		RRD
		LD      (IY+05H),A
                EXX
                RET

DISPLD:         EXX
                LD      IY,BINSE1+05H   
                LD      IX,SECERR       
                LD      A,(IY+01H)      
                CP      05H             ;PER AVERE
                JR      C,GIGI4         ;SOLO 0 o 5
                LD      A,05H
                JR      GIGI5
GIGI4:          LD      A,00H                
GIGI5:          ADD     A,48            
                LD      (IX+05H),A
                LD      A,(IY+02H)      
                ADD     A,48
                LD      (IX+04H),A
                LD      A,(IY+03H)      
                ADD     A,48
                LD      (IX+02H),A
                LD      A,(IY+04H)      
                LD      A,44            ;,
                LD      (IX+03H),A
                LD      A,58            ;:
                LD      (IX+01H),A
                LD      A,76            ;L
                LD      (IX+00H),A
                LD      A,(SIMCOL)
                LD      (IX+06H),A
                LD      A,(SIMCOL+01H)  
                LD      (IX+07H),A
                LD      A,(SIMCOL+02H)
                LD      (IX+08H),A

                LD      A,(SIMCOT)
                LD      (IX+11H),A
                LD      A,(SIMCOT+01H)
                LD      (IX+12H),A
                LD      A,(SIMCOT+02H)
                LD      (IX+13H),A
                LD      IY,BINSE2+05H   
                LD      IX,SECERR       
                LD      A,(IY+01H)      
                CP      05H             ;PER AVERE
                JR      C,GIGI6         ;SOLO 0 o 5
                LD      A,05H
                JR      GIGI7
GIGI6:          LD      A,00H                
GIGI7:          ADD     A,48            
                LD      (IX+10H),A
                LD      A,(IY+02H)      
                ADD     A,48
                LD      (IX+0FH),A
                LD      A,(IY+03H)      
                ADD     A,48
                LD      (IX+0DH),A
                LD      A,(IY+04H)      
                LD      A,44            ;,
                LD      (IX+0EH),A
                LD      A,58            ;:
                LD      (IX+0CH),A
                LD      A,84            ;T
                LD      (IX+0BH),A
                LD      A,32            ;VUOTO
                LD      (IX+09H),A
                LD      (IX+0AH),A




                LD      IX,VELBCD
                LD      A,(IX)
                ADD     A,48
                LD      (NUMCOL+13H),A  ;UNITA'
                INC     IX
                LD      A,(IX)
                ADD     A,48
                LD      (NUMCOL+12H),A  ;DECINE
                INC     IX
                LD      A,(IX)
                ADD     A,48
                LD      (NUMCOL+11H),A  ;CENTINAIA


                LD      A,(SEQSEG)      
                ADD     A,48
                LD      (NUMCOL+09H),A  


                CALL    INISI           
                LD      HL,NUMCOL
                CALL    TX              

GIGI1:          CALL    TXUNO           
                CALL    BASSA
                LD      HL,SECERR
                CALL    TX

		EXX
                RET



		;###########################
		;# CALCOLO DELLA  VELOCITA'#
		;###########################

		;4mS x 4096 = 16384000
		;60\1638400 = 0,000003662
		;0,000003662 x CILINDRO = X
		;X\1000 = COSVEL (COSVEL E' CALCOLATA
		;AL CAMBIO CILINDRO)
		;COSVEL x IMPVEL = Y
		;Y/1000 = VELOCITA m/m

VELO:           LD      DE,(COSVEL)
		LD      (MDO032),DE
		LD      DE,0000H
		LD      (MDO232),DE
		LD      (MRE232),DE
		LD      DE,(IMPVEL)
		LD      (MRE032),DE
		LD      A,02H           
		LD      (ALTDIV),A      
		CALL    MOL32
		CALL    DI1000
		LD      BC,(QU1000)     ;VELOCITA         
		LD      (ISTVEL),BC     ;ISTANTANEA    

                ;MEDIA VELOCITA SU QUATTRO LETTURE WWAA WWNN

                LD      B,03H           ;WWAA WWNN
                LD      IX,MVEL00       ;
                LD      DE,0004H        ;WWNN
                ADD     IX,DE
MEDV01:
                LD      E,(IX)          ;DATI LETTI
                LD      D,(IX+01H)      ;INSERENDO
                LD      (IX+02H),E      ;IL NUOVO
                LD      (IX+03H),D      ;DATO AL
                DEC     IX              ;PRIMO POSTO
                DEC     IX              ;ED ELIMINANDO
                DJNZ    MEDV01          ;L'ULTIMO
                INC     IX
                INC     IX


                LD      DE,(ISTVEL)      ;
                LD      (MVEL00),DE

                LD      B,04H            ;SOMMA DELLE  WWNN
                JR      NC,MEDV02        ;4 CELLE  WWAA   WWNN
                CCF                      ; 
MEDV02:         LD      HL,0000H
MEDV03:
                LD      E,(IX+00H)
                LD      D,(IX+01H)
                ADC     HL,DE
                INC     IX
                INC     IX
                DJNZ    MEDV03
                

                LD      (DIVDEN),HL
                LD      BC,0004H        ;WWNN
                LD      (DIVSOR),BC     ;
		CALL    DIVIS
		LD      HL,(QUOZIE)

		LD      (VELMED),HL                 

		LD      DE,(VELPRE)     ;SE NON CAMBIA
		SBC     HL,DE           ;NON AGGIORNO
                JR      Z,MEDV05        ;IL DISPLAY ZZZ
                JR      NC,MEDV04
		CCF

MEDV04:         LD      HL,(VELMED)

		LD      (BINSET),HL     ;ZZZ
		LD      A,01H
		LD      (VELMEM),A
		CALL    BIN7
		LD      A,00H
		LD      (VELMEM),A
MEDV05:         RET





                ;SCRITTURA ACCELLERA            
 


ACCEL:          LD      A,(LINGUA)
		CP      00H
                JR      Z,ACCM
		CP      01H
                JR      Z,ACCI
		CP      02H
                JR      Z,ACCF
		CP      03H
                JR      Z,ACCGB
                CP      04H
                JR      Z,ACCE
                JR      ACCFIN
ACCM:           CALL    BASSA
                LD      HL,ACELER
                JR      ACCTX
ACCI:           CALL    BASSA
                LD      HL,ACELER+14H
                JR      ACCTX
ACCF:           CALL    BASSA
                LD      HL,ACELER+28H
                JR      ACCTX
ACCGB:          CALL    BASSA
                LD      HL,ACELER+3CH
                JR      ACCTX
ACCE:           CALL    BASSA
                LD      HL,ACELER+50H
ACCTX:          CALL    TX
                CALL    RITVEL   
		;CALL	AZZTOT
ACCFIN:         RET


                ;SCRITTURA  DECELLERA

DECEL:          LD      A,(LINGUA)
		CP      00H
                JR      Z,DECM
		CP      01H
                JR      Z,DECI
		CP      02H
                JR      Z,DECF
		CP      03H
                JR      Z,DECGB
                CP      04H
                JR      Z,DECE
                JR      DECFIN
DECM:           CALL    BASSA
                LD      HL,DECELE
                JR      DECTX
DECI:           CALL    BASSA
                LD      HL,DECELE+14H
                JR      DECTX
DECF:           CALL    BASSA
                LD      HL,DECELE+28H
                JR      DECTX
DECGB:          CALL    BASSA
                LD      HL,DECELE+3CH
                JR      DECTX
DECE:           CALL    BASSA
                LD      HL,DECELE+50H
DECTX:          CALL    TX
                CALL    RITVEL
		;CALL	AZZTOT
DECFIN:         RET


                ;RITARDO SCRITTURA ACCEL DECEL



RITVEL:         LD      BC,01FFH        
		CALL	RESEPC
RITVE1:         LD      D,077H
RITVE2:         DEC     D
                JR      NZ,RITVE2
                DEC     BC              
                LD      A,B
                OR      C
                JR      NZ,RITVE1

		RET



                ;ROUTINE CALCOLO INTERVALLO CORREZIONI
                ;IN FUNZIONE DELLO SVILUPPO DEL CILINDRO
                ;E DELLA POSIZIONE DEL GRUPPO STAMPA
                ;LONGITUDINALE



INTCOR:         LD      DE,00FEH        ;254mm  FOFF
                LD      (MOLTI),DE      ;CALCOLO I
                LD      A,(CICLO)       ;FORMATI CHE
                LD      (MOLPL),A       ;CI SONO TRA  
                CALL    MOLT            ;LA TESTA E
                LD      DE,(PROD)       ;IL RELATIVO  
                LD      (DIVDEN),DE     ;GRUPPO STAMPA 
                LD      DE,(CILIN)      ;IN FUNZIONE
                LD      (DIVSOR),DE     ;DEL FORMATO
                CALL    DIVIS           ;MONTATO.
                LD      DE,(QUOZIE)     ;INCREMENTO
                INC     DE              ;PER ARROTON-
                LD      A,E             ;DARE SUI DE- 
                CP      04H             ;CIMALI.
                JR      NC,INTCO1       ;SE IL RISUL-
                CCF                     ;TATO E'MINORE
                LD      DE,0004H        ;DI 4 IMPONGO
INTCO1:         LD      (CICATT),DE     ;MINIMO 4  


                LD      (MOLTI),DE      ;75% DEL CICLO
                LD      A,19H           ;CHE VIENE USATO
                LD      (MOLPL),A       ;ALL'INIZIO DELLE
                CALL    MOLT            ;EXTRA CORREZ.
                LD      DE,(PROD)       ;PER FAR SI CHE
                LD      (DIVDEN),DE     ;VI SIA UNA 
                LD      BC,64H          ;BREVE INTERRU-
                LD      (DIVSOR),BC     ;ZIONE PER 
                CALL    DIVIS           ;EVITARE LA
                LD      DE,(QUOZIE)     ;CORREZZIONE
                LD      HL,(CICATT)     ;CONTINUA
                SBC     HL,DE
                LD      (CICL75),HL

                RET


                ;ROUTINE CALCOLO INTERVALLO CORREZIONI
                ;IN FUNZIONE DELLO SVILUPPO DEL CILINDRO
                ;E DELLA POSIZIONE DEL GRUPPO STAMPA
                ;TRASVERSALE


TINTCO:         LD      DE,00FEH        ;254mm  FOFF
                LD      (MOLTI),DE      ;CALCOLO I
                LD      A,(TCICLO)      ;FORMATI CHE
                LD      (MOLPL),A       ;CI SONO TRA  
                CALL    MOLT            ;LA TESTA E
                LD      DE,(PROD)       ;IL RELATIVO  
                LD      (DIVDEN),DE     ;GRUPPO STAMPA 
                LD      DE,(CILIN)      ;IN FUNZIONE
                LD      (DIVSOR),DE     ;DEL FORMATO
                CALL    DIVIS           ;MONTATO.
                LD      DE,(QUOZIE)     ;INCREMENTO
                INC     DE              ;PER ARROTON-
                LD      A,E             ;DARE SUI DE- 
                CP      04H             ;CIMALI.
                JR      NC,INTCO2       ;SE IL RISUL-
                CCF                     ;TATO E'MINORE
                LD      DE,0004H        ;DI 4 IMPONGO
INTCO2:         LD      (TCICAT),DE     ;MINIMO 4  
                RET



                ;SUB RUTINE AGIORNAMENTO VELOCITA'
                ;DURANTE LA SCRITTURA  NO PRINT

VELSUB:         LD      IX,VELBCD        ;XXXX
                LD      A,(IX)
                ADD     A,48
                LD      (NUMCOL+13H),A  ;UNITA'
                INC     IX
                LD      A,(IX)
                ADD     A,48
                LD      (NUMCOL+12H),A  ;DECINE
                INC     IX
                LD      A,(IX)
                ADD     A,48
                LD      (NUMCOL+11H),A  ;CENTINAIA

                LD      A,(SEQSEG)      
                ADD     A,48
                LD      (NUMCOL+09H),A  

                CALL    INISI           
                LD      HL,NUMCOL
                CALL    TX              
                RET                      ;XXXX



		;######################
		;# MODIFICA PARAMETRI #
		;######################



MODPA:          LD      A,00H           ;RESETTA LE
                LD      (MEMC),A        ;USCITE
                OUT     (PC),A
                LD      A,(LINGUA)
                CP      00H
                JR      Z,PARM
                CP      01H
                JR      Z,PARI
                CP      02H
                JR      Z,PARF
                CP      03H
                JR      Z,PARGB
                CP      04H
                JR      Z,PARE
PARM:           CALL    INISI
                LD      HL,PARAME
                JR      PARTX
PARI:           CALL    INISI
                LD      HL,PARAME+14H
                JR      PARTX
PARF:           CALL    INISI
                LD      HL,PARAME+28H
                JR      PARTX
PARGB:          CALL    INISI
                LD      HL,PARAME+3CH
                JR      PARTX
PARE:           CALL    INISI
                LD      HL,PARAME+50H
PARTX:          CALL    TX              
		CALL    RITDIS          ;PER NON AVERE
		LD      DE,0000H        ;UN NUMERO INCA-
		LD      (XUNZ),DE       ;SINATORE.
MODPA1:         LD      BC,0BFFFH
XONT1:          DEC     BC
                LD      A,B
                OR      C
                JR      NZ,XONT1
                CALL    SERITA
                IN      A,(PA)
                BIT     4,A
                JR      NZ,MODPA1

                LD      A,(HL)          ;IN      A,(PA)          
		AND     1FH             ;SELEZIONA TASTO
                CP      0FH             ;FUNZIONE  
		JR      Z,XNCR          ;(CILIN/ALLAR)
		CP      0CH             ;TASTO +
		JP      Z,XART6
		CP      0DH             ;TASTO -
		JP      Z,XART6
		CP      0AH             ;TATSO CLEAR
		JP      Z,XART6
		CP      0BH             ;TASTO ENTER
		JP      Z,RESETT
		JP      XINE
XART:           LD      A,00H
		LD      D,A
		LD      HL,XUNZ
		LD      (HL),A
		JR      XERO
XART1:          LD      A,0CH           ;CONTEGGIO >12  TTEE
		LD      D,A
		LD      HL,XUNZ
		LD      (HL),A
		JP      XERO
XNCR:           NOP                     ;LD      A,00H           
                NOP                     ;LD      (MDIAGO),A      
                LD      HL,XUNZ
		LD      D,(HL)
		INC     D
XERO:           LD      A,D
		LD      (HL),A
                CP      0CH             ;TTEE
		JR      Z,XART
		CP      0FFH
		JR      Z,XART1
		CP      00H
                JR      Z,TRI           
                CP      01H
                JP      Z,GUAD
                CP      02H
                JP      Z,CIC
                CP      03H
                JP      Z,DER
                CP      04H
                JP      Z,ZON
                CP      05H
		JP      Z,INS
                CP      06H
		JP      Z,SALT
                CP      07H
                JP      Z,TGUAD
                CP      08H
                JP      Z,TCIC
                CP      09H
                JP      Z,ZOT
                CP      0AH
                JP      Z,LING
                CP      0BH             ;OOGG
                JP      Z,OSGA          ;OOGG
                JP      MODPA1


TRI:            LD      IX,TRIP         ;CARICO PARAMETRI
                LD      (IX+02H),00H    ;DEL TRIP DI
                LD      (IX+03H),00H    ;VELOCITA'
                LD      (IX+04H),0FH    ;ZZZ 
                LD      DE,(TRIP)
		LD      (BINSET),DE
TRIM:           CALL    INISI
                LD      HL,TRIDIS
TRITX:          CALL    TX             
                PUSH    IX
		CALL    BIN7
                POP     IX
		JP      XINE


GUAD:           LD      IX,GUADA        ;CARICO PARAMETRI
                LD      (IX+02H),02H    ;DEL GADAGNO ZZZ
		LD      (IX+03H),00H
		LD      (IX+04H),64H    ; = 100
		LD      DE,(GUADA)
		LD      (BINSET),DE
GUAM:           CALL    INISI
                LD      HL,GUADAG
GUATX:          CALL    TX              
                PUSH    IX
		CALL    BIN7
                POP     IX
		JP      XINE


CIC:            LD      IX,CICLO        ;CARICO PARAMETRI
                LD      (IX+02H),01H    ;DEL CICLO CORREZ. ZZZ
		LD      (IX+03H),00H
		LD      (IX+04H),64H
		LD      DE,(CICLO)

                LD      (BINSET),DE     ;CALCOLO DEL ZZZ
                LD      (MOLTI),DE      ;75% DEL CICLO
                LD      A,19H           ;CHE VIENE USATO
                LD      (MOLPL),A       ;ALL'INIZIO DELLE
                CALL    MOLT            ;EXTRA CORREZ.
                LD      DE,(PROD)       ;PER FAR SI CHE
                LD      (DIVDEN),DE     ;VI SIA UNA 
                LD      BC,64H          ;BREVE INTERRU-
                LD      (DIVSOR),BC     ;ZIONE PER 
                CALL    DIVIS           ;EVITARE LA
                LD      DE,(QUOZIE)     ;CORREZZIONE
                LD      HL,(CICLO)      ;CONTINUA
                SBC     HL,DE
                LD      (CICL75),HL





                LD      A,(LINGUA)
                CP      00H
                JR      Z,CICM
                CP      01H
                JR      Z,CICI
                CP      02H
                JR      Z,CICF
                CP      03H
                JR      Z,CICGB
                CP      04H
                JR      Z,CICE
CICM:           CALL    INISI
                LD      HL,CICLIC
                JR      CICTX
CICI:           CALL    INISI
                LD      HL,CICLIC+14H
                JR      CICTX
CICF:           CALL    INISI
                LD      HL,CICLIC+28H
                JR      CICTX
CICGB:          CALL    INISI
                LD      HL,CICLIC+3CH
                JR      CICTX
CICE:           CALL    INISI
                LD      HL,CICLIC+50H
CICTX:          CALL    TX              
                PUSH    IX
		CALL    BIN7
                POP     IX
		JP      XINE


DER:            LD      IX,DERIVA       ;CARICO PARAMETRI
                LD      (IX+02H),01H    ;DEL DERIVATIVO  ZZZ
		LD      (IX+03H),00H
		LD      (IX+04H),0FFH    
		LD      DE,(DERIVA)
		LD      (BINSET),DE
DISM:           CALL    INISI
                LD      HL,DISDER
DISTX:          CALL    TX              
                PUSH    IX
		CALL    BIN7
                POP     IX
		JP      XINE


ZON:            LD      IX,ZONA         ;CARICO PARAMETRI
		LD      (IX+02H),00H    ;DELLA ZONA MORTA
		LD      (IX+03H),00H
		LD      (IX+04H),15H
		LD      DE,(ZONA)
		LD      (BINSET),DE
ZONM:           CALL    INISI
		LD	HL,ZONAMO
ZONTX:          CALL    TX              
                PUSH    IX
		CALL    BIN7
                POP     IX
		JP      XINE


INS:            LD      IX,INSER        ;CARICO PARAMETRI
                LD      (IX+02H),01H    ;DELL'INSERZIONE  ZZZ
		LD      (IX+03H),00H
                LD      (IX+04H),65H
		LD      DE,(INSER)
		LD      (BINSET),DE
INSM:           CALL    INISI
                LD      HL,INSERZ
INSTX:          CALL    TX              
                PUSH    IX
		CALL    BIN7
                POP     IX
		JP      XINE


SALT:           LD      IX,SALTO        ;CARICO PARAMETRI
		LD      (IX+02H),00H    ;DEL SALTO DI
		LD      (IX+03H),00H    ;CORREZIONE
		LD      (IX+04H),0AH    
		LD      DE,(SALTO)
		LD      (BINSET),DE
DSAM:           CALL    INISI
                LD      HL,DSALTO
DSATX:          CALL    TX              
                PUSH    IX
		CALL    BIN7
                POP     IX
		JP      XINE
                        

TGUAD:          LD      IX,GUATRA       ;CARICO PARAMETRI
                LD      (IX+02H),02H    ;GUADAGNO TRAVERS ZZZ
		LD      (IX+03H),00H
		LD      (IX+04H),64H    ;= 100
		LD      DE,(GUATRA)
		LD      (BINSET),DE
                LD      A,(LINGUA)
TRGM:           CALL    INISI
                LD      HL,TRAGUA
TRGTX:          CALL    TX              
                PUSH    IX
		CALL    BIN7
                POP     IX
		JP      XINE


TCIC:           LD      IX,TCICLO       ;CARICO PARAMETRI
                LD      (IX+02H),01H    ;CICLO CORREZZONI  ZZZ
		LD      (IX+03H),00H    ;TRAVERS
		LD      (IX+04H),64H
		LD      DE,(TCICLO)
		LD      (BINSET),DE
TRCM:           CALL    INISI
                LD      HL,TRACIC
TRCTX:          CALL    TX              
                PUSH    IX
		CALL    BIN7
                POP     IX
		JP      XINE


ZOT:            LD      IX,ZONT         ;CARICO PARAMETRI                                                              
		LD      (IX+02H),00H    ;DELLA ZONA MORTA
		LD      (IX+03H),00H    ;TRAVERS
		LD      (IX+04H),15H
		LD      DE,(ZONT)
ZOTM:           CALL    INISI
                LD      HL,TRAZON
ZOTTX:          CALL    TX              
                PUSH    IX
		CALL    BIN7
                POP     IX
		JP      XINE


LING:           LD      IX,LINGUA       ;CARICO PARAMETRI                                                              
                LD      (IX+02H),00H    ;DELLA LINGUA
                LD      (IX+03H),00H    
                LD      (IX+04H),05H
                LD      DE,(LINGUA)
		LD      (BINSET),DE
                CALL    INISI
                LD      HL,DISLIN
                CALL    TX
                PUSH    IX
		CALL    BIN7
                POP     IX
		JP      XINE


OSGA:           LD      IX,OSGAIN       ;CARICO PARAMETRI  OOGG
                LD      (IX+02H),00H    ;DEL GUADAGN0
                LD      (IX+03H),00H    ;OSCILLOSCOPIO
                LD      (IX+04H),04H    ; 
                LD      DE,(OSGAIN)
		LD      (BINSET),DE
OSGM:           CALL    INISI
                LD      HL,OSGDIS
OSGTX:          CALL    TX             
                PUSH    IX
		CALL    BIN7
                POP     IX
                JP      XINE                    ;OOGG




		;GESTIONE CONTEGGIO

XONT5:          LD      BC,0AFFFH       ;cont. lento
XONT7:          DEC     BC
		LD      A,B
		OR      C
		JR      NZ,XONT7
                IN      A,(PA)          
                BIT     4,A             
                JP      NZ,XINE         

XART6:          CALL    SERITA
                LD      A,(HL)          ;IN      A,(PA)
		AND     1FH             ;sente che
		CP      0CH             ;tasto 
		JR      Z,XNCR2         ;premuto
		CP      0DH
		JR      Z,XECR2
		CP      0AH             ;SE CLEAR AZZERA
		JR      Z,XZZER         ;IL DISPLAY
		JP      XINE
XECR2:          NOP                     ;LD      A,(MDIAGO)      ;SENZA QUESTO
                NOP                     ;CP      01H             ;PORTA A 99
                NOP                     ;JR      Z,XNCR2         ;GUADAGNO CIRC.
                LD      E,(IX+00H)
		LD      D,(IX+01H)
		LD      A,D             ;VEDO SE E'ZERO 
		OR      E               ;PER NON AVERE IN
		JR      Z,XENT2         ;DECREMENTO FFFFH
		LD      A,(MEM1)
		BIT     0,A
		JR      Z,XENTO
XENT2:          LD      D,(IX+03H)
		LD      E,(IX+04H)
		XOR     A
		LD      (MEM1),A
		JR      XENT1
XENTO:          LD      E,(IX+00H)      ;CARICO I 
		LD      D,(IX+01H)      ;PARAMETRI
XENT1:          DEC     DE
		LD      (IX+00H),E      ;SALVO I PARAMETRI
		LD      (IX+01H),D
		LD      (BINSET),DE
                PUSH    IX
                CALL    BIN7            ;TRASMISSIONE
                POP     IX
		LD      A,E
		CP      (IX+02H)
		JR      Z,XZZ3
		JR      XERO2
XZZ3:           LD      A,01H
		LD      (MEM1),A
		LD      (IX+00H),E      ;AZZERAMENTO
		LD      (IX+01H),D      ;FASE E ALLARME
		JP      XERO2
XNCR2:          LD      E,(IX+00H)
		LD      D,(IX+01H)
		INC     DE
		LD      (IX+00H),E
		LD      (IX+01H),D
		LD      (BINSET),DE
                PUSH    IX
		CALL    BIN7
                POP     IX

		LD      A,E
		CP      (IX+04H)
		JR      Z,XZZER
		JP      XERO2           ;SECONDO LA
XZZER:          LD      DE,0000H        ;FUNZIONE
		LD      (IX+00H),E      ;RICHIESTA
		LD      (IX+01H),D
		LD      (BINSET),DE
                PUSH    IX
		CALL    BIN7
                POP     IX

		JR      XERO2
XECR3:          LD      A,01H
		LD      (MEM2),A
                CALL    SERITA
                LD      A,(HL)          ;IN      A,(PA)
		AND     1FH
		CP      0DH
		JR      Z,XECR3
XNCR3:          LD      A,01H
		LD      (MEM3),A
                CALL    SERITA
                LD      A,(HL)          ;IN      A,(PA)
		AND     1FH
		CP      0CH
		JR      Z,XNCR3
XERO2:          NOP                     ;LD      A,(MDIAGO)
                NOP                     ;CP      01H
                NOP                     ;JP      Z,DIA
                IN      A,(PA)          
                BIT     4,A             
                JR      NZ,XINE         
                CALL    SERITA
                LD      A,(HL)          ;IN      A,(PA)
		AND     1FH             ;SENTE SE TASTO
		CP      0DH             ;ANCORA PREMUTO
		JP      Z,XONT5         ;RIPETE IL CICLO
		CP      0CH
		JP      Z,XONT5
XINE:           LD      (XTASTO),IX
		JP      MODPA1

RESETT:         LD      A,01H           ;COSI' QUANDO ZZZ
                LD      (MEM6A),A       ;RITORNA VA
                EI                      ;POI A VIA  ZZZ
                RET

                
                ;CALCOLO VELOCITA'ISTANTANEA SLEGATO     BBLL
                ;DAL NORMALE CALCOLO USATO SOLO PER NOPRI
                
VELIST:                                 ;BBLL

                LD      BC,011DH        ;4mS TEMPO   
                LD      IX,IMPVEL       ;PER MISURARE
                LD      A,00H           ;GLI IMPULSI
                LD      (IX+01H),A
                LD      A,057H          ;SETTO CTC0
                OUT     (70H),A         ;SENZA INTERUPT
                LD      A,0FFH          
                OUT     (70H),A         
VELO1:          IN      A,(70H)         ;NEL CASO IL 
                CP      00H             ;DECREMENTO 
                JR      NZ,VELO2        ;ARRIVI A ZERO
                INC     (IX+01H)        ;LO MEMORIZZO

VELO2:          DEC     BC              
                LD      A,B
                OR      C
                JR      NZ,VELO1       
                IN      A,(70H)         
                CPL                     ;IMPULSI PROPOR
                LD      (IMPVEL),A      ;ALLA VELOCITA.


                LD      DE,(COSVEL)
		LD      (MDO032),DE
		LD      DE,0000H
		LD      (MDO232),DE
		LD      (MRE232),DE
		LD      DE,(IMPVEL)
		LD      (MRE032),DE
		LD      A,02H           
		LD      (ALTDIV),A      
		CALL    MOL32
		CALL    DI1000
		LD      BC,(QU1000)     ;VELOCITA         
		LD      (ISTVEL),BC     ;ISTANTANEA    

                LD      (BINSET),BC     ;TTVV
                LD      A,01H           ;TTVV
                LD      (VELMEM),A      ;TTVV
                CALL    BIN7            ;TTVV
                LD      A,00H           ;TTVV
                LD      (VELMEM),A      ;TTVV


                RET



SERITA:
                LD      A,(GUADS1)      ;SALVA IL VALORE 
                LD      H,A             ;DI AMPLIF. 

		LD      A,(MEMA)
		RES     2,A
		OUT     (PA),A
		SET     2,A
		OUT     (PA),A
		LD      D,00H           
		LD      B,08H           
KRITPA:
		RES     1,A
		OUT     (PA),A
		IN      A,(PA)
		RR      A     
		RL      D
		SET     1,A
		SET     2,A

                AND     0FH             ;RIPRISTINA 
                ADD     A,H             ;AMPLIFICAZ. 

		OUT     (PA),A
		LD      (MEMA),A
		DJNZ    KRITPA
		LD      (MEMA),A        
		LD      A,D
		AND     1FH
                NOP                     ;CALL    CAG
		LD      L,A             ;LEGGO DUE VOLTE
		LD      H,00H           ;LA TASTIERA CON
		LD      DE,TABLE        ;UN RITARDO TRA 
		ADD     HL,DE           ;PRIMA E LA SECON-
		RET



                

		;VERIFICA FUNZIONAMENTO TESTA
		;E ENCODER


TEST:           DI                      ;
                LD      A,00H           ;RESETTO PORTA C
		LD      (MEMC),A        ;IMPONENDO MANUALE
                OUT     (PC),A
                CALL    INISI
                LD      HL,DITEST
                CALL    TX
		CALL    RITDIS          ;PER NON AVERE

TES1:           LD      BC,01FFH        ;RITARDO ANTI
TES2:           DEC     BC              ;RIMBALZO
		LD      A,B
		OR      C
		JR      NZ,TES2
		IN      A,(PA)
                BIT     4,A
                JR      Z,TES1
                CALL    SERITA
                LD      A,(HL)
		AND     1FH
                CP      01H             ;TEST TESTA
		JR      Z,TES3
                CP      02H             ;TEST ENCODER
		JP      Z,ENC1
;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
		CP	03H
		JP	Z,LED_TEST
;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

                CP      04H             ;OO11 LLLL
		JP      Z,PROGRA        ;OO11

        	CP      0BH
		JP      Z,TESEND
		JR      TES1
TES3:           LD      A,(LINGUA)
                CP      00H
                JR      Z,TESM
                CP      01H
                JR      Z,TESI
                CP      02H
                JR      Z,TESF
                CP      03H
                JR      Z,TESGB
                CP      04H
                JR      Z,TESE
TESM:           CALL    INISI
                LD      HL,TTESTA
                JR      TESTX
TESI:           CALL    INISI
                LD      HL,TTESTA+14H
                JR      TESTX
TESF:           CALL    INISI
                LD      HL,TTESTA+28H
                JR      TESTX
TESGB:          CALL    INISI
                LD      HL,TTESTA+3CH
                JR      TESTX
TESE:           CALL    INISI
                LD      HL,TTESTA+50H
TESTX:          CALL    TX              
		LD      A,(MEMB)
		SET     6,A             ;BLOCCO GATE
		LD      (MEMB),A
		OUT     (PB),A
		LD      D,0FFH
TES4:           IN      A,(PB)          
		BIT     2,A
		JR      NZ,TESSI
		LD      BC,0A00H        ;5 SECONDI
TES5:           DEC     BC              ;DI TEST 
		LD      A,B             
		OR      C                
		JR      NZ,TES5         
		DEC     D
		LD      A,00H
		CP      D
		JR      NZ,TES4

                CALL    BASSA
                LD      HL,LAVANO
                CALL    TX
                CALL    RITDIS
		JR      TES6


TESSI:          CALL    BASSA
                LD      HL,LAVA
                CALL    TX
                CALL    RITDIS
TES6:           JP      TES1



                

                ;TEST DELL'ENCODER,DEVE
                ;GIRARE AL DISOTTO DI 50 GIRI/MIN
                


ENC1:           CALL    INISI
                LD      HL,TENCOD
                CALL    TX
                CALL    RITDIS

                LD      A,01H          ;CARICO UN
                LD      (ENCOD1),A     ;GIRO IN CTC1
                LD      A,0DFH         ;E 255 IN CTC0        
                OUT     (70H),A        ;255 X 16 = 4096
                LD      A,0FFH         ;PER CUI CTC0
                OUT     (70H),A        ;DARA' 16 CLOCK
                LD      A,0D7H         ;AL GIRO
                OUT     (71H),A        
                LD      A,01H          
                OUT     (71H),A
                LD      A,00H          ;AZZERO IL 
                LD      (ENCOD2),A     ;CONTATORE    
                EI                     ;PER 16
                RET                    


                


ENC2:           LD      BC,01FFH       ;RITARDO ANTI 
ENC3:           DEC     BC             ;RIMBALZO
		LD      A,B
		OR      C
                JR      NZ,ENC3
                JR      ENC2

ENC6:           LD      A,00H
                LD      (ENCOD1),A      ;
                LD      A,(ENCOD2)
                DI
		LD      A,43H
                OUT     (70H),A
		OUT     (71H),A
                LD      A,(ENCOD2)      ;ACCETTO COME
                CP      10H             ;BUONO 16
                JR      Z,ENC5          
                LD      A,(ENCOD3)      ;TENTA PER
                INC     A               ;10 VOLTE 
                LD      (ENCOD3),A      ;IL TEST
                CP      0AH
                JP      NZ,ENC1
                JR      ENC4


                

ENC4:           CALL    INISI
                LD      HL,TENCOD
                CALL    TX
                CALL    BASSA
                LD      HL,LAVANO
                CALL    TX
                CALL    RITDIS

                JP      TES1

ENC5:           CALL    INISI
                LD      HL,TENCOD
                CALL    TX
                CALL    BASSA
                LD      HL,LAVA
                CALL    TX
                CALL    RITDIS

                JP      TES1
;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
LED_TEST:
		
                LD      A,0C2H                
                LD      (DATOTX),A    
                CALL    TX485         
                LD      A,0C4H                
                LD      (DATOTX),A    
                CALL    TX485
		
;#############################################################
		CALL	RITDIS

		LD      A,0C1H                
                LD      (DATOTX),A    
                CALL    TX485
		
;###############################################################

	        IN      A,(PA)
                BIT     4,A
                JR      NZ,LED_TEST       
		CALL    SERITA
                LD      A,(HL)
                AND     1FH
                CP      0BH
                JP      Z,VIA
                CP      0AH
                JP      Z,VIA

		JR	LED_TEST


;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

               ;ANNULLA LO SHIFT QUANDO SI ESEGUE F4 
               ;SENZA AVER MODIFICATAO IL VALORE A F3



AZZF4:          LD      DE,7D0H         ;2000 = 20mmX100
		LD      (MOLTI),DE
		LD      A,(SEQSEG)
		LD      (MOLPL),A
		CALL    MOLT
		LD      HL,(PROD)
		SBC     HL,DE
		LD      (DISTAN),HL
		LD      (MDO032),HL     ;CALCOLO
		LD      BC,0000H        ;DISTANZA IN
		LD      (MDO232),BC     ;CENTIMILLESIMI
		LD      HL,03E8H
		LD      (MRE032),HL
		LD      (MRE232),BC
		CALL    MOL32
		LD      HL,(PTO032)
		LD      (DISTA0),HL     ;DISTANZA IN
                LD      (TDIST0),HL     ;CENTIMILLESIMI
                LD      HL,(PTO232)     ;SIA PER LONG.
                LD      (DISTA2),HL     ;CHE PER TRAVERS
                LD      (TDIST2),HL
                RET


PROGRA:         CALL    INISI           ;OO11 
		LD      HL,PROGR1
		CALL    TX
		CALL    BASSA
		LD      HL,PROGR2
		CALL    TX              
		CALL    RITDIS
		CALL    RITDIS          ;OO11
		CALL    RITDIS          ;OO11
		CALL    RITDIS          ;OO11
		CALL    RITDIS          ;OO11



TESEND:         LD      A,01H           ;COSI' QUANDO ZZZ
                LD      (MEM6A),A       ;RITORNA VA
                EI                      ;POI A VIA  ZZZ
                RET


                
RITDIS:         LD      D,03H
RITDI1:         LD      BC,0FFFFH
RITDI2:         DEC     BC
		LD      A,B
		OR      C
		JR      NZ,RITDI2
		DEC     D
		JR      NZ,RITDI1
		RET



TX485:          
                LD      A,(DATOTX)
                ADD     A,A             ;METTE A ZEROH
                LD      B,0BH           ;BIT 0
TBIT:           SET     7,A             ;ABILILITA TX
                OUT     (PD),A          ;VIENE SETTATO
                RRA                     ;PER TRASMETTERE
                SCF                     ;SEMPRE.
                CALL    DFULL
                DJNZ    TBIT
                JR      FIN485
DHALF:
                PUSH    DE
                LD      D,2H            ;LD      D,4H
                JR      DLY16
DFULL:
                PUSH    DE
                LD      D,04H           ;LD      D,08H
DLY16:          LD      E,23H           ;LD      E,46H
DLY1:           DEC     E
                JR      NZ,DLY1
                DEC     D
                JR      NZ,DLY16
                POP     DE
FIN485:         
		RET
                


                ;SCRITTURA FINE CORSA TESTA

FINECO:         LD      A,(MEMC)        ;METTO LA
		RES     0,A             ;PROTEZIONE.
		RES     1,A
                RES     6,A
                RES     7,A
		LD      (MEMC),A
                OUT     (PC),A
                LD      A,01H
                LD      (PROTEZ),A      ;3/3/01
                LD      A,(LINGUA)
                CP      00H
                JR      Z,FCTM
                CP      01H
                JR      Z,FCTI
                CP      02H
                JR      Z,FCTF
                CP      03H
                JR      Z,FCTGB
                CP      04H
                JR      Z,FCTE
FCTM:           CALL    INISI
                LD      HL,FINCOR
                JR      FCTTX
FCTI:           CALL    INISI
                LD      HL,FINCOR+14H
                JR      FCTTX
FCTF:           CALL    INISI
                LD      HL,FINCOR+28H
                JR      FCTTX
FCTGB:          CALL    INISI
                LD      HL,FINCOR+3CH
                JR      FCTTX
FCTE:           CALL    INISI
                LD      HL,FINCOR+50H
FCTTX:          CALL    TX    
		CALL	FLASH		;RRFF
                RET


                ;SCRITTURA LATO DESTRO


BANDAD:         CALL    BASSA
                LD      A,(LINGUA)
                CP      00H
                JR      Z,LADEM
                CP      01H
                JR      Z,LADEI
                CP      02H
                JR      Z,LADEF
                CP      03H
                JR      Z,LADEGB
                CP      04H
                JR      Z,LADEE
LADEM:          LD      HL,LATODX
                JR      LADEX
LADEI:          LD      HL,LATODX+14H
                JR      LADEX
LADEF:          LD      HL,LATODX+28H
                JR      LADEX
LADEGB:         LD      HL,LATODX+3CH
                JR      LADEX
LADEE:          LD      HL,LATODX+50H
LADEX:          CALL    TX
                NOP                     ;CALL    FLASH TTTT
                LD      BC,0FFFFH
LAD1:           DEC     BC              ;RITARDO CHE
                LD      A,B             ;PERMETTE LA
                OR      C               ;VISUALIZZA-
                JR      NZ,LAD1         ;ZIONE. 
                NOP                     ;CALL    FLASH
		RET


                ;SCRITTURA LATO SINISTRO


BANDAS:         CALL    BASSA
                LD      A,(LINGUA)
                CP      00H
                JR      Z,LASIM
                CP      01H
                JR      Z,LASII
                CP      02H
                JR      Z,LASIF
                CP      03H
                JR      Z,LASIGB
                CP      04H
                JR      Z,LASIE
LASIM:          LD      HL,LATOSX
                JR      LASIX
LASII:          LD      HL,LATOSX+14H
                JR      LASIX
LASIF:          LD      HL,LATOSX+28H
                JR      LASIX
LASIGB:         LD      HL,LATOSX+3CH
                JR      LASIX
LASIE:          LD      HL,LATOSX+50H
LASIX:          CALL    TX
                NOP                     ;CALL    FLASH   TTTT
                LD      BC,0FFFFH
LAS1:           DEC     BC              ;RITARDO CHE
                LD      A,B             ;PERMETTE LA
                OR      C               ;VISUALIZZA-
                JR      NZ,LAS1         ;ZIONE.
                NOP                     ;CALL    FLASH
		RET


FLASH:					;NNFF

		CALL	RESEPC		;CCDD
		LD	 A,(MEMC)	;IN CASO DI NNFF
		AND	 08H		;DI ALLARME
		LD	 B,A		;RIMANE ATTIVO
					
		LD      A,(MEMC1)
		RES	3,A
		OR	B
                BIT     2,A
                JR      NZ,FL1
                SET     2,A
		RES	 4,A
                JR      FL2
FL1:            RES     2,A
	        SET	 4,A
FL2:		LD	(MEMC1),A               
		OUT	(PC),A
FL3:
                RET

		;AZZERAMENTO DA 0C900H A 0CCFFH
AZZER_ERROR: 		
                LD      A,00H           ;VVVV
                LD      (MAVA00),A      ;VVVV  LOC. INIZIALE
                LD      HL,MAVA00       ;VVVV
                LD      DE,MAVA00+01H   ;VVVV
                LD      BC,03FFH        ;VVVV
                LDIR                    ;VVVV
		RET


               ;CALCOLO VARIABILI PER MEDIA ERRORE LONG.

VARERR:                                  ;WWAA
                LD      A,(CICLO)
                CP      09H
                JR      NC,MECI01
                LD      A,07H
                LD      (PRIMOB),A
                INC     A
                LD      (SECONB),A
                LD      A,0CH
                LD      (VALORX),A
                JR      MECI04
MECI01:
                LD      A,(CICLO)
                CP      11H             ;= 17
                JR      NC,MECI02
                LD      A,0FH
                LD      (PRIMOB),A
                INC     A
                LD      (SECONB),A
                LD      A,1CH           ;= 28
                LD      (VALORX),A
                JR      MECI04
MECI02:
                LD      A,(CICLO)
                CP      21H             ;= 33
                JR      NC,MECI03
                LD      A,1FH           ;= 31
                LD      (PRIMOB),A
                INC     A
                LD      (SECONB),A
                LD      A,3CH           ;= 60
                LD      (VALORX),A
                JR      MECI04
MECI03:
                LD      A,2FH           ;= 47
                LD      (PRIMOB),A
                INC     A
                LD      (SECONB),A
                LD      A,5CH           ;= 92
                LD      (VALORX),A
MECI04:

	       ;CALCOLO VARIABILI PER MEDIA ERRORE TRAVERS


                LD      A,(TCICLO)
                CP      09H
                JR      NC,MECI05
                LD      A,07H
                LD      (TPRIMB),A
                INC     A
                LD      (TSECOB),A
                LD      A,0CH
                LD      (TVALOX),A
                JR      MECI08
MECI05:
                LD      A,(TCICLO)
                CP      11H             ;= 17
                JR      NC,MECI06
                LD      A,0FH
                LD      (TPRIMB),A
                INC     A
                LD      (TSECOB),A
                LD      A,1CH           ;= 28
                LD      (TVALOX),A
                JR      MECI08
MECI06:
                LD      A,(TCICLO)
                CP      21H             ;= 33
                JR      NC,MECI07
                LD      A,1FH           ;= 31
                LD      (TPRIMB),A
                INC     A
                LD      (TSECOB),A
                LD      A,3CH           ;= 60
                LD      (TVALOX),A
                JR      MECI08
MECI07:
                LD      A,2FH           ;= 47
                LD      (TPRIMB),A
                INC     A
                LD      (TSECOB),A
                LD      A,5CH           ;= 92
                LD      (TVALOX),A
MECI08:
                RET
                


RESEPC:
                LD      A,(PROTEZ)      ;FFLL
                CP      01H
                JR      Z,RESPE1
                LD      A,(MEMC)        
		RES     0,A
		RES     1,A
                RES     6,A
                RES     7,A
		LD      (MEMC),A
		OUT     (PC),A
RESPE1:         RET


MINIRICERCA:
		LD      A,0CBH          ;TETSA DI 2mm SX/DX PPSS
                LD      (DATOTX),A      ;SE SUPERO IL TOT
		CALL    TX485		;AZZERO
		LD	A,(MNOPR4)
		INC	A
		LD	(MNOPR4),A
		CP	05H
		JR	C,MINI1
		LD	A,00H
		LD	(MNOPR4),A
MINI1:		
		RET
		
VERIFICA_CODICE:
		LD	A,(TESTCO)	;SE SONO IN
		CP	01H		;TEST CODE
		JR	Z,VERI_01	;SALTO

		LD	A,(MNOPR3)
		CP	01H
		JR	NZ,VERI_END 
VERI_01:	
		LD      A,01H		;CCDD
		LD      (MRIC+00H),A	;CCDD
		LD      (MRIC+02H),A	;CCDD
                LD      (MRIC+06H),A    ;CCDD
          ;SSDD      LD      (MRIC+08H),A    ;CCDD
		CALL	CODICE
		LD      A,00H		;CCDD 
		LD      (MRIC+00H),A	;CCDD
		LD      (MRIC+02H),A	;CCDD
                LD      (MRIC+06H),A    ;CCDD
     ;SSDD          LD      (MRIC+08H),A    ;CCDD
		;LD	(TESTCO),A
		LD      A,(MEMB)        ;SBLOCCO IL CCGG
		RES     6,A             ;GATE
		LD      (MEMB),A
		OUT     (PB),A

		LD	A,03H		;BBCC
		LD	(TESTCO),A	;BBCC

VERI_END
		RET

INC_CICLO:	
		LD	A,(CICLO)	;AACC
		RL	A
		LD	(MATTES),A
		LD	A,(TCICLO)
		RL	A
		LD	(TATTES),A	;AACC

		RET

MEDIA:         
		LD      BC,(MMED00)     ;SI FA LA MEDIA MMTT
		LD      DE,(MMED02)     ;TRA GLI ULTIMI 
		LD      HL,(MMED04)     ;4 ERRORI LETTI. 
		LD      (MMED02),BC     ;AD OGNI GIRO 
		LD      (MMED04),DE     ;SI INSERISCE 
		LD      (MMED06),HL     ;QUELLO NUOVO 
		LD      HL,(CRAPAE)     ;E SI ELIMINA 
		LD      (MMED00),HL     ;IL VECCHIO
		LD      BC,(MMED02)     ;QUARTO.
		ADC     HL,BC
		LD      BC,(MMED04)
		ADC     HL,BC
		LD      BC,(MMED06)
		ADC     HL,BC
		LD      (DIVDEN),HL
		LD      BC,0004H
		LD      (DIVSOR),BC
		CALL    DIVIS
		LD      HL,(QUOZIE)
		LD      (CRAPAM),HL	;MMTT
		RET

CENTRA_TESTA
		LD	A,(CRAPAC)	;COTEGGIO GIRI MMTT
		DEC	A
		LD	(CRAPAC),A	;MMTT
		CP	00H
		JR	NZ,CENTRA_END
		CALL	TX485
		LD	A,04H
		LD	(CRAPAC),A
CENTRA_END				;MMTT
		RET
		END











CAG:            CP      00H
		JP      Z,CAGFIN
		CP      01H
		JR      Z,CAGA01
		CP      02H
		JR      Z,CAGA02
		CP      03H
		JR      Z,CAGA03
		CP      04H
		JR      Z,CAGA04
		CP      05H
		JP      Z,CAGFIN
		CP      06H
		JR      Z,CAGA06
		CP      07H
		JR      Z,CAGA07
		CP      08H
		JR      Z,CAGA08
		CP      09H
		JR      Z,CAGA09
		CP      0AH
		JP      Z,CAGFIN
		CP      0BH
		JR      Z,CAGA0B
		CP      0CH
		JR      Z,CAGA0C
		CP      0DH
		JR      Z,CAGA0D
		CP      0EH
		JR      Z,CAGA0E
		CP      0FH
		JR      Z,CAGFIN
		CP      10H
		JR      Z,CAGA10
		CP      11H
		JR      Z,CAGA11
		CP      12H
		JR      Z,CAGA12
		CP      13H
		JR      Z,CAGA13
		CP      14H
		JR      Z,CAGA14
		CP      15H
		JR      Z,CAGA15
		CP      16H
		JR      Z,CAGA16
		CP      17H
		JR      Z,CAGA17
CAGA01:         LD      A,04H
		JR      CAGFIN
CAGA02:         LD      A,08H
		JR      CAGFIN
CAGA03:         LD      A,0CH
		JR      CAGFIN
CAGA04:         LD      A,01H
		JR      CAGFIN
CAGA06:         LD      A,09H
		JR      CAGFIN
CAGA07:         LD      A,0DH
		JR      CAGFIN
CAGA08:         LD      A,02H
		JR      CAGFIN
CAGA09:         LD      A,06H
		JR      CAGFIN
CAGA0B:         LD      A,10H
		JR      CAGFIN
CAGA0C:         LD      A,03H
		JR      CAGFIN
CAGA0D:         LD      A,07H
		JR      CAGFIN
CAGA0E:         LD      A,0BH
		JR      CAGFIN
CAGA10:         LD      A,13H
		JR      CAGFIN
CAGA11:         LD      A,14H
		JR      CAGFIN
CAGA12:         LD      A,11H
		JR      CAGFIN
CAGA13:         LD      A,15H
		JR      CAGFIN
CAGA14:         LD      A,17H
		JR      CAGFIN
CAGA15:         LD      A,16H
		JR      CAGFIN
CAGA16:         LD      A,0EH
		JR      CAGFIN
CAGA17:         LD      A,12H
CAGFIN:         RET

		
		
		
		END





		ORG	5000H

CULO:		
                LD      A,0CBH          ;
                LD      (DATOTX),A      ; 
		CALL    TX485           ;
		CALL    RITDIS
		CALL    RITDIS          ;OO11
		    
		JR	CULO
		END


